console.log('=== ê´€ë¦¬ì ë¡œê·¸ì¸ í˜ì´ì§€ ì‹œì‘ ===');function showError(message){const errorDiv=document.getElementById('error-message');const successDiv=document.getElementById('success-message');successDiv.style.display='none';errorDiv.textContent=message;errorDiv.style.display='block';setTimeout(()=>{errorDiv.style.display='none';},5000);}
function showSuccess(message){const errorDiv=document.getElementById('error-message');const successDiv=document.getElementById('success-message');errorDiv.style.display='none';successDiv.textContent=message;successDiv.style.display='block';}
function hideMessages(){document.getElementById('error-message').style.display='none';document.getElementById('success-message').style.display='none';}
document.getElementById('loginForm').addEventListener('submit',function(e){e.preventDefault();hideMessages();const formData=new FormData(e.target);const data={admin_id:formData.get('admin_id'),password:formData.get('password'),};console.log('ğŸ”‘ ë¡œê·¸ì¸ ì‹œë„:',{admin_id:data.admin_id,password:'***'});fetch('/secret/api/v1/admin/login',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify(data),}).then((response)=>{console.log('âœ… ì‘ë‹µ ìƒíƒœ:',response.status);console.log('âœ… ì‘ë‹µ í—¤ë”:',response.headers.get('content-type'));const contentType=response.headers.get('content-type');if(!contentType||!contentType.includes('application/json')){return response.text().then((text)=>{console.error('âŒ JSONì´ ì•„ë‹Œ ì‘ë‹µ:',text);throw new Error(`ì„œë²„ì—ì„œ HTML ì‘ë‹µì„ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤.ìƒíƒœ:${response.status}`);});}
return response.json().then((data)=>{const result={...data,status:response.status,ok:response.ok};console.log('ğŸ“¦ íŒŒì‹±ëœ ì‘ë‹µ ë°ì´í„°:',result);return result;}).catch((parseError)=>{console.error('âŒ JSON íŒŒì‹± ì˜¤ë¥˜:',parseError);return response.text().then((text)=>{console.error('âŒ ì‘ë‹µ ì›ë³¸ í…ìŠ¤íŠ¸:',text);throw new Error('ì„œë²„ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: '+parseError.message);});});}).then((result)=>{console.log('âœ… ì‘ë‹µ ë°ì´í„°:',result);console.log('âœ… result.ok:',result.ok);console.log('âœ… result.status:',result.status);if(result.ok||result.status===200){const adminStatus=(result.admin?.admin_status||'').toUpperCase();console.log('ğŸ“‹ ê´€ë¦¬ì ìƒíƒœ(admin_status):',adminStatus);if(adminStatus==='OPEN'){console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ!');if(window.parent===window&&!window.opener){showSuccess('ë¡œê·¸ì¸ ì„±ê³µ! ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...');}
if(result.admin&&typeof window.setAdminSession==='function'){window.setAdminSession(result.admin);console.log('âœ… ê´€ë¦¬ì ì„¸ì…˜ ì „ì—­ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ:',result.admin);}else{console.warn('âš ï¸ admin_session.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê´€ë¦¬ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');}
const messageData={type:'ADMIN_LOGIN_SUCCESS',admin:result.admin,timestamp:Date.now(),};if(window.opener&&window.opener!==window){console.log('ğŸ”” íŒì—… ì°½ - ë¶€ëª¨ ì°½ì— ë¡œê·¸ì¸ ì„±ê³µ ë©”ì‹œì§€ ì „ì†¡');try{window.opener.postMessage(messageData,'*');console.log('âœ… íŒì—… ë¶€ëª¨ ì°½ ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ');setTimeout(()=>{window.close();},300);}catch(e){console.warn('âš ï¸ íŒì—… ë¶€ëª¨ ì°½ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:',e);}}
if(window.parent&&window.parent!==window){console.log('ğŸ”” iframe - ë¶€ëª¨ ì°½ì— ë¡œê·¸ì¸ ì„±ê³µ ë©”ì‹œì§€ ì „ì†¡');try{window.parent.postMessage(messageData,'*');console.log('âœ… iframe ë¶€ëª¨ ì°½ ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ');}catch(e){console.warn('âš ï¸ iframe ë¶€ëª¨ ì°½ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:',e);}}
if(!window.opener&&window.parent===window){console.log('ğŸ”” ì¼ë°˜ í˜ì´ì§€ - ê´€ë¦¬ì ëª©ë¡ìœ¼ë¡œ ì´ë™');console.log('ğŸ“‹ ê´€ë¦¬ì ì •ë³´:',result.admin);setTimeout(()=>{console.log('ğŸš€ ê´€ë¦¬ì ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™ ì‹œì‘');console.log('ğŸ” í˜„ì¬ URL:',window.location.href);console.log('ğŸ” ì´ë™í•  URL: /secret/admin_list');window.location.replace('/secret/admin_list');},500);}
}else{console.warn('âš ï¸ ë¡œê·¸ì¸ ë¶ˆê°€ - ê³„ì • ìƒíƒœ:',adminStatus);let statusMessage='';if(adminStatus==='LOCKED'){statusMessage='âŒ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ëŠ” ê³„ì • ìƒíƒœì…ë‹ˆë‹¤.\nê³„ì • ìƒíƒœ: ì ê¹€(LOCKED)\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';}else if(adminStatus==='DELETED'){statusMessage='âŒ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ëŠ” ê³„ì • ìƒíƒœì…ë‹ˆë‹¤.\nê³„ì • ìƒíƒœ: ì‚­ì œë¨(DELETED)\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';}else{statusMessage=`âŒ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ëŠ” ê³„ì • ìƒíƒœì…ë‹ˆë‹¤.\nê³„ì • ìƒíƒœ:${adminStatus}\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.`;}
showError(statusMessage);if(typeof window.clearAdminSession==='function'){window.clearAdminSession();console.log('ğŸ”„ ê´€ë¦¬ì ì„¸ì…˜ ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” ì™„ë£Œ');}}}else{console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:',result.error);const errorMessage=result.error||'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';showError(errorMessage);if(typeof window.clearAdminSession==='function'){window.clearAdminSession();console.log('ğŸ”„ ê´€ë¦¬ì ì„¸ì…˜ ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” ì™„ë£Œ');}
if(errorMessage.includes('ID')||errorMessage.includes('ê´€ë¦¬ì')){document.querySelector('input[name="admin_id"]').focus();}else if(errorMessage.includes('ë¹„ë°€ë²ˆí˜¸')){document.querySelector('input[name="password"]').focus();}}}).catch((error)=>{console.error('âŒ ë¡œê·¸ì¸ ì—ëŸ¬:',error);console.error('âŒ ì—ëŸ¬ ìŠ¤íƒ:',error.stack);showError('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: '+error.message);});});