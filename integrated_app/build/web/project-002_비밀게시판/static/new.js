document.addEventListener('DOMContentLoaded',()=>{console.log('ðŸ” new.html íŽ˜ì´ì§€ ë¡œë“œ - ì„¸ì…˜ í™•ì¸');console.log('ðŸ“¦ window.MEMBER_SESSION:',window.MEMBER_SESSION);console.log('ðŸ” sessionStorage member_session:',sessionStorage.getItem('member_session'));if(!window.MEMBER_SESSION?.isLoggedIn){console.log('âš ï¸ ì„¸ì…˜ì´ ì—†ìŒ - ë³µì› ì‹œë„');window.restoreMemberSession();console.log('ðŸ“¦ ë³µì› í›„ MEMBER_SESSION:',window.MEMBER_SESSION);}
if(window.MEMBER_SESSION?.isLoggedIn){console.log('âœ… ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ë¨');console.log('ðŸ‘¤ íšŒì› ID:',window.MEMBER_SESSION.sMem_id);console.log('ðŸ‘¤ íšŒì› ì´ë¦„:',window.MEMBER_SESSION.sMem_name);}else{console.log('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - ê²Œì‹œê¸€ ìž‘ì„± ì‹œ sMember_idëŠ” nullì´ ë©ë‹ˆë‹¤');}});document.getElementById('ticketForm').addEventListener('submit',(e)=>{e.preventDefault();console.log('ðŸš€ MSSQLì— ìƒˆ ê²Œì‹œê¸€ ì €ìž¥ ì‹œìž‘...');const agreementCheckbox=document.getElementById('agreement');if(!agreementCheckbox.checked){alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë° ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');agreementCheckbox.focus();return;}
const formData=new FormData(e.target);const data=Object.fromEntries(formData);data.agreement=agreementCheckbox.checked?1:0;data.snsgu='A0001';console.log('ðŸ” ì „ì—­ ì„¸ì…˜ í™•ì¸:',window.MEMBER_SESSION);console.log('ðŸ” ë¡œê·¸ì¸ ì—¬ë¶€:',window.MEMBER_SESSION?.isLoggedIn);console.log('ðŸ” sMem_id ê°’:',window.MEMBER_SESSION?.sMem_id);data.sMember_id=window.MEMBER_SESSION?.sMem_id||null;console.log('ðŸ“ ì €ìž¥í•  ë°ì´í„°:',data);console.log('âœ… ê°œì¸ì •ë³´ ë™ì˜ ì—¬ë¶€:',data.agreement);console.log('ðŸ¢ snsgu ê°’:',data.snsgu);console.log('ðŸ‘¤ sMember_id ìµœì¢… ê°’:',data.sMember_id);fetch('/secret/api/v1/tickets/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data),}).then((res)=>{console.log('ðŸ“¡ ì €ìž¥ ì‘ë‹µ ìƒíƒœ:',res.status);console.log('ðŸ“¡ ì‘ë‹µ í—¤ë”:',res.headers);if(!res.ok){throw new Error(`HTTP ${res.status}:${res.statusText}`);}
return res.json();}).then((r)=>{console.log('âœ… ì„œë²„ ì‘ë‹µ:',r);if(r.ok){console.log('âœ… ì €ìž¥ ì„±ê³µ!');alert('ìƒë‹´ìš”ì²­ì´ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤.');location.href='/secret/';}else{console.error('âŒ ì €ìž¥ ì‹¤íŒ¨:',r.error);alert(`ì €ìž¥ ì‹¤íŒ¨:${r.error||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);}}).catch((error)=>{console.error('âŒ ì—°ê²° ì˜¤ë¥˜ ìƒì„¸:',error);console.error('âŒ ì˜¤ë¥˜ íƒ€ìž…:',typeof error);console.error('âŒ ì˜¤ë¥˜ ë©”ì‹œì§€:',error.message);console.error('âŒ ì „ì²´ ìŠ¤íƒ:',error.stack);alert(`ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜:${error.message||error}`);});});(function(){const openButtons=document.querySelectorAll('[data-open-modal]');const closeSelectors='[data-close-modal]';let lastFocused=null;function disableScroll(){document.body.dataset.prevOverflow=document.body.style.overflow||'';document.body.style.overflow='hidden';}
function enableScroll(){document.body.style.overflow=document.body.dataset.prevOverflow||'';delete document.body.dataset.prevOverflow;}
function trapFocus(modalEl){const focusable=modalEl.querySelectorAll('a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])');if(focusable.length)focusable[0].focus();}
function openModal(target){const backdrop=document.querySelector(target);if(!backdrop)return;lastFocused=document.activeElement;backdrop.setAttribute('aria-hidden','false');disableScroll();backdrop.addEventListener('mousedown',onBackdropMouseDown);document.addEventListener('keydown',onKeydown);setTimeout(()=>trapFocus(backdrop),0);}
function closeModal(backdrop){backdrop.setAttribute('aria-hidden','true');enableScroll();backdrop.removeEventListener('mousedown',onBackdropMouseDown);document.removeEventListener('keydown',onKeydown);if(lastFocused&&typeof lastFocused.focus==='function'){lastFocused.focus();}}
function onBackdropMouseDown(e){const backdrop=e.currentTarget;const dialog=backdrop.querySelector('.modal');const clickedInside=dialog.contains(e.target);if(!clickedInside)closeModal(backdrop);}
function onKeydown(e){if(e.key==='Escape'){const opened=document.querySelector('.modal-backdrop[aria-hidden="false"]');if(opened)closeModal(opened);}}
openButtons.forEach((btn)=>{btn.addEventListener('click',()=>{const target=btn.getAttribute('data-open-modal');openModal(target);});});document.querySelectorAll(closeSelectors).forEach((btn)=>{btn.addEventListener('click',(e)=>{const backdrop=e.target.closest('.modal-backdrop');if(backdrop)closeModal(backdrop);});});})();