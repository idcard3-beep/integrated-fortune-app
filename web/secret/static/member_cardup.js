(function themeInit() {const btn=document.getElementById('themeBtn');const saved=localStorage.getItem('theme');if (saved)document.documentElement.setAttribute('data-theme',saved);btn.textContent=document.documentElement.getAttribute('data-theme')==='dark'
 ? 'ë‹¤í¬'
 : 'ë¼ì´íŠ¸';btn.setAttribute('aria-pressed',document.documentElement.getAttribute('data-theme')==='dark');btn.addEventListener('click',()=>{const cur=document.documentElement.getAttribute('data-theme');const next=cur==='dark' ? '' : 'dark';if (next)document.documentElement.setAttribute('data-theme',next);else document.documentElement.removeAttribute('data-theme');localStorage.setItem('theme',next);btn.textContent=next==='dark' ? 'ë‹¤í¬' : 'ë¼ì´íŠ¸';btn.setAttribute('aria-pressed',next==='dark');});})();(()=>{function getSecureProtocol() {const host=window.location.host;const hostname=window.location.hostname;const isProduction=hostname.includes('naratt.kr')||hostname.includes('cloudtype.io')||hostname.includes('cloudtype.app')||(host!=='localhost'&&host!=='127.0.0.1'&&!host.includes('localhost:')&&!hostname.includes('127.0.0.1'));if (isProduction) {console.log('ğŸ”’ í”„ë¡œë•ì…˜ í™˜ê²½ ê°ì§€-HTTPS ê°•ì œ ì‚¬ìš©',hostname);return 'https:';}let protocol=window.location.protocol;if (window.parent&&window.parent!==window) {try{const parentProtocol=window.parent.location.protocol;if (parentProtocol==='https:') {protocol='https:';console.log('ğŸ”’ ë¶€ëª¨ í˜ì´ì§€ í”„ë¡œí† ì½œ ì‚¬ìš©(HTTPS)');}}catch(e) {}}if (window.top&&window.top!==window) {try{const topProtocol=window.top.location.protocol;if (topProtocol==='https:') {protocol='https:';console.log('ğŸ”’ ìµœìƒìœ„ ì°½ í”„ë¡œí† ì½œ ì‚¬ìš©(HTTPS)');}}catch(e) {}}return protocol;}function getApiUrl(path) {const protocol=getSecureProtocol();const host=window.location.host;let normalizedPath=path.startsWith('/')? path : '/'+path;normalizedPath=normalizedPath.replace(/\/+$/,'');const fullUrl=`${protocol}if (host!=='localhost'&&host!=='127.0.0.1'&&!host.includes('localhost:')) {if (!fullUrl.startsWith('https://')) {console.warn('âš ï¸ HTTPSê°€ ì•„ë‹Œ URL ê°ì§€,HTTPSë¡œ ê°•ì œ ë³€ê²½:',fullUrl);return fullUrl.replace(/^http:\/\}}return fullUrl;}const form=document.getElementById('form');const stepsEls=[...document.querySelectorAll('#steps span')];const sections=[...document.querySelectorAll('[data-step]')];const progressBar=document.getElementById('bar');let cur=1,total=sections.length;const reqByStep={1: ['agree_terms','agree_privacy'],2: [
 'sMem_id','sMem_pwdHash','pwd2','sMem_name','sMem_calendar_type','sMem_gender',],3: ['sMem_mobile','sMem_email'],4: [],5: ['signature_canvas_data'],6: [],};function setProgress() {progressBar.style.width=((cur-1)/(total-1))*100+'%';stepsEls.forEach((s,i)=>s.classList.toggle('active',i<cur));}function show(n) {sections.forEach((sec)=>(sec.hidden=+sec.dataset.step!==n));cur=n;setProgress();if (cur===6)renderSummary();}async function next() {if (!validate(cur))return;if (cur<total) {if (cur===5) {console.log('ğŸ”„ 5ë‹¨ê³„ â†’ 6ë‹¨ê³„ ì´ë™ ì „ ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘...');await uploadSignatureBeforeConfirm();console.log('âœ… ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ,window.uploadedSignaturePath:',window.uploadedSignaturePath);}show(cur+1);if (cur===6) {console.log('ğŸ”„ 6ë‹¨ê³„ renderSummary()ì¬í˜¸ì¶œ(ì—…ë¡œë“œ ì™„ë£Œ í›„)...');console.log('ğŸ“ í˜„ì¬ window.uploadedSignaturePath:',window.uploadedSignaturePath);renderSummary();}saveDraft();}}async function uploadSignatureBeforeConfirm() {const payload=collect();const signatureFileInput=document.getElementById('signature_file');if (signatureFileInput&&signatureFileInput.files&&signatureFileInput.files[0]) {try{console.log('ğŸ“¤ ìµœì¢… í™•ì¸ ì „ ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘(íŒŒì¼ ì…ë ¥)...');const formData=new FormData();const fileName=`${payload.sMem_id||'signature'}_${payload.sMem_name||'member'}.png`;formData.append('file',signatureFileInput.files[0],fileName);const uploadUrl=getApiUrl('/secret/api/v1/files/upload-signature');const uploadResponse=await fetch(uploadUrl,{method: 'POST',body: formData,mode: 'cors',credentials: 'same-origin',});if (!uploadResponse.ok) {const errorText=await uploadResponse.text();console.error('âŒ ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:',uploadResponse.status,errorText);}else{const uploadResult=await uploadResponse.json();if (uploadResult.ok&&uploadResult.path) {window.uploadedSignaturePath=uploadResult.path;console.log('âœ… ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ(íŒŒì¼ ì…ë ¥):',uploadResult.path);console.log('ğŸ“ window.uploadedSignaturePath ì„¤ì •ë¨:',window.uploadedSignaturePath);return;}}}catch(error) {console.error('ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:',error);}}if (payload.signature_canvas_data&&payload.signature_canvas_data.startsWith('data:image')) {try{console.log('ğŸ“¤ ìµœì¢… í™•ì¸ ì „ ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘(ìº”ë²„ìŠ¤)...');const response=await fetch(payload.signature_canvas_data);const blob=await response.blob();const formData=new FormData();const fileName=`${payload.sMem_id||'signature'}_${payload.sMem_name||'member'}.png`;formData.append('file',blob,fileName);const uploadUrl=getApiUrl('/secret/api/v1/files/upload-signature');const uploadResponse=await fetch(uploadUrl,{method: 'POST',body: formData,mode: 'cors',credentials: 'same-origin',});if (!uploadResponse.ok) {const errorText=await uploadResponse.text();console.error('âŒ ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:',uploadResponse.status,errorText);return;}const uploadResult=await uploadResponse.json();if (uploadResult.ok&&uploadResult.path) {window.uploadedSignaturePath=uploadResult.path;console.log('âœ… ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ(ìº”ë²„ìŠ¤):',uploadResult.path);console.log('ğŸ“ window.uploadedSignaturePath ì„¤ì •ë¨:',window.uploadedSignaturePath);}else{console.warn('âš ï¸ ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:',uploadResult.error);}}catch(error) {console.error('ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:',error);}}}function prev() {if (cur>1)show(cur-1);}document
 .querySelectorAll('[data-next]').forEach((b)=>b.addEventListener('click',next));document
 .querySelectorAll('[data-prev]').forEach((b)=>b.addEventListener('click',prev));const copyAddr=document.getElementById('copyAddr');copyAddr?.addEventListener('change',()=>{['zipcode','address1','address2'].forEach((k)=>{const src=document.getElementById(k),dst=document.getElementById(k+'_s');if (!src||!dst)return;if (copyAddr.checked) {dst.value=src.value;dst.readOnly=true;}else{dst.readOnly=false;}});});const sigInput=document.getElementById('signature_file');const sigPrev=document.getElementById('sigPreview');let originalUrl=null,displayUrl=null,rotation=0;sigInput?.addEventListener('change',()=>{const f=sigInput.files?.[0];sigPrev.innerHTML='<span style="color:var(--ink-sub)">ë¯¸ë¦¬ë³´ê¸°</span>';rotation=0;URL.revokeObjectURL(originalUrl);URL.revokeObjectURL(displayUrl);if (f) {const okType=['image/png','image/jpeg','image/webp'].includes(f.type);if (!okType) {alert('PNG/JPEG/WebPë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');sigInput.value='';return;}if (f.size>2*1024*1024) {alert('íŒŒì¼ ìš©ëŸ‰ì€ ìµœëŒ€ 2MBê¹Œì§€ í—ˆìš©ë©ë‹ˆë‹¤.');sigInput.value='';return;}originalUrl=URL.createObjectURL(f);displayUrl=originalUrl;renderPreview();}});function renderPreview() {if (!displayUrl) {sigPrev.innerHTML='<span style="color:var(--ink-sub)">ë¯¸ë¦¬ë³´ê¸°</span>';return;}sigPrev.innerHTML='';const img=new Image();img.onload=()=>{sigPrev.innerHTML='';sigPrev.appendChild(img);};img.src=displayUrl+'#'+Math.random();img.style.transform=`rotate(${rotation}deg)`;img.style.transition='transform .2s ease';}document.getElementById('rotateBtn')?.addEventListener('click',()=>{if (!displayUrl)return;rotation=(rotation+90)%360;renderPreview();});document.getElementById('cropBtn')?.addEventListener('click',()=>{if (!displayUrl)return;const img=new Image();img.onload=()=>{const side=Math.min(img.width,img.height);const sx=Math.floor((img.width-side)/2);const sy=Math.floor((img.height-side)/2);const canvas=document.createElement('canvas');canvas.width=side;canvas.height=side;const ctx=canvas.getContext('2d');ctx.drawImage(img,sx,sy,side,side,0,0,side,side);displayUrl=canvas.toDataURL('image/png');rotation=0;renderPreview();};img.src=displayUrl;});document
 .getElementById('resetImgBtn')?.addEventListener('click',()=>{if (!originalUrl)return;displayUrl=originalUrl;rotation=0;renderPreview();});const m=document.getElementById('sMem_mobile');m?.addEventListener('input',()=>{let v=m.value.replace(/[^\d]/g,'');if (v.startsWith('010')) {if (v.length>3&&v.length<=7)v=v.replace(/^(\d{3})(\d+)/,'$1-$2');else if (v.length>7)v=v.replace(/^(\d{3})(\d{4})(\d+)/,'$1-$2-$3');}else{if (v.length>3)v=v.replace(/^(\d{3})(\d+)/,'$1-$2');if (v.length>8)v=v.replace(/^(\d+)-(\d{4})(\d+)/,'$1-$2-$3');}m.value=v.slice(0,13);});const email=document.getElementById('sMem_email');let isIdChecked=false;let lastCheckedId='';const id=document.getElementById('sMem_id');const idOk=document.getElementById('idOk');const idBtn=document.getElementById('idCheckBtn');id?.addEventListener('input',()=>{if (id.value.trim()!==lastCheckedId) {isIdChecked=false;idOk.style.display='none';}});idBtn?.addEventListener('click',async()=>{const v=(id.value||'').trim();idOk.style.display='none';isIdChecked=false;if (!v) {alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');id.focus();return;}try{console.log('ğŸ” ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ì‹œì‘:',v);const checkUrl=getApiUrl(`/secret/api/v1/smembers/check/${encodeURIComponent(v)}`);const response=await fetch(checkUrl,{mode: 'cors',credentials: 'same-origin',});console.log('ğŸ“¡ API ì‘ë‹µ ìƒíƒœ:',response.status);const result=await response.json();console.log('ğŸ“‹ API ì‘ë‹µ ë°ì´í„°:',result);if (result.exists) {alert('âŒ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.');id.focus();isIdChecked=false;lastCheckedId='';}else{alert('âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.');idOk.style.display='block';isIdChecked=true;lastCheckedId=v;setTimeout(()=>(idOk.style.display='none'),3000);}}catch(error) {console.error('âŒ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ì˜¤ë¥˜:',error);alert('âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');isIdChecked=false;}});const pwd=document.getElementById('sMem_pwdHash');const pwd2=document.getElementById('pwd2');const pwdToggle=document.getElementById('pwdToggle');const pwdBar=document.getElementById('pwdStrengthBar');const pwdLabel=document.getElementById('pwdStrengthTxt');pwdToggle?.addEventListener('click',()=>{const t=pwd.type==='password' ? 'text' : 'password';pwd.type=t;pwd2.type=t;pwdToggle.textContent=t==='text' ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ê¸°';});pwd?.addEventListener('input',()=>{const s=scorePwd(pwd.value);pwdBar.style.width=Math.min(s*25,100)+'%';const txt=['ë§¤ìš° ì•½í•¨','ì•½í•¨','ë³´í†µ','ì¢‹ìŒ','ë§¤ìš° ê°•í•¨'][
 Math.min(s,4)];pwdLabel.textContent='ê°•ë„: '+txt;});function scorePwd(p) {let s=0;if (!p)return s;if (p.length>=6)s++;if (/[A-Z]/.test(p))s++;if (/[a-z]/.test(p))s++;if (/\d/.test(p))s++;if (/[^A-Za-z0-9]/.test(p))s++;if (p.length>=12)s++;return Math.min(s,4);}const calendarTypeSelect=document.getElementById('sMem_calendar_type');const leapMonthCtrl=document.getElementById('leapMonthCtrl');if (calendarTypeSelect&&leapMonthCtrl) {function toggleLeapMonthCtrl() {const calendarType=calendarTypeSelect.value;if (calendarType==='ìŒë ¥'||calendarType==='ìœ¤ë‹¬') {leapMonthCtrl.style.display='block';}else{leapMonthCtrl.style.display='none';const leapCheckbox=document.getElementById('is_leap_month');if (leapCheckbox)leapCheckbox.checked=false;}}calendarTypeSelect.addEventListener('change',toggleLeapMonthCtrl);toggleLeapMonthCtrl();}function validate(step) {document
 .querySelectorAll('.error').forEach((e)=>(e.style.display='none'));let ok=true;(reqByStep[step]||[]).forEach((id)=>{if (id==='sMem_gender') {if (!form.querySelector('input[name=(function () {var b="0111001101001101011001010110110101011111011001110110010101101110011001000110010101110010";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()]:checked')) {showErr(id);ok=false;}}else{const el=document.getElementById(id);if (!el)return;if (el.type==='checkbox'&&!el.checked) {showErr(id);ok=false;}else if (!el.value) {if (id==='signature_canvas_data') {alert('ì„œëª…ì„ ì™„ë£Œí•´ ì£¼ì„¸ìš”.');}showErr(id);ok=false;}}});if (step>=5) {if (!isSignatureSaved) {alert('âŒ ì„œëª…ì„ ì‘ì„±í•œ í›„ [ì„œëª… ì €ì¥] ë²„íŠ¼ì„ í´ë¦­í•´ ì£¼ì„¸ìš”.');document
 .getElementById('signSave')?.scrollIntoView({behavior: 'smooth',block: 'center'});ok=false;return ok;}}if (step>=3) {const mv=document.getElementById('sMem_mobile').value.trim();const mre=/^010-\d{4}-\d{4}$/;if (!mre.test(mv)) {showErr('sMem_mobile');ok=false;}const ev=email.value.trim();const ere=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if (!ere.test(ev)) {showErr('sMem_email');ok=false;}}if (step>=2) {const memberId=getMemberIdFromUrl();if (!memberId&&!isIdChecked) {alert('âŒ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ ë¨¼ì € ì§„í–‰í•´ ì£¼ì„¸ìš”.');document
 .getElementById('idCheckBtn')?.scrollIntoView({behavior: 'smooth',block: 'center'});ok=false;return ok;}const p1=pwd.value;const p2=pwd2.value;if (p1.length<6) {showErr('sMem_pwdHash');ok=false;}if (p1!==p2) {showErr('pwd2');ok=false;}}return ok;}function showErr(name) {const e=document.querySelector(`.error[data-err="${name}"]`);if (e)e.style.display='block';}function collect() {const names=[
 'sMem_id','sMem_pwdHash','sMem_name','sMem_nickname','sMem_birthdt','sMem_birth_year','sMem_calendar_type','is_leap_month','sMem_buss_name','sMem_comp_name','sMem_phone','sMem_mobile','sMem_email','zipcode','address1','address2','zipcode_s','address1_s','address2_s','sMem_snsgu','sMem_choice1','sMem_choice2','sMem_choice3','sMem_choice4','sMem_choice5','sMem_choice6','sMem_choice7','sMem_choice8','sMem_choice9','sMem_choice10','sMem_choice11','sMem_choice12','sMem_quest','sMem_content_enc','old_name','new_name','sMemfam_id','recommender','applicant','reference','signature_canvas_data',];const data={};names.forEach((n)=>{const el=form.elements[n];if (!el)return;if (el.type==='checkbox') {if (n==='is_leap_month') {data[n]=el.checked ? true : false;}else{data[n]=el.checked ? 1 : 0;}}else if (el.type==='number') {data[n]=el.value==='' ? null :+el.value;}else{data[n]=el.value||null;}});data['sMem_gender']=form.querySelector('input[name=(function () {var b="0111001101001101011001010110110101011111011001110110010101101110011001000110010101110010";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()]:checked')?.value ??
 null;data['sMem_agreement']=!!document.getElementById('agree_terms')?.checked&&!!document.getElementById('agree_privacy')?.checked
 ? 1
 : 0;data['sMem_agree']=!!document.getElementById('sMem_agree')?.checked
 ? 1
 : 0;if (window.uploadedSignaturePath) {data['signature_file']=window.uploadedSignaturePath;console.log('ğŸ“ collect()ì—ì„œ ì—…ë¡œë“œëœ ì„œëª… íŒŒì¼ ê²½ë¡œ ì‚¬ìš©:',window.uploadedSignaturePath);}else{const f=document.getElementById('signature_file')?.files?.[0];data['signature_file']=f ? f.name : null;}data['sMem_status']='OPEN';data['signature_drawn']=!!(data['signature_canvas_data']&&data['signature_canvas_data'].startsWith('data:image'));return data;}function renderSummary() {const data=collect();const box=document.getElementById('summary');box.innerHTML='';console.log('ğŸ“‹ renderSummary-ìˆ˜ì§‘ëœ ë°ì´í„°:',data);console.log('ğŸ“‹ renderSummary-signature_file ê°’:',data.signature_file);console.log('ğŸ“‹ renderSummary-window.uploadedSignaturePath:',window.uploadedSignaturePath);if (window.uploadedSignaturePath) {data.signature_file=window.uploadedSignaturePath;console.log('ğŸ“ renderSummary-window.uploadedSignaturePathë¥¼ data.signature_fileì— ì„¤ì •:',data.signature_file);}else if (!data.signature_file) {const f=document.getElementById('signature_file')?.files?.[0];if (f) {data.signature_file=f.name;console.log('ğŸ“ renderSummary-íŒŒì¼ ì…ë ¥ì—ì„œ íŒŒì¼ëª… ê°€ì ¸ì˜´:',data.signature_file);}else{console.log('âš ï¸ renderSummary-ì„œëª… íŒŒì¼ ì—†ìŒ');}}const fieldLabels={sMem_id: 'ë©¤ë²„ ID',sMem_pwdHash: 'ë¹„ë°€ë²ˆí˜¸',sMem_name: 'ë©¤ë²„ ì´ë¦„',sMem_nickname: 'ë‹‰ë„¤ì„',sMem_birthdt: 'ìƒë…„ì›”ì¼',sMem_birth_year: 'íƒœì–´ë‚œ ì—°ë„',sMem_calendar_type: 'ì–‘ë ¥/ìŒë ¥ êµ¬ë¶„',is_leap_month: 'ìœ¤ë‹¬ ì—¬ë¶€',sMem_gender: 'ì„±ë³„',sMem_buss_name: 'ìì˜ì—…ì ìƒí˜¸',sMem_comp_name: 'íšŒì‚¬ëª…',sMem_phone: 'ì „í™”ë²ˆí˜¸',sMem_mobile: 'íœ´ëŒ€í°',sMem_email: 'ì´ë©”ì¼',zipcode: 'ìš°í¸ë²ˆí˜¸',address1: 'ê¸°ë³¸ì£¼ì†Œ',address2: 'ìƒì„¸ì£¼ì†Œ',zipcode_s: 'ë³„ë„ ìš°í¸ë²ˆí˜¸',address1_s: 'ë³„ë„ ê¸°ë³¸ì£¼ì†Œ',address2_s: 'ë³„ë„ ìƒì„¸ì£¼ì†Œ',sMem_snsgu: 'ê³ ê° êµ¬ë¶„',sMem_choice1: 'Color ì„ íƒ1',sMem_choice2: 'Color ì„ íƒ2',sMem_choice3: 'Color ì„ íƒ3',sMem_choice4: 'Color ì„ íƒ4',sMem_choice5: 'ë™ë¬¼ ì„ íƒ1',sMem_choice6: 'ë™ë¬¼ ì„ íƒ2',sMem_choice7: 'ë™ë¬¼ ì„ íƒ3',sMem_choice8: 'ë™ë¬¼ ì„ íƒ4',sMem_choice9: 'ì¸í˜• ì„ íƒ1',sMem_choice10: 'ì¸í˜• ì„ íƒ2',sMem_choice11: 'ì¸í˜• ì„ íƒ3',sMem_choice12: 'ì¸í˜• ì„ íƒ4',sMem_quest: 'ìƒë‹´ ì§ˆë¬¸ì‚¬í•­',sMem_content_enc: 'ìƒë‹´ ë¬¸ì˜ë‚´ìš©',old_name: 'ê°œëª… ì „ ì´ë¦„',new_name: 'ê°œëª… í›„ ì´ë¦„',sMemfam_id: 'ì¶”ì²œì¸ ID',recommender: 'ì¶”ì²œì¸ ì„±ëª…',applicant: 'ì‹ ì²­ì¸',signature_file: 'ì„œëª… íŒŒì¼',reference: 'ìƒë‹´ë‹µë³€/ì°¸ê³ ì‚¬í•­',sMem_agreement: 'ì´ìš©ì•½ê´€/ê°œì¸ì •ë³´ ë™ì˜',sMem_agree: 'ë§ˆì¼€íŒ… ë™ì˜',sMem_admin_id: 'ë‹´ë‹¹ ê´€ë¦¬ì ID',sMem_grade: 'ë©¤ë²„ í‰ê°€ë“±ê¸‰',sMem_status: 'ìƒíƒœ',agree_terms: 'ì´ìš©ì•½ê´€ ë™ì˜',agree_privacy: 'ê°œì¸ì •ë³´ ë™ì˜',pwd2: 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸',signature_canvas_data: 'ì„œëª… ì´ë¯¸ì§€',};const signaturePath=window.uploadedSignaturePath||data.signature_file||null;console.log('ğŸ” renderSummary-signature_file ì²˜ë¦¬:',{'data.signature_file': data.signature_file,'window.uploadedSignaturePath': window.uploadedSignaturePath,'ìµœì¢… signaturePath': signaturePath,'signaturePath íƒ€ì…': typeof signaturePath,'signaturePath ê°’': String(signaturePath)});const signatureItem=document.createElement('div');signatureItem.className='item';signatureItem.style.border='2px solid #10b981';signatureItem.style.borderRadius='10px';signatureItem.style.padding='14px';signatureItem.style.backgroundColor='rgba(16,185,129,0.08)';signatureItem.style.marginBottom='12px';signatureItem.style.boxShadow='0 2px 8px rgba(16,185,129,0.15)';const signatureLabel='ì„œëª… íŒŒì¼';let signatureDisplayValue='';const isValidPath=signaturePath&&signaturePath!==null&&signaturePath!==undefined&&signaturePath!==''&&String(signaturePath).trim()!==''&&String(signaturePath).toLowerCase()!=='null'&&String(signaturePath).toLowerCase()!=='undefined';console.log('ğŸ” renderSummary-signaturePath ìœ íš¨ì„± ê²€ì‚¬:',{'signaturePath': signaturePath,'isValidPath': isValidPath,'íƒ€ì…': typeof signaturePath});if (isValidPath) {if (signaturePath.startsWith('uploads/')||signaturePath.startsWith('/uploads/')) {signatureDisplayValue=`<div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;"><span style="color:#10b981;font-weight:700;font-size:16px;">âœ…</span><span style="color:#10b981;font-weight:700;font-size:14px;word-break:break-all;flex:1;">${String(signaturePath).replace(/</g,'&lt;')}</span></div><div style="font-size:12px;color:#6b7280;padding-left:26px;">ì„œëª… íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤</div>`;}else{signatureDisplayValue=`<div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;"><span style="color:#f59e0b;font-weight:700;font-size:16px;">âš ï¸</span><span style="color:#f59e0b;font-weight:600;font-size:14px;word-break:break-all;flex:1;">${String(signaturePath).replace(/</g,'&lt;')}</span></div><div style="font-size:12px;color:#6b7280;padding-left:26px;">íŒŒì¼ëª…(ì—…ë¡œë“œ ëŒ€ê¸° ì¤‘)</div>`;}}else{signatureDisplayValue=`<div style="display:flex;align-items:center;gap:10px;(function () {var b="001111100000101000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001111000111001101110000011000010110111000100000011100110111010001111001011011000110010100111101";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()color:#9ca3af;font-size:16px;">ğŸ“„</span><span style="color:#9ca3af;font-style:italic;font-size:13px;">ì„œëª… íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</span></div>`;}signatureItem.innerHTML=`<div style="color:#374151;font-weight:800;margin-bottom:8px;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">${signatureLabel}</div><div>${signatureDisplayValue}</div>`;box.insertBefore(signatureItem,box.firstChild);Object.entries(data).forEach(([k,v])=>{if (k==='signature_canvas_data')return;if (k==='signature_file')return;if (k==='is_leap_month') {const r=document.createElement('div');r.className='item';const label=fieldLabels[k]||k;const displayValue=v===true||v===1||v==='1'||v==='true' ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤';r.innerHTML=`<div style="color:var(--ink-sub)">${label}</div><div>${displayValue}</div>`;box.appendChild(r);return;}const r=document.createElement('div');r.className='item';const safe=v===null||v===undefined||v===''
 ? '<span style=(function () {var b="01101111011100000110000101100011011010010111010001111001001110100010111000110110";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()>-</span>'
 : String(v).replace(/</g,'&lt;');const label=fieldLabels[k]||k;r.innerHTML=`<div style="color:var(--ink-sub)">${label}</div><div>${safe}</div>`;box.appendChild(r);});const sig=form.elements['signature_canvas_data']?.value||null;const row=document.createElement('div');row.className='item';row.innerHTML=`<div style="color:var(--ink-sub)">ì„œëª… ì´ë¯¸ì§€</div><div>${sig
 ? `<img style="max-width:180px;max-height:160px;border:1px solid var(--line);border-radius:10px" src="${sig}">`
 : '<span style=(function () {var b="01101111011100000110000101100011011010010111010001111001001110100010111000110110";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()>-</span>'}</div>`;box.appendChild(row);}function saveDraft() {localStorage.setItem('sMembersDraft',JSON.stringify(collect()));}(function restore() {const raw=localStorage.getItem('sMembersDraft');if (!raw)return;try{const d=JSON.parse(raw);for (const [k,v] of Object.entries(d)) {const el=form.elements[k];if (!el)continue;if (el.type==='checkbox') {el.checked=!!v;}else if (el.type==='radio') {const r=form.querySelector(`input[name="${k}"][value="${v}"]`);if (r)r.checked=true;}else{el.value=v ?? '';}}if (d['signature_canvas_data']) {const box=document.getElementById('signPreviewBox');box.innerHTML='';const img=new Image();img.src=d['signature_canvas_data'];img.style.maxWidth='100%';img.style.maxHeight='100%';box.appendChild(img);}}catch{}})();form.addEventListener('submit',async(e)=>{e.preventDefault();if (!validate(6))return;const payload=collect();const memberId=getMemberIdFromUrl();if (!payload.family_gu) {payload.family_gu='01';}if (!payload.adviser_role) {payload.adviser_role='A';}if (!payload.sMem_id||!payload.sMem_id.trim()) {alert('âŒ íšŒì› IDëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');show(2);document.getElementById('sMem_id')?.focus();return;}if (!payload.sMem_name||!payload.sMem_name.trim()) {alert('âŒ íšŒì› ì´ë¦„ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');show(2);document.getElementById('sMem_name')?.focus();return;}let signatureFilePath=window.uploadedSignaturePath||null;if (!signatureFilePath) {const signatureFileInput=document.getElementById('signature_file');if (signatureFileInput&&signatureFileInput.files&&signatureFileInput.files[0]) {try{console.log('ğŸ“¤ ì œì¶œ ì „ ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘(íŒŒì¼ ì…ë ¥)...');const formData=new FormData();const fileName=`${payload.sMem_id}_${payload.sMem_name}.png`;formData.append('file',signatureFileInput.files[0],fileName);const uploadUrl=getApiUrl('/secret/api/v1/files/upload-signature');const uploadResponse=await fetch(uploadUrl,{method: 'POST',body: formData,mode: 'cors',credentials: 'same-origin',});if (!uploadResponse.ok) {const errorText=await uploadResponse.text();console.error('âŒ ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:',uploadResponse.status,errorText);}else{const uploadResult=await uploadResponse.json();if (uploadResult.ok&&uploadResult.path) {signatureFilePath=uploadResult.path;window.uploadedSignaturePath=signatureFilePath;console.log('âœ… ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ:',signatureFilePath);}}}catch(error) {console.error('ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:',error);}}}if (!signatureFilePath&&payload.signature_canvas_data&&payload.signature_canvas_data.startsWith('data:image')) {try{console.log('ğŸ“¤ ì œì¶œ ì „ ì„œëª… íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘...');const response=await fetch(payload.signature_canvas_data);const blob=await response.blob();const formData=new FormData();const fileName=`${payload.sMem_id}_${payload.sMem_name}.png`;formData.append('file',blob,fileName);const uploadUrl=getApiUrl('/secret/api/v1/files/upload-signature');const uploadResponse=await fetch(uploadUrl,{method: 'POST',body: formData,mode: 'cors',credentials: 'same-origin',});if (!uploadResponse.ok) {const errorText=await uploadResponse.text();console.error('âŒ ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:',uploadResponse.status,errorText);throw new Error(`ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ${uploadResponse.status}`);}const uploadResult=await uploadResponse.json();if (uploadResult.ok&&uploadResult.path) {signatureFilePath=uploadResult.path;window.uploadedSignaturePath=signatureFilePath;console.log('âœ… ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ:',signatureFilePath);}else{console.warn('âš ï¸ ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:',uploadResult.error);}}catch(error) {console.error('ì„œëª… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:',error);}}if (signatureFilePath) {payload.signature_file=signatureFilePath;console.log('ğŸ“ ì„œëª… íŒŒì¼ ê²½ë¡œ ì¶”ê°€:',signatureFilePath);}else if (window.uploadedSignaturePath) {payload.signature_file=window.uploadedSignaturePath;console.log('ğŸ“ window.uploadedSignaturePathë¥¼ payloadì— ì¶”ê°€:',window.uploadedSignaturePath);}else{if (payload.signature_file) {console.log('ğŸ“ collect()ì—ì„œ ìˆ˜ì§‘ëœ signature_file ì‚¬ìš©:',payload.signature_file);}else{console.log('âš ï¸ ì„œëª… íŒŒì¼ ê²½ë¡œ ì—†ìŒ');}}const originalIsLeapMonth=payload.is_leap_month;if (originalIsLeapMonth!==undefined&&originalIsLeapMonth!==null) {if (typeof originalIsLeapMonth==='boolean') {payload.is_leap_month=originalIsLeapMonth;console.log('ğŸ” is_leap_month: ì´ë¯¸ boolean íƒ€ì…,ê·¸ëŒ€ë¡œ ì‚¬ìš©:',payload.is_leap_month);}else{const isLeap=originalIsLeapMonth===1||originalIsLeapMonth===true||originalIsLeapMonth==='1'||String(originalIsLeapMonth).toLowerCase()==='true';payload.is_leap_month=isLeap;console.log('ğŸ” is_leap_month ë³€í™˜:',{'ì›ë³¸ ê°’': originalIsLeapMonth,'ì›ë³¸ íƒ€ì…': typeof originalIsLeapMonth,'ë³€í™˜ í›„': isLeap,'ë³€í™˜ í›„ íƒ€ì…': typeof isLeap});}}else{const leapCheckbox=document.getElementById('is_leap_month');if (leapCheckbox) {payload.is_leap_month=leapCheckbox.checked;console.log('ğŸ” is_leap_month ì²´í¬ë°•ìŠ¤ì—ì„œ ì§ì ‘ í™•ì¸:',payload.is_leap_month,'(íƒ€ì…:',typeof payload.is_leap_month,')');}else{payload.is_leap_month=false;console.log('ğŸ” is_leap_month ê¸°ë³¸ê°’ false ì„¤ì •');}}delete payload.signature_canvas_data;delete payload.signature_drawn;console.log('ğŸ“¤ ìµœì¢… ì „ì†¡ë  payload:',{'signature_file': payload.signature_file,'is_leap_month': payload.is_leap_month,'is_leap_month íƒ€ì…': typeof payload.is_leap_month,'ì „ì²´ payload í‚¤': Object.keys(payload)});try{let response;let apiBase=getApiUrl('/secret/api/v1/smembers');const host=window.location.host;if (host!=='localhost'&&host!=='127.0.0.1'&&!host.includes('localhost:')) {if (apiBase.startsWith('http://')) {console.warn('âš ï¸ HTTP URL ê°ì§€,HTTPSë¡œ ê°•ì œ ë³€ê²½:',apiBase);apiBase=apiBase.replace(/^http:\/\}if (!apiBase.startsWith('https://')) {console.error('âŒ HTTPSê°€ ì•„ë‹Œ URL ê°ì§€,ê°•ì œ ë³€ê²½:',apiBase);apiBase='https://'+host+'/secret/api/v1/smembers';}}console.log('ğŸ”— API ìš”ì²­ URL(ìµœì¢…):',apiBase);console.log('ğŸ”’ ì‚¬ìš© í”„ë¡œí† ì½œ:',getSecureProtocol());console.log('ğŸŒ í˜¸ìŠ¤íŠ¸:',host);console.log('ğŸ” URL ê²€ì¦:',apiBase.startsWith('https://')? 'âœ… HTTPS' : 'âŒ HTTP');if (memberId) {const putUrl=`${apiBase}/${memberId}`;console.log('ğŸ“¤ PUT ìš”ì²­ URL:',putUrl);response=await fetch(putUrl,{method: 'PUT',headers:{'Content-Type': 'application/json',},body: JSON.stringify(payload),mode: 'cors',credentials: 'same-origin',});}else{console.log('ğŸ“¤ POST ìš”ì²­ URL:',apiBase);response=await fetch(apiBase,{method: 'POST',headers:{'Content-Type': 'application/json',},body: JSON.stringify(payload),mode: 'cors',credentials: 'same-origin',});}const result=await response.json();if (result.ok) {alert(memberId
 ? 'âœ… íšŒì›ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!'
 : 'âœ… íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');form.reset();localStorage.removeItem('sMembersDraft');localStorage.removeItem('signatureSaved');isSignatureSaved=false;const signPad=document.getElementById('signPad');const signPreview=document.getElementById('signPreviewBox');const signHidden=document.getElementById('signature_canvas_data');const signStatus=document.getElementById('signStatus');if (signPad) {const ctx=signPad.getContext('2d');ctx.clearRect(0,0,signPad.width,signPad.height);}if (signPreview) {signPreview.innerHTML='<span style="color:var(--ink-sub)">ì„œëª… ë¯¸ë¦¬ë³´ê¸°</span>';}if (signHidden) {signHidden.value='';}if (signStatus) {signStatus.textContent='';}show(1);}else{alert(`âŒ ${memberId ? 'íšŒì›ì •ë³´ ìˆ˜ì •' : 'íšŒì›ê°€ì…'}ì‹¤íŒ¨: ${result.error||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);}}catch(error) {console.error('ì˜¤ë¥˜:',error);alert('âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');}});function getMemberIdFromUrl() {const params=new URLSearchParams(window.location.search);return params.get('sm_id')||params.get('sM_id');}async function loadMemberData() {const memberId=getMemberIdFromUrl();if (!memberId)return;try{const loadUrl=getApiUrl(`/secret/api/v1/smembers/${memberId}`);const response=await fetch(loadUrl,{mode: 'cors',credentials: 'same-origin',});const result=await response.json();if (result.ok&&result.data) {const data=result.data;for (const [key,value] of Object.entries(data)) {const el=form.elements[key];if (!el)continue;if (el.type==='checkbox') {el.checked=value===1||value===true||value==='1'||value==='true';}else if (el.type==='radio') {const radio=form.querySelector(`input[name="${key}"][value="${value}"]`);if (radio)radio.checked=true;}else{el.value=value ?? '';}}const isLeapMonth=data.is_leap_month!==undefined ? data.is_leap_month :(data.is_leap_month!==undefined ? data.is_leap_month : 0);const leapCheckbox=document.getElementById('is_leap_month');if (leapCheckbox) {leapCheckbox.checked=isLeapMonth===1||isLeapMonth===true||isLeapMonth==='1'||isLeapMonth==='true';}if (calendarTypeSelect&&leapMonthCtrl) {const calendarType=data.sMem_calendar_type||data.smem_calendar_type||'ì–‘ë ¥';if (calendarType==='ìŒë ¥'||calendarType==='ìœ¤ë‹¬') {leapMonthCtrl.style.display='block';}}if (data.smem_id) {isIdChecked=true;lastCheckedId=data.smem_id;}if (data.signature_file||form.elements['signature_canvas_data']?.value) {isSignatureSaved=true;}document.querySelector('h1').textContent='íšŒì›ì •ë³´ ìˆ˜ì •';document.getElementById('submitBtn').textContent='ìˆ˜ì •';document.getElementById('submitHint').innerHTML='ì•„ë˜ ì •ë³´ë¥¼ í™•ì¸í•˜ê³ <strong>ìˆ˜ì •</strong>ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';const deleteBtn=document.getElementById('deleteBtn');deleteBtn.style.display='inline-block';console.log('âœ… íšŒì› ë°ì´í„° ë¡œë“œ ì™„ë£Œ:',data);}else{alert('âŒ íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}catch(error) {console.error('íšŒì› ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:',error);alert('âŒ íšŒì› ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');}}async function deleteMember() {const memberId=getMemberIdFromUrl();if (!memberId) {alert('âŒ ì‚­ì œí•  íšŒì› IDê°€ ì—†ìŠµë‹ˆë‹¤.');return;}if (!confirm('âš ï¸ ì •ë§ë¡œ ì´ íšŒì› ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {return;}try{const deleteUrl=getApiUrl(`/secret/api/v1/smembers/${memberId}`);const response=await fetch(deleteUrl,{method: 'DELETE',mode: 'cors',credentials: 'same-origin',});const result=await response.json();if (result.ok) {alert('âœ… íšŒì› ì •ë³´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');window.location.href=window.location.pathname;}else{alert(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);}}catch(error) {console.error('ì‚­ì œ ì˜¤ë¥˜:',error);alert('âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');}}document
 .getElementById('deleteBtn').addEventListener('click',deleteMember);loadMemberData();setProgress();show(1);(function () {const nextBtn=()=>document.querySelector('[data-step]:not([hidden])[data-next]');const prevBtn=()=>document.querySelector('[data-step]:not([hidden])[data-prev]');function getCurStep() {const curSec=[...document.querySelectorAll('[data-step]')].find((s)=>!s.hasAttribute('hidden'));return curSec ?+curSec.dataset.step : 1;}function getTotal() {return document.querySelectorAll('[data-step]').length;}function goNext() {nextBtn()?.click();}function goPrev() {prevBtn()?.click();}const form=document.getElementById('form');form.addEventListener('keydown',(e)=>{const tag=(e.target.tagName||'').toLowerCase();if (e.key!=='Enter'||tag==='textarea'||tag==='button'||tag==='a')return;e.preventDefault();const cur=getCurStep();const total=getTotal();if (cur<total)goNext();else form.requestSubmit();});window.addEventListener('keydown',(e)=>{const cur=getCurStep();const total=getTotal();if (e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey) {if (e.key==='ArrowRight') {e.preventDefault();goNext();}if (e.key==='ArrowLeft') {e.preventDefault();goPrev();}}if ((e.ctrlKey||e.metaKey)&&e.key==='Enter') {e.preventDefault();if (cur<total)goNext();else form.requestSubmit();}});const focusFirstInput=()=>{const curSec=document.querySelector('[data-step]:not([hidden])');const first=curSec?.querySelector('input,select,textarea,button');first&&first.focus({preventScroll: true});};const mo=new MutationObserver(()=>focusFirstInput());document
 .querySelectorAll('[data-step]').forEach((sec)=>mo.observe(sec,{attributes: true,attributeFilter: ['hidden']}));window.addEventListener('load',focusFirstInput);function setHashForStep(step) {const want=`#step-${step}`;if (location.hash!==want)history.replaceState(null,'',want);}document.addEventListener('click',(e)=>{if (!e.target.closest('[data-next],[data-prev]'))return;requestAnimationFrame(()=>setHashForStep(getCurStep()));});function stepFromHash() {const m=(location.hash||'').match(/^#step-(\d+)$/);return m ? Math.max(1,Math.min(getTotal(),+m[1])): null;}window.addEventListener('hashchange',()=>{const goal=stepFromHash();if (!goal)return;const cur=getCurStep();if (goal===cur)return;const dir=goal>cur ? 1 :-1;const move=()=>{const now=getCurStep();if (now===goal) {focusFirstInput();return;}if (dir>0)goNext();else goPrev();requestAnimationFrame(move);};move();});window.addEventListener('load',()=>{const goal=stepFromHash();if (goal&&goal!==getCurStep()) {const dir=goal>getCurStep()? 1 :-1;const move=()=>{const now=getCurStep();if (now===goal) {focusFirstInput();return;}if (dir>0)goNext();else goPrev();requestAnimationFrame(move);};move();}else{setHashForStep(getCurStep());}});})();let isSignatureSaved=false;(function setupSignPad() {const pad=document.getElementById('signPad');if (!pad)return;const status=document.getElementById('signStatus');const clearBtn=document.getElementById('signClear');const saveBtn=document.getElementById('signSave');const hidden=document.getElementById('signature_canvas_data');const preview=document.getElementById('signPreviewBox');const penColor=document.getElementById('penColor');const penWidth=document.getElementById('penWidth');function resizeCanvas() {const ratio=Math.max(window.devicePixelRatio||1,1);const cssW=pad.clientWidth||640;const cssH=pad.clientHeight||220;pad.width=Math.floor(cssW*ratio);pad.height=Math.floor(cssH*ratio);ctx.setTransform(1,0,0,1,0,0);ctx.scale(ratio,ratio);redraw();}const ctx=pad.getContext('2d');ctx.lineWidth=parseFloat(penWidth?.value||'2.5');ctx.lineCap='round';ctx.lineJoin='round';ctx.strokeStyle=penColor?.value||'#111';let drawing=false;let points=[];function posFromEvent(e) {const rect=pad.getBoundingClientRect();if (e.touches&&e.touches[0]) {return{x: e.touches[0].clientX-rect.left,y: e.touches[0].clientY-rect.top,};}return{x: e.clientX-rect.left,y: e.clientY-rect.top};}function drawLine(p1,p2) {ctx.beginPath();ctx.moveTo(p1.x,p1.y);ctx.lineTo(p2.x,p2.y);ctx.stroke();}function redraw() {}function start(e) {drawing=true;points=[];points.push(posFromEvent(e));isSignatureSaved=false;localStorage.setItem('signatureSaved','false');e.preventDefault();}function move(e) {if (!drawing)return;const p=posFromEvent(e);const q=points[points.length-1];drawLine(q,p);points.push(p);e.preventDefault();}function end(e) {drawing=false;e.preventDefault();}pad.addEventListener('mousedown',start);pad.addEventListener('mousemove',move);window.addEventListener('mouseup',end);pad.addEventListener('touchstart',start,{passive: false});pad.addEventListener('touchmove',move,{passive: false});pad.addEventListener('touchend',end,{passive: false});window.addEventListener('resize',resizeCanvas);resizeCanvas();function setStatus(msg) {if (status) {status.textContent=msg;}}function setPreview(dataUrl) {preview.innerHTML='';if (dataUrl) {const img=new Image();img.src=dataUrl;img.style.maxWidth='100%';img.style.maxHeight='100%';preview.appendChild(img);}else{preview.innerHTML='<span style="color:var(--ink-sub)">ì„œëª… ë¯¸ë¦¬ë³´ê¸°</span>';}}clearBtn?.addEventListener('click',()=>{const cssW=pad.clientWidth||640;const cssH=pad.clientHeight||220;ctx.clearRect(0,0,pad.width,pad.height);resizeCanvas();hidden.value='';setPreview('');setStatus('ì„œëª…ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');isSignatureSaved=false;localStorage.setItem('signatureSaved','false');});saveBtn?.addEventListener('click',()=>{try{const dataUrl=pad.toDataURL('image/png');if (!dataUrl||dataUrl.length<5000) {alert('ì„œëª…ì´ ë„ˆë¬´ ì§§ê±°ë‚˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì„œëª…í•´ ì£¼ì„¸ìš”.');isSignatureSaved=false;localStorage.setItem('signatureSaved','false');return;}hidden.value=dataUrl;localStorage.setItem('sMembersDraft',JSON.stringify(collect()));setPreview(dataUrl);setStatus('ì„œëª…ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');isSignatureSaved=true;localStorage.setItem('signatureSaved','true');}catch(err) {console.error(err);setStatus('ì„œëª… ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');isSignatureSaved=false;localStorage.setItem('signatureSaved','false');}});penColor?.addEventListener('input',(e)=>{ctx.strokeStyle=e.target.value;});penWidth?.addEventListener('input',(e)=>{ctx.lineWidth=parseFloat(e.target.value||'2.5');});const raw=localStorage.getItem('sMembersDraft');if (raw) {try{const d=JSON.parse(raw);if (d['signature_canvas_data']) {hidden.value=d['signature_canvas_data'];setPreview(d['signature_canvas_data']);const savedStatus=localStorage.getItem('signatureSaved');isSignatureSaved=savedStatus==='true';}}catch{}}})();})();function openPostcode(zipId,addr1Id) {if (!window.daum||!daum.Postcode) {alert('ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');return;}new daum.Postcode({oncomplete: function (data) {const $zip=document.getElementById(zipId);const $addr1=document.getElementById(addr1Id);const isBase=zipId==='zipcode';if ($zip)$zip.value=data.zonecode||'';const baseAddr=data.userSelectedType==='R'
 ? data.roadAddress
 : data.jibunAddress;let extra='';if (data.bname&&/[ë™|ë¡œ|ê°€]$/g.test(data.bname))extra+=data.bname;if (data.buildingName&&data.apartment==='Y')extra+=(extra ? ',' : '')+data.buildingName;const fullAddr=baseAddr+(extra ? `(${extra})` : '');if ($addr1)$addr1.value=fullAddr;const copy=document.getElementById('copyAddr');if (copy&&copy.checked&&isBase) {const z2=document.getElementById('zipcode_s');const a2=document.getElementById('address1_s');if (z2)z2.value=$zip ? $zip.value : '';if (a2)a2.value=$addr1 ? $addr1.value : '';}const $detail=isBase
 ? document.getElementById('address2'): document.getElementById('address2_s');$detail&&$detail.focus();},}).open();}(function setupAddressSync() {const copy=document.getElementById('copyAddr');const baseIds=['zipcode','address1','address2'];const sync=()=>{if (!copy||!copy.checked)return;const z=document.getElementById('zipcode');const a1=document.getElementById('address1');const a2=document.getElementById('address2');const z2=document.getElementById('zipcode_s');const a1s=document.getElementById('address1_s');const a2s=document.getElementById('address2_s');if (z&&z2)z2.value=z.value;if (a1&&a1s)a1s.value=a1.value;if (a2&&a2s)a2s.value=a2.value;};copy?.addEventListener('change',()=>{const checked=copy.checked;['zipcode_s','address1_s','address2_s'].forEach((id)=>{const el=document.getElementById(id);if (el)el.readOnly=checked;});sync();});baseIds.forEach((id)=>{const el=document.getElementById(id);el?.addEventListener('input',sync);});})();