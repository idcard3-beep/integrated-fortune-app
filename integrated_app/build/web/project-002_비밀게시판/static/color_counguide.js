const $=(s,p=document)=>p.querySelector(s);const $$=(s,p=document)=>[...p.querySelectorAll(s)];const themeBtn=$('#theme');const closeBtn=$('#close');const content=$('#content');const q=$('#q');const nav=$('#sidenav');const menuToggle=$('#menuToggle');const navLinks=$$('#navList a');let dark=false;themeBtn.addEventListener('click',()=>{dark=!dark;document.documentElement.setAttribute('data-theme',dark?'dark':'light');themeBtn.textContent='테마'+(dark?'(다크)':'(라이트)');});closeBtn.addEventListener('click',()=>{const hidden=content.classList.toggle('hidden');closeBtn.textContent=hidden?'열기':'닫기';});const pagecloseBtn=$('#closeBtn');if(pagecloseBtn){pagecloseBtn.addEventListener('click',()=>{if(window.self!==window.top){window.parent.postMessage('closeIframe','*');}else{window.close();}});}
menuToggle.addEventListener('click',()=>{nav.classList.toggle('hidden');});q.addEventListener('input',(e)=>{const term=e.target.value.trim().toLowerCase();const secs=$$('main section.card');if(!term){secs.forEach((s)=>(s.style.display=''));return;}
secs.forEach((s)=>{const hay=(s.dataset.section+' '+s.textContent).toLowerCase();s.style.display=hay.includes(term)?'':'none';});});const sections=$$('main section.card');const obs=new IntersectionObserver((entries)=>{entries.forEach((entry)=>{if(entry.isIntersecting){const id=entry.target.id;navLinks.forEach((a)=>{a.classList.toggle('active',a.dataset.target===id);});}});},{rootMargin:'-40% 0px -55% 0px',threshold:0.01});sections.forEach((sec)=>obs.observe(sec));navLinks.forEach((a)=>{a.addEventListener('click',()=>{if(window.innerWidth<=980){nav.classList.add('hidden');}});});document.addEventListener('keydown',(ev)=>{if(ev.key==='/'&&document.activeElement!==q){ev.preventDefault();q.focus();}
if((ev.ctrlKey||ev.metaKey)&&ev.key.toLowerCase()==='k'){ev.preventDefault();themeBtn.click();}});