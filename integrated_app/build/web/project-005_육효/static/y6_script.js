class IntegratedNajiaSystem{constructor(){this.hexagram=[];this.movingLines=[];this.currentPosition=0;this.consultationInfo={};this.najiaResult=null;this.currentSaju=null;this.initializeEventListeners();this.loadCurrentSaju();}
initializeEventListeners(){document.querySelectorAll('.coin-option').forEach((option)=>{option.addEventListener('click',()=>{const type=option.dataset.type;this.selectCoin(type);});});document.getElementById('resetBtn').addEventListener('click',()=>{this.resetHexagram();});document.getElementById('analyzeBtn').addEventListener('click',()=>{this.analyzeHexagram();});}
async loadCurrentSaju(){try{const response=await fetch('/y6/current-saju');if(!response.ok){console.error(`âŒ HTTP error!status:${response.status}`);const text=await response.text();console.error('âŒ Response:',text.substring(0,200));this.showSajuError(`ì„œë²„ ì˜¤ë¥˜:${response.status}`);return;}
const data=await response.json();if(data.success){this.currentSaju=data;this.displayCurrentSaju(data);}else{console.error('Saju loading failed:',data.error);this.showSajuError(data.error);}}catch(error){console.error('Network error:',error);this.showSajuError('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: '+error.message);}}
displayCurrentSaju(data){const{saju,formatted_time}=data;document.getElementById('currentTimeDisplay').innerHTML=`<h4 style="color: var(--saju-color); margin-bottom: 1rem;">ğŸ“… ${formatted_time}</h4><p style="font-size: 0.9rem; color: var(--text-secondary);">í˜„ì¬ ì‹œì ì˜ ì‚¬ì£¼ ê¸°ë‘¥ì´ ìë™ìœ¼ë¡œ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤</p>`;document.getElementById('yearPillar').textContent=saju.year;document.getElementById('monthPillar').textContent=saju.month;document.getElementById('dayPillar').textContent=saju.day;document.getElementById('hourPillar').textContent=saju.hour;document.getElementById('sajuTimeInfo').innerHTML=`<strong>í˜„ì¬ ì‹œê°:</strong>${formatted_time}<br><strong>ì ì‚¬ ì‹œì :</strong>${saju.info.birth}(${saju.info.time_type})<br><small style="color: var(--text-secondary);">ì´ ì‚¬ì£¼ ì •ë³´ê°€ ë‚©ê°‘ ê³„ì‚°ì— ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤</small>`;document.getElementById('sajuPillars').style.display='block';document.querySelector('.pillar-container').style.opacity='0';setTimeout(()=>{document.querySelector('.pillar-container').style.transition='opacity 0.5s ease';document.querySelector('.pillar-container').style.opacity='1';},100);}
showSajuError(error){document.getElementById('currentTimeDisplay').innerHTML=`<p style="color: var(--accent-color);">âŒ ì‚¬ì£¼ ë¡œë”© ì‹¤íŒ¨</p><p style="font-size: 0.8rem; color: var(--text-secondary);">${error}</p>`;}
selectCoin(type){if(this.currentPosition>=6)return;const lineSlot=document.querySelector(`[data-line="${this.currentPosition + 1}"]`);let number;let coinHTML='';switch(type){case'yang':number=7;lineSlot.className='line-slot filled yang-line';coinHTML='<div class="coin yang-coin mini-coin"><div class="coin-face"></div></div>';break;case'yin':number=8;lineSlot.className='line-slot filled yin-line';coinHTML='<div class="coin yin-coin mini-coin"><div class="coin-face"></div></div>';break;case'yang-moving':number=9;lineSlot.className='line-slot filled yang-moving-line';coinHTML='<div class="coin yang-moving-coin mini-coin"><div class="coin-face"></div></div>';this.movingLines.push(this.currentPosition);break;case'yin-moving':number=6;lineSlot.className='line-slot filled yin-moving-line';coinHTML='<div class="coin yin-moving-coin mini-coin"><div class="coin-face"></div></div>';this.movingLines.push(this.currentPosition);break;}
lineSlot.innerHTML=coinHTML;this.hexagram[this.currentPosition]=number;this.currentPosition++;this.updateCurrentLineDisplay();this.updateNajiaPreview();if(this.currentPosition>=6){document.getElementById('analyzeBtn').disabled=false;document.getElementById('currentLineText').textContent='ê´˜ ì™„ì„±! ë¶„ì„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';}}
async updateNajiaPreview(){if(!this.currentSaju||this.hexagram.length===0)return;try{const response=await fetch('/y6/calculate-najia',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({yao_input:this.hexagram.concat(Array(6-this.hexagram.length).fill(0)),yue_jian:this.currentSaju.month_branch,ri_gan:this.currentSaju.day_stem,ri_chen:this.currentSaju.day_branch,}),});const data=await response.json();if(data.success&&data.result.najia_info&&data.result.najia_info.length>0){for(let i=0;i<this.hexagram.length;i++){const lineSlot=document.querySelector(`[data-line="${i + 1}"]`);const najiaInfo=data.result.najia_info[i];if(lineSlot&&najiaInfo){const existingNajia=lineSlot.querySelector('.najia-label');if(existingNajia)existingNajia.remove();const najiaLabel=document.createElement('div');najiaLabel.className='najia-label';najiaLabel.textContent=najiaInfo['ì§€ì§€'];lineSlot.appendChild(najiaLabel);}}}}catch(error){console.error('Najia preview error:',error);}}
updateCurrentLineDisplay(){const lineNames=['ì´ˆíš¨','ì´íš¨','ì‚¼íš¨','ì‚¬íš¨','ì˜¤íš¨','ìƒíš¨'];if(this.currentPosition<6){const nextLine=lineNames[this.currentPosition];document.getElementById('currentLineText').textContent=`${nextLine}(${this.currentPosition+1}íš¨)`;}}
resetHexagram(){this.hexagram=[];this.movingLines=[];this.currentPosition=0;this.najiaResult=null;document.querySelectorAll('.line-slot').forEach((slot)=>{slot.className='line-slot';slot.innerHTML='';});document.getElementById('analyzeBtn').disabled=true;document.getElementById('currentLineText').textContent='ì´ˆíš¨ (1íš¨)';document.getElementById('analysisSection').style.display='none';}
async analyzeHexagram(){try{this.getConsultationInfo();if(!this.currentSaju){alert('ì‚¬ì£¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');return;}
const monthBranch=this.currentSaju.month_branch;const dayStem=this.currentSaju.day_stem;const dayBranch=this.currentSaju.day_branch;const response=await fetch('/y6/calculate-najia',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({yao_input:this.hexagram,yue_jian:monthBranch,ri_gan:dayStem,ri_chen:dayBranch,}),});const data=await response.json();if(data.success){this.najiaResult=data.result;this.displayNajiaResult();document.getElementById('analysisSection').style.display='block';document.getElementById('analysisSection').scrollIntoView({behavior:'smooth'});}else{alert(`ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:${data.error}`);}}catch(error){console.error('Analysis error:',error);alert(`ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:${error.message}`);}}
getConsultationInfo(){this.consultationInfo={questionType:document.getElementById('questionType').value||'ì¼ë°˜',question:document.getElementById('questionText').value||'ì „ë°˜ì ì¸ ìš´ì„¸',name:document.getElementById('consultantName').value||'',birthDate:document.getElementById('birthDate').value||'',time:new Date(),};}
displayNajiaResult(){document.getElementById('hexagramName').textContent=this.najiaResult.main_info;document.getElementById('hexagramMeaning').textContent=`ì ì‹œ:ì›”ê±´ ${this.najiaResult.base_info['ì›”ê±´']},ì¼ì§„ ${this.najiaResult.base_info['ì¼ì§„']},ì„¸íš¨:${this.najiaResult.base_info['ì„¸íš¨']}íš¨`;const resultContainer=document.getElementById('najiaResultContainer');resultContainer.innerHTML=`<div class="professional-najia-section"><h4>ğŸ“Š ì „ë¬¸ ë‚©ê°‘ ê³„ì‚° ê²°ê³¼</h4><div class="base-info"><p><strong>ê´˜ëª…:</strong>${this.najiaResult.main_info}</p><p><strong>ì ì‹œ:</strong>ì›”ê±´ ${this.najiaResult.base_info['ì›”ê±´']},ì¼ì§„ ${this.najiaResult.base_info['ì¼ì§„']}(í˜„ì¬ ì‹œê° ê¸°ì¤€)</p><p><strong>ì„¸íš¨ ìœ„ì¹˜:</strong>${this.najiaResult.base_info['ì„¸íš¨']}íš¨</p><p><strong>í˜„ì¬ ì‚¬ì£¼:</strong>${this.currentSaju.saju.year}${this.currentSaju.saju.month}${this.currentSaju.saju.day}${this.currentSaju.saju.hour}</p><p><strong>2ì§„ ì½”ë“œ:</strong>ë³¸ê´˜ ${this.najiaResult.base_info['ë³¸ê´˜ì½”ë“œ']}â†’ ë³€ê´˜ ${this.najiaResult.base_info['ë³€ê´˜ì½”ë“œ']}</p></div><!--íŠ¹ë³„ ê´˜ ë¶„ì„--><div class="special-hexagram-analysis"><h5>ğŸ”® íŠ¹ë³„ ê´˜ ë¶„ì„</h5><div class="special-hexagram-grid"><div class="original-special"><h6>ë³¸ê´˜ ë¶„ì„</h6><p><strong>ê´˜ìƒ:</strong>${this.formatTrigramDisplay(this.najiaResult.special_analysis?.original_trigrams||'ë¯¸ìƒ')}</p>${this.najiaResult.special_analysis?.original_type?`<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong><span class="special-type-badge ${
                                    this.najiaResult.special_analysis
                                      .original_type
                                  }">${this.najiaResult.special_analysis.original_type}</span></p><p class="special-meaning">${this.getSpecialMeaning(this.najiaResult.special_analysis.original_type,this.najiaResult.special_analysis.original_description)}</p>`:'<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong> ì¼ë°˜ê´˜</p>'}</div><div class="changing-special"><h6>ë³€ê´˜ ë¶„ì„</h6><p><strong>ê´˜ìƒ:</strong>${this.formatTrigramDisplay(this.najiaResult.special_analysis?.changing_trigrams||'ë¯¸ìƒ')}</p>${this.najiaResult.special_analysis?.changing_type?`<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong><span class="special-type-badge ${
                                    this.najiaResult.special_analysis
                                      .changing_type
                                  }">${this.najiaResult.special_analysis.changing_type}</span></p><p class="special-meaning">${this.getSpecialMeaning(this.najiaResult.special_analysis.changing_type,this.najiaResult.special_analysis.changing_description)}</p>`:'<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong> ì¼ë°˜ê´˜</p>'}</div></div></div><!--ê´˜ì‹  ë¶„ì„-->${this.najiaResult.gua_shen?`<div class="gua-shen-analysis"><h5>ğŸ”® ê´˜ì‹ (å¦èº«)ë¶„ì„</h5><div class="gua-shen-info"><div class="gua-shen-basic"><p><strong>ê´˜ì‹  ì§€ì§€:</strong>${this.najiaResult.gua_shen.ê´˜ì‹ ì§€ì§€}</p><p><strong>ê´˜ì‹  íš¨ìœ„:</strong>${this.najiaResult.gua_shen.ê´˜ì‹ íš¨ìœ„}íš¨</p><p><strong>ê´˜ì‹  ìœ¡ì¹œ:</strong><span class="six-kin-badge ${this.najiaResult.gua_shen.ê´˜ì‹ ìœ¡ì¹œ}">${this.najiaResult.gua_shen.ê´˜ì‹ ìœ¡ì¹œ}</span></p><p><strong>ê´˜ì‹  ì™•ì•½:</strong><span class="wang-shuai-badge ${this.najiaResult.gua_shen.ê´˜ì‹ ì™•ì•½}">${this.najiaResult.gua_shen.ê´˜ì‹ ì™•ì•½}</span></p></div><div class="gua-shen-meaning"><h6>ê´˜ì‹  ì˜ë¯¸</h6><p class="gua-shen-symbol">${this.najiaResult.gua_shen.ê´˜ì‹ ì˜ë¯¸}</p><h6>ê´˜ì‹  ì‘ìš©</h6><p class="gua-shen-effect">${this.najiaResult.gua_shen.ê´˜ì‹ ì‘ìš©}</p></div></div></div>`:`<div class="gua-shen-analysis"><h5>ğŸ”® ê´˜ì‹ (å¦èº«)ë¶„ì„</h5><p class="no-gua-shen">ì¼ì§„ ${this.najiaResult.base_info['ì¼ì§„'].charAt(1)}ê³¼ ìœ¡í•©í•˜ëŠ” ì§€ì§€ê°€ ê´˜ì— ì—†ì–´ ê´˜ì‹ ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`}<!--ê³µë§ ë¶„ì„--><div class="kong-wang-analysis"><h5>ğŸ•³ï¸ ê³µë§(ç©ºäº¡)ë¶„ì„</h5>${this.najiaResult.kong_wang&&this.najiaResult.kong_wang.ê³µë§ìˆ˜>0?`<div class="kong-wang-info"><div class="kong-wang-summary"><p><strong>ê³µë§ ì§€ì§€:</strong>${this.najiaResult.kong_wang.ê³µë§ì§€ì§€.join(', ')}</p><p><strong>ê³µë§ íš¨ ìˆ˜:</strong>${this.najiaResult.kong_wang.ê³µë§ìˆ˜}ê°œ</p></div><div class="kong-wang-details">${this.najiaResult.kong_wang.ê³µë§íš¨.map((kw)=>`<div class="kong-wang-yao"><span class="yao-position">${kw.íš¨ìœ„}íš¨</span><span class="kong-wang-branch">${kw.ì§€ì§€}</span><span class="kong-wang-kin">${kw.ìœ¡ì¹œ}</span><p class="kong-wang-meaning">${kw.ì˜ë¯¸}</p></div>`).join('')}</div></div>`:'<p class="no-kong-wang">í˜„ì¬ ê³µë§ì— í•´ë‹¹í•˜ëŠ” íš¨ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}</div><!--ë³µì‹  ë¶„ì„--><div class="fu-shen-analysis"><h5>ğŸ›¡ï¸ ë³µì‹ (ä¼ç¥)ë¶„ì„</h5>${this.najiaResult.fu_shen&&this.najiaResult.fu_shen.ë³µì‹ ìˆ˜>0?`<div class="fu-shen-info"><div class="fu-shen-summary"><p><strong>ì›”ê±´ ë³µì‹  ì§€ì§€:</strong>${this.najiaResult.fu_shen.ì›”ê±´ë³µì‹ ì§€ì§€.join(', ')}</p><p><strong>ë³µì‹  ìˆ˜:</strong>${this.najiaResult.fu_shen.ë³µì‹ ìˆ˜}ê°œ</p></div><div class="fu-shen-details">${this.najiaResult.fu_shen.ë³µì‹ ëª©ë¡.map((fs)=>`<div class="fu-shen-item"><span class="fu-shen-branch">${fs.ë³µì‹ ì§€ì§€}</span><span class="fu-shen-kin">${fs.ë³µì‹ ìœ¡ì¹œ}</span><p class="fu-shen-meaning">${fs.ë³µì‹ ì˜ë¯¸}</p><p class="fu-shen-action">${fs.ë³µì‹ ì‘ìš©}</p></div>`).join('')}</div></div>`:'<p class="no-fu-shen">í˜„ì¬ ë³µì‹ ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}</div><!--ë³€íš¨ ìƒì„¸ ë¶„ì„-->${this.najiaResult.changing_yao_detailed&&this.najiaResult.changing_yao_detailed.length>0?`<div class="changing-yao-detailed-analysis"><h5>ğŸ”„ ë³€íš¨ ìƒì„¸ ë¶„ì„</h5><div class="changing-yao-grid">${this.najiaResult.changing_yao_detailed.map((cyd)=>`<div class="changing-yao-item"><div class="yao-header"><h6>${cyd.íš¨ìœ„}íš¨ ë³€í™”</h6><span class="change-nature">${cyd.ë³€í™”ì„±ì§ˆ}</span></div><div class="yao-transformation"><div class="original-state"><span class="label">ì›ë˜</span><span class="branch">${cyd.ì›ì§€ì§€}</span><span class="kin">${cyd.ì›ìœ¡ì¹œ}</span></div><span class="arrow">â†’</span><div class="changed-state"><span class="label">ë³€í™”</span><span class="branch">${cyd.ë³€ì§€ì§€}</span><span class="kin">${cyd.ë³€ìœ¡ì¹œ}</span></div></div><p class="change-meaning">${cyd.ë³€íš¨ì˜ë¯¸}</p></div>`).join('')}</div></div>`:''}<table class="professional-najia-table"><thead><tr><th>ìœ¡ì‹ </th><th>ë“ê´˜</th><th>ìœ¡ì¹œ</th><th>ë‚©ê°‘ ì§€ì§€</th><th>íš¨ìœ„</th><th>ì›”ê±´ ê°•ì•½</th><th>ì¼ì§„ ê´€ê³„</th><th>ë³€íš¨</th></tr></thead><tbody>${this.generateTableRows()}</tbody></table></div><!--10ë‹¨ê³„ ì¢…í•© ë¶„ì„(í•„ìˆ˜)--><div class="comprehensive-analysis-section"><h3>ğŸ”® 10ë‹¨ê³„ ì¢…í•© ë¶„ì„</h3><div class="analysis-steps">${this.generateComprehensiveAnalysis()}</div></div><div class="saju-integration-note"style="background: #f0f9ff; border: 2px solid var(--saju-color); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-top: var(--spacing-lg);"><h4 style="color: var(--saju-color); margin-bottom: var(--spacing-md);">ğŸ¯ ì‚¬ì£¼ ì—°ê³„ ë¶„ì„</h4><div class="saju-najia-connection"><p><strong>ì ì‚¬ ì‹œê°„ê³¼ ì‚¬ì£¼ì˜ ì—°ê´€ì„±:</strong></p><ul style="margin: var(--spacing-md) 0; padding-left: var(--spacing-lg);"><li><strong>ì›”ê±´(${this.najiaResult.base_info['ì›”ê±´']}):</strong>í˜„ì¬ ${this.currentSaju.saju.month}ì›”ì£¼ì—ì„œ ì¶”ì¶œ</li><li><strong>ì¼ê°„(${this.najiaResult.base_info['ì¼ì§„'].charAt(0)}):</strong>í˜„ì¬ ${this.currentSaju.saju.day}ì¼ì£¼ì—ì„œ ì¶”ì¶œ</li><li><strong>ì¼ì§€(${this.najiaResult.base_info['ì¼ì§„'].charAt(1)}):</strong>í˜„ì¬ ${this.currentSaju.saju.day}ì¼ì£¼ì—ì„œ ì¶”ì¶œ</li><li><strong>ì‹œê°„:</strong>${this.currentSaju.formatted_time}(${this.currentSaju.saju.hour}ì‹œì£¼)</li></ul><p class="integration-explanation"style="background: var(--surface); padding: var(--spacing-md); border-radius: var(--radius-sm); border-left: 4px solid var(--saju-color); font-style: italic;">í˜„ì¬ ì‹œì ì˜ ì‚¬ì£¼ê°€ ìë™ìœ¼ë¡œ ë‚©ê°‘ ê³„ì‚°ì— ë°˜ì˜ë˜ì–´ ì •í™•í•œ ì›”ê±´ ê°•ì•½ê³¼ ì¼ì§„ ê´€ê³„ë¥¼ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.ì´ëŠ” ì „í†µ ìœ¡íš¨í•™ì˜ ì •ë²•ì— ë”°ë¥¸ ê²ƒìœ¼ë¡œ,ì ì‚¬í•˜ëŠ” ìˆœê°„ì˜ ì‹œê°„ì  ì—ë„ˆì§€ê°€ ê´˜ì˜ í•´ì„ì— ì¤‘ìš”í•œ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.</p></div></div>`;this.displayNajiaInHexagramArea();}
displayNajiaInHexagramArea(){if(!this.najiaResult||!this.najiaResult.hexagram)return;this.najiaResult.hexagram.forEach((yao,index)=>{const lineNumber=6-index;const lineSlot=document.querySelector(`.line-slot[data-line="${lineNumber}"]`);if(lineSlot){const container=lineSlot.parentElement;const extraSlots=container.querySelectorAll('.extra-slot');const isMoving=yao.note.includes('å‹•');const isKongWang=this.najiaResult.kong_wang&&this.najiaResult.kong_wang.ê³µë§ì§€ì§€.includes(yao.branch);const kongWangMarker=isKongWang?'â—':'';const originalYaoValue=this.hexagram[5-index];let changingInfo=yao.changing_info;if(isMoving&&this.najiaResult.changing_yao_detailed){const changingDetail=this.najiaResult.changing_yao_detailed.find((cyd)=>cyd.íš¨ìœ„===yao.yao_pos);if(changingDetail){changingInfo=`ì›:${changingDetail.ì›ì§€ì§€}${changingDetail.ì›ìœ¡ì¹œ}â†’ ë³€:${changingDetail.ë³€ì§€ì§€}${changingDetail.ë³€ìœ¡ì¹œ}(${changingDetail.ë³€ì™•ì•½})`;}}
if(extraSlots.length>=11){extraSlots[0].textContent=yao.spirit;extraSlots[0].style.fontWeight='normal';extraSlots[0].style.color='#333';extraSlots[0].style.fontSize='0.75rem';const statusText=isMoving?`${yao.status}${yao.note}`:`${yao.status}${yao.note}`;extraSlots[1].textContent=statusText;extraSlots[1].style.fontSize='0.7rem';extraSlots[1].style.fontWeight=isMoving?'bold':'normal';extraSlots[1].style.color='#333';extraSlots[2].textContent=yao.six_kin;extraSlots[2].style.fontWeight='bold';extraSlots[2].style.color='#333';extraSlots[2].style.fontSize='0.8rem';extraSlots[3].innerHTML=yao.branch+
(isKongWang?'<span class="kong-wang-marker">â—</span>':'');extraSlots[3].style.fontWeight='600';extraSlots[3].style.color='var(--primary-color)';extraSlots[3].style.fontSize='0.9rem';extraSlots[4].textContent=`${yao.yao_pos}íš¨${yao.note?' '+yao.note:''}${kongWangMarker?' '+kongWangMarker:''}`;extraSlots[4].style.fontSize='0.75rem';extraSlots[4].style.fontWeight='normal';extraSlots[4].style.color='#333';extraSlots[5].textContent=yao.wang_shuai;extraSlots[5].style.fontWeight='normal';extraSlots[5].style.color='#333';extraSlots[5].style.fontSize='0.75rem';extraSlots[6].textContent=yao.day_relation;extraSlots[6].style.fontSize='0.75rem';extraSlots[6].style.fontWeight='normal';extraSlots[6].style.color='#333';extraSlots[7].textContent=changingInfo;extraSlots[7].style.fontSize='0.65rem';extraSlots[7].style.fontWeight='normal';extraSlots[7].style.color='#666';extraSlots[7].style.whiteSpace='nowrap';extraSlots[7].style.overflow='hidden';extraSlots[7].style.textOverflow='ellipsis';}}});}
formatTrigramDisplay(trigramInfo){const matches=trigramInfo.match(/([^(]*)\(([^)]*)\)\s*\+\s*([^(]*)\(([^)]*)\)/);if(matches){const upperName=matches[1].trim();const upperSymbol=matches[2];const lowerName=matches[3].trim();const lowerSymbol=matches[4];return`<div class="trigram-stack"><div class="upper-trigram">${upperSymbol}<span class="trigram-name">${upperName}</span></div><div class="lower-trigram">${lowerSymbol}<span class="trigram-name">${lowerName}</span></div></div>`;}
return trigramInfo;}
generateTableRows(){}
generateComprehensiveAnalysis(){return`<div class="analysis-step"><h4>ğŸ” 1ë‹¨ê³„:ê¸°ë³¸ ê´˜ êµ¬ì¡°</h4><div class="step-content">${this.displayCompleteHexagramNumbers()}</div></div><div class="analysis-step"><h4>ğŸ‘ï¸ 2ë‹¨ê³„:ìœ¡ì‹  íŒì •&ë‚©ê°‘ ë¶„ì„</h4><div class="step-content">${this.generateNajiaAnalysisSummary()}
${this.analyzeLinePositions()}</div></div><div class="analysis-step"><h4>âš¡ 3ë‹¨ê³„:ê°•ì•½ ë¶„ì„</h4><div class="step-content">${this.analyzeStrengthWeakness()}
${this.analyzeMovingLinesStrength()}</div></div><div class="analysis-step"><h4>ğŸ”„ 4ë‹¨ê³„:ë™íš¨ì™€ ë³€ê´˜</h4><div class="step-content">${this.analyzeHexagramTransformation()}
${this.analyzeMovingLinesEffect()}
${this.analyzeHexagramChange()}</div></div><div class="analysis-step"><h4>ğŸ¤ 5ë‹¨ê³„:ìš©ì‹ /ê¸°ì‹ /ì›ì‹ </h4><div class="step-content">${this.analyzeHelpingHinderingSpirits()}</div></div><div class="analysis-step"><h4>ğŸ‘» 6ë‹¨ê³„:ë³µì‹ ê³¼ ê³µë§</h4><div class="step-content">${this.analyzeHiddenSpiritsAndVoid()}</div></div><div class="analysis-step"><h4>âš–ï¸ 7ë‹¨ê³„:ì„¸ì‘ ê´€ê³„</h4><div class="step-content">${this.analyzeWorldResponseRelation()}</div></div><div class="analysis-step"><h4>â° 8ë‹¨ê³„:ì‘ê¸° ì˜ˆì¸¡</h4><div class="step-content">${this.predictTiming()}</div></div><div class="analysis-step"><h4>âš–ï¸ 9ë‹¨ê³„:ì¢…í•© íŒë‹¨</h4><div class="step-content">${this.generateJudgmentChecklist()}
${this.makeFinalJudgment()}</div></div><div class="analysis-step"><h4>ğŸ’¡ 10ë‹¨ê³„:ìƒë‹´ ë° ì¡°ì–¸</h4><div class="step-content">${this.generateFinalAdvice()}</div></div>`;}
displayCompleteHexagramNumbers(){let html='<div class="complete-hexagram-display">';html+='<h5>ì™„ì „í•œ ê´˜ êµ¬ì¡° (ë³¸ê´˜ â†’ ë³€ê´˜)</h5>';html+='<div class="hexagram-comparison">';html+='<div class="original-hexagram">';html+='<h6>ë³¸ê´˜ (åŸå¦)</h6>';html+='<div class="hexagram-numbers-grid">';for(let i=5;i>=0;i--){const yao=this.hexagram[i];const lineInfo=this.getLineInfo(yao);const isMoving=[6,9].includes(yao);const binaryValue=[7,9].includes(yao)?'1':'0';const koreanPosition=['ì´ˆíš¨','ì´íš¨','ì‚¼íš¨','ì‚¬íš¨','ì˜¤íš¨','ìƒíš¨'][i];let coinHTML='';switch(yao){case 7:coinHTML='<div class="coin yang-coin mini-coin"><div class="coin-face"></div></div>';break;case 8:coinHTML='<div class="coin yin-coin mini-coin"><div class="coin-face"></div></div>';break;case 9:coinHTML='<div class="coin yang-moving-coin mini-coin"><div class="coin-face"></div></div>';break;case 6:coinHTML='<div class="coin yin-moving-coin mini-coin"><div class="coin-face"></div></div>';break;}
html+=`<div class="hexagram-line-display ${isMoving ? 'moving' : ''}"><span class="line-label">${koreanPosition}</span>${coinHTML}<div class="line-visual ${this.getLineVisualClass(
                      yao
                    )}"></div><span class="line-number-badge ${
                      isMoving ? 'moving' : ''
                    }">${yao}</span><span class="line-binary">${binaryValue}</span><span class="line-description">${lineInfo}</span></div>`;}
html+='</div>';html+=`<p><strong>ë³¸ê´˜ ì´ì§„:</strong>${this.hexagram.map((y)=>([7,9].includes(y)?'1':'0')).reverse().join('')}</p>`;html+='</div>';const movingLines=this.hexagram.filter((yao,index)=>[6,9].includes(yao));if(movingLines.length>0){html+='<div class="arrow-divider">â†’</div>';html+='<div class="changing-hexagram">';html+='<h6>ë³€ê´˜ (è®Šå¦)</h6>';html+='<div class="hexagram-numbers-grid">';for(let i=5;i>=0;i--){const originalYao=this.hexagram[i];const isMoving=[6,9].includes(originalYao);let changedYao=originalYao;if(isMoving){changedYao=originalYao===6?7:originalYao===9?8:originalYao;}
const lineInfo=this.getLineInfo(changedYao);const binaryValue=[7,9].includes(changedYao)?'1':'0';const koreanPosition=['ì´ˆíš¨','ì´íš¨','ì‚¼íš¨','ì‚¬íš¨','ì˜¤íš¨','ìƒíš¨'][i];let coinHTML='';switch(changedYao){case 7:coinHTML='<div class="coin yang-coin mini-coin"><div class="coin-face"></div></div>';break;case 8:coinHTML='<div class="coin yin-coin mini-coin"><div class="coin-face"></div></div>';break;case 9:coinHTML='<div class="coin yang-moving-coin mini-coin"><div class="coin-face"></div></div>';break;case 6:coinHTML='<div class="coin yin-moving-coin mini-coin"><div class="coin-face"></div></div>';break;}
html+=`<div class="hexagram-line-display ${
                      isMoving ? 'changed' : ''
                    }"><span class="line-label">${koreanPosition}</span>${coinHTML}<div class="line-visual ${this.getLineVisualClass(
                          changedYao
                        )}"></div><span class="line-number-badge ${
                          isMoving ? 'changed' : ''
                        }">${changedYao}</span><span class="line-binary">${binaryValue}</span><span class="line-description">${lineInfo}</span>${isMoving?'<span class="change-indicator">è®Š</span>':''}</div>`;}
html+='</div>';const changingBinary=this.hexagram.map((yao,index)=>{if([6,9].includes(yao)){return yao===6?'1':'0';}
return[7,9].includes(yao)?'1':'0';}).reverse().join('');html+=`<p><strong>ë³€ê´˜ ì´ì§„:</strong>${changingBinary}</p>`;html+='</div>';}
html+='</div>';html+='</div>';return html;}
generateNajiaAnalysisSummary(){const worldLine=this.najiaResult.hexagram.find((line)=>line.note.includes('ä¸–'));const movingLines=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•'));let html='<div class="najia-summary">';html+='<div class="world-line-info">';html+='<h6>ì„¸íš¨ ë¶„ì„</h6>';if(worldLine){html+=`<p>ìœ„ì¹˜:${worldLine.yao_pos}íš¨</p>`;html+=`<p>ìœ¡ì¹œ:${worldLine.six_kin}</p>`;html+=`<p>ì§€ì§€:${worldLine.branch}</p>`;html+=`<p>ê°•ì•½:${worldLine.wang_shuai}</p>`;html+=`<p>ì¼ì§„ê´€ê³„:${worldLine.day_relation}</p>`;}
html+='</div>';html+='<div class="moving-lines-info">';html+='<h6>ë™íš¨ ìš”ì•½</h6>';html+=`<p>ë™íš¨ ê°œìˆ˜:${movingLines.length}ê°œ</p>`;movingLines.forEach((line)=>{html+=`<div class="moving-line-item">`;html+=`${line.yao_pos}íš¨ ${line.status}â†’ ${line.changing_info}`;html+=`</div>`;});html+='</div>';html+='<div class="strength-summary">';html+='<h6>ê°•ì•½ ìš”ì•½</h6>';const wangLines=this.najiaResult.hexagram.filter((l)=>l.wang_shuai==='æ—º').length;const xiangLines=this.najiaResult.hexagram.filter((l)=>l.wang_shuai==='ç›¸').length;const xiuLines=this.najiaResult.hexagram.filter((l)=>l.wang_shuai==='ä¼‘').length;const qiuLines=this.najiaResult.hexagram.filter((l)=>l.wang_shuai==='å›š').length;const siLines=this.najiaResult.hexagram.filter((l)=>l.wang_shuai==='æ­»').length;html+=`<p>ì™•:${wangLines}ê°œ,ìƒ:${xiangLines}ê°œ,íœ´:${xiuLines}ê°œ,ìˆ˜:${qiuLines}ê°œ,ì‚¬:${siLines}ê°œ</p>`;html+='</div>';html+='</div>';return html;}
analyzeLinePositions(){let html='<div class="line-positions-grid">';this.najiaResult.hexagram.forEach((line,index)=>{const isMoving=line.note.includes('å‹•');const positionMeaning=this.getPositionMeaning(line.yao_pos);const binaryValue=[7,9].includes(line.status)?'1':'0';const originalYaoValue=this.hexagram[5-index];let coinHTML='';switch(originalYaoValue){case 7:coinHTML='<div class="coin yang-coin mini-coin"><div class="coin-face"></div></div>';break;case 8:coinHTML='<div class="coin yin-coin mini-coin"><div class="coin-face"></div></div>';break;case 9:coinHTML='<div class="coin yang-moving-coin mini-coin"><div class="coin-face"></div></div>';break;case 6:coinHTML='<div class="coin yin-moving-coin mini-coin"><div class="coin-face"></div></div>';break;}
html+=`<div class="line-position-analysis ${
                  isMoving ? 'moving-line' : ''
                }"><div class="line-header">${coinHTML}<span class="position-name">${line.yao_pos}íš¨</span><span class="line-number-large">${line.status}</span><span class="${
                          isMoving ? 'moving-badge' : 'static-badge'
                        }">${isMoving?'å‹•':'éœ'}</span></div><p><strong>ì˜ë¯¸:</strong>${positionMeaning}</p><p><strong>ì´ì§„:</strong>${binaryValue}|<strong>ìœ¡ì¹œ:</strong>${line.six_kin}</p><p><strong>ì§€ì§€:</strong>${line.branch}(${line.wang_shuai})</p></div>`;});html+='</div>';return html;}
analyzeStrengthWeakness(){let html='<div class="strength-analysis">';html+='<h6>ê° íš¨ì˜ ì™•ìƒíœ´ìˆ˜ì‚¬ ë¶„ì„</h6>';this.najiaResult.hexagram.forEach((line)=>{const description=this.getStrengthDescription(line.wang_shuai);html+=`<p><strong>${line.yao_pos}íš¨ ${line.branch}:</strong>${line.wang_shuai}-${description}</p>`;});html+='</div>';return html;}
analyzeMovingLinesStrength(){const movingLines=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•'));if(movingLines.length===0)return'<p>ë™íš¨ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';let html='<div class="moving-strength-analysis">';html+='<h6>ë™íš¨ ê°•ì•½ íŠ¹ë³„ ë¶„ì„</h6>';movingLines.forEach((line)=>{const strength=line.wang_shuai;let analysis='';if(strength==='æ—º'||strength==='ç›¸'){analysis='ë™íš¨ê°€ ê°•í•˜ë¯€ë¡œ ë³€í™”ì˜ í˜ì´ í½ë‹ˆë‹¤.';}else if(strength==='ä¼‘'){analysis='ë™íš¨ê°€ ì¤‘ê°„ ì •ë„ì´ë¯€ë¡œ ë³€í™”ê°€ ì ì§„ì ì…ë‹ˆë‹¤.';}else{analysis='ë™íš¨ê°€ ì•½í•˜ë¯€ë¡œ ë³€í™”ì˜ í˜ì´ ì œí•œì ì…ë‹ˆë‹¤.';}
html+=`<p><strong>${line.yao_pos}íš¨:</strong>${analysis}</p>`;});html+='</div>';return html;}
analyzeHexagramTransformation(){const originalCode=this.hexagram.map((y)=>([7,9].includes(y)?'1':'0')).reverse().join('');const changingCode=this.getChangingHexagramCode();const originalInfo=this.najiaResult.special_analysis?.original_trigrams||'ë¯¸ìƒ';const changingInfo=this.najiaResult.special_analysis?.changing_trigrams||'ë¯¸ìƒ';const originalType=this.najiaResult.special_analysis?.original_type||null;const changingType=this.najiaResult.special_analysis?.changing_type||null;return`<div class="hexagram-transformation-analysis"><div class="hexagram-comparison"><div class="original-hexagram-section"><h6>ğŸ“¿ ë³¸ê´˜</h6><div class="hexagram-display">${this.generateCoinDisplay(this.hexagram,'ë³¸ê´˜')}</div><div class="hexagram-details"><p><strong>ê´˜ëª…:</strong>${this.najiaResult.main_info.split('ä¹‹')[0].trim()}</p><p><strong>2ì§„ ì½”ë“œ:</strong>${originalCode}</p><p><strong>ê´˜ìƒ:</strong>${this.formatTrigramDisplay(originalInfo)}</p>${originalType?`<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong><span class="special-type-badge ${originalType}">${originalType}</span></p><p class="special-meaning">${this.getSpecialMeaning(originalType,this.najiaResult.special_analysis.original_description)}</p>`:'<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong> ì¼ë°˜ê´˜</p>'}</div></div><div class="transformation-arrow"><div class="arrow-container"><span class="arrow-symbol">â†’</span><span class="arrow-label">ë³€í™”</span></div></div><div class="changing-hexagram-section"><h6>ğŸ“¿ ë³€ê´˜</h6><div class="hexagram-display">${this.generateCoinDisplay(this.getChangingHexagram(),'ë³€ê´˜')}</div><div class="hexagram-details"><p><strong>ê´˜ëª…:</strong>${this.najiaResult.main_info.split('ä¹‹')[1]?this.najiaResult.main_info.split('ä¹‹')[1].trim():'ë³€ê´˜ ì—†ìŒ'}</p><p><strong>2ì§„ ì½”ë“œ:</strong>${changingCode}</p><p><strong>ê´˜ìƒ:</strong>${this.formatTrigramDisplay(changingInfo)}</p>${changingType?`<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong><span class="special-type-badge ${changingType}">${changingType}</span></p><p class="special-meaning">${this.getSpecialMeaning(changingType,this.najiaResult.special_analysis.changing_description)}</p>`:'<p><strong>íŠ¹ë³„ ê·¸ë£¹:</strong> ì¼ë°˜ê´˜</p>'}</div></div></div><div class="transformation-analysis"><h6>ğŸ”„ ë³€í™” ë¶„ì„</h6>${this.analyzeTransformationPattern()}</div></div>`;}
generateCoinDisplay(hexagram,label){const coinLabels={6:'ìŒ ë™',7:'ì–‘ ì •',8:'ìŒ ì •',9:'ì–‘ ë™',};const getCoinHTML=(yao)=>{switch(yao){case 7:return'<div class="coin yang-coin"><div class="coin-face"></div></div>';case 8:return'<div class="coin yin-coin"><div class="coin-face"></div></div>';case 9:return'<div class="coin yang-moving-coin"><div class="coin-face"></div></div>';case 6:return'<div class="coin yin-moving-coin"><div class="coin-face"></div></div>';default:return'<div class="coin"><div class="coin-face"></div></div>';}};return`<div class="coin-hexagram">${hexagram.map((yao,index)=>`<div class="coin-line"data-position="${6 - index}íš¨">${getCoinHTML(yao)}<span class="coin-label">${coinLabels[yao]}</span><span class="line-position">${6-index}íš¨</span></div>`).join('')}</div>`;}
getChangingHexagram(){return this.hexagram.map((yao)=>{if(yao===6)return 7;if(yao===9)return 8;return yao;});}
analyzeTransformationPattern(){const movingLines=this.hexagram.map((yao,index)=>([6,9].includes(yao)?6-index:null)).filter((x)=>x!==null);const movingCount=movingLines.length;let pattern='';let significance='';switch(movingCount){case 0:pattern='ì •ê´˜ (ç„¡å‹•)';significance='ì•ˆì •ëœ ìƒí™©ìœ¼ë¡œ í˜„ìƒ ìœ ì§€. ê¸‰ê²©í•œ ë³€í™”ëŠ” ì—†ìœ¼ë‚˜ ë‚´ì¬ëœ ê¸°ìš´ì€ ì§€ì†ë¨';break;case 1:pattern='ë‹¨ë™ (ä¸€å‹•)';significance=`${movingLines[0]}íš¨ ë‹¨ë… ë³€í™”.ëª…í™•í•œ ë°©í–¥ì„±ìœ¼ë¡œ í•´ì„ì´ ìš©ì´í•˜ê³  ë³€í™”ì˜ í•µì‹¬ì´ ëšœë ·í•¨`;break;case 2:pattern='ì´ë™ (äºŒå‹•)';significance=`${movingLines.join('íš¨, ')}íš¨ ë³€í™”.ë³µì¡í•œ ìƒí™©ìœ¼ë¡œ ì–‘ë©´ì„± ì¡´ì¬,ì‹ ì¤‘í•œ íŒë‹¨ í•„ìš”`;break;case 3:pattern='ì‚¼ë™ (ä¸‰å‹•)';significance=`${movingLines.join('íš¨, ')}íš¨ ë³€í™”.ì—­ë™ì  ë³€í™”ë¡œ ê¸°íšŒì™€ ìœ„í—˜ì´ ê³µì¡´`;break;case 4:pattern='ì‚¬ë™ (å››å‹•)';significance=`${movingLines.join('íš¨, ')}íš¨ ë³€í™”.ëŒ€ë³€í˜ì˜ ì‹œê¸°ë¡œ ê·¼ë³¸ì  ë³€í™” ì„ë°•`;break;case 5:pattern='ì˜¤ë™ (äº”å‹•)';significance=`${movingLines.join('íš¨, ')}íš¨ ë³€í™”.ê·¹ë„ì˜ ë³€í™”ë¡œ ì •ì ì¸ íš¨ê°€ í•µì‹¬ ì—­í• `;break;case 6:pattern='ìœ¡ë™ (å…­å‹•)';significance='ì „ì²´ ë³€í™”ë¡œ ì™„ì „í•œ ì „í™˜. ê¸°ì¡´ í‹€ì˜ ì™„ì „í•œ í•´ì²´ì™€ ì¬êµ¬ì„±';break;}
return`<div class="pattern-analysis"><p><strong>ë³€í™” íŒ¨í„´:</strong>${pattern}</p><p><strong>ë³€í™” ì˜ë¯¸:</strong>${significance}</p><p><strong>ë™íš¨ ìœ„ì¹˜:</strong>${movingLines.length>0?movingLines.map((x)=>`${x}íš¨`).join(', '):'ì—†ìŒ'}</p></div>`;}
analyzeMovingLinesEffect(){const movingCount=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•')).length;let interpretation='';switch(movingCount){case 0:interpretation='ì •ê´˜ - ì•ˆì •ëœ ìƒí™©, ë³€í™”ê°€ ì ìŒ';break;case 1:interpretation='ë‹¨ë™ - ëª…í™•í•œ ë°©í–¥ì„±, í•´ì„ì´ ìš©ì´í•¨';break;case 2:interpretation='ì´ë™ - ë³µì¡í•œ ìƒí™©, ì–‘ë©´ì„± ì¡´ì¬';break;case 3:interpretation='ì‚¼ë™ - í˜¼ë€ìŠ¤ëŸ¬ìš´ ìƒí™©, ì‹ ì¤‘í•œ íŒë‹¨ í•„ìš”';break;case 4:interpretation='ì‚¬ë™ - í° ë³€í™”, ì „í™˜ì ';break;case 5:interpretation='ì˜¤ë™ - ê·¹ë„ì˜ ë³€í™”, í˜ì‹ ì  ì „í™˜';break;case 6:interpretation='ìœ¡ë™ - ì™„ì „í•œ ë³€í™”, ìƒˆë¡œìš´ ì‹œì‘';break;}
return`<div class="moving-effect"><h6>ë™íš¨ ê°œìˆ˜ì— ë”°ë¥¸ í•´ì„</h6><p><strong>${movingCount}ê°œ ë™íš¨:</strong>${interpretation}</p></div>`;}
analyzeHexagramChange(){const changeDirection=this.getChangeDirection();return`<div class="change-analysis"><h6>ë³€í™”ì˜ ì„±ê²©</h6><p>${changeDirection}</p><p><strong>ë³€í™” ë‚´ìš©:</strong>${this.getChangeDescription()}</p></div>`;}
analyzeHelpingHinderingSpirits(){const questionType=this.consultationInfo.questionType||'ì¼ë°˜';const primarySpirit=this.getPrimarySpirit(questionType);const helpingSpirit=this.getHelpingSpirit(primarySpirit);const hinderingSpirit=this.getHinderingSpirit(primarySpirit);let html='<div class="spirit-analysis">';html+=`<h6>ìš©ì‹ /ê¸°ì‹ /ì›ì‹  ë¶„ì„(${questionType}ì§ˆë¬¸)</h6>`;html+=`<p><strong>ìš©ì‹ (ä¸»ç¥):</strong>${primarySpirit}</p>`;html+=`<p><strong>ì›ì‹ (åŠ©ç¥):</strong>${helpingSpirit}</p>`;html+=`<p><strong>ê¸°ì‹ (å…‹ç¥):</strong>${hinderingSpirit}</p>`;html+='<div class="spirit-presence">';html+='<h6>ê´˜ ë‚´ ìœ¡ì¹œ í˜„í™©</h6>';const spiritPresence=this.checkSpiritPresence();spiritPresence.forEach((spirit)=>{html+=`<p>${spirit}</p>`;});html+='</div>';html+='</div>';return html;}
analyzeHiddenSpiritsAndVoid(){let html='<div class="hidden-void-analysis">';html+='<div class="hidden-spirits">';html+='<h6>ğŸ›¡ï¸ ë³µì‹  ë¶„ì„</h6>';if(this.najiaResult.fu_shen&&this.najiaResult.fu_shen.ë³µì‹ ìˆ˜>0){html+=`<p><strong>ë³µì‹  ê°œìˆ˜:</strong>${this.najiaResult.fu_shen.ë³µì‹ ìˆ˜}ê°œ</p>`;html+='<div class="fu-shen-list">';this.najiaResult.fu_shen.ë³µì‹ ëª©ë¡.forEach((fs)=>{html+=`<div class="fu-shen-detail">`;html+=`<span class="fu-shen-branch-badge">${fs.ë³µì‹ ì§€ì§€}</span>`;html+=`<span class="fu-shen-kin-badge">${fs.ë³µì‹ ìœ¡ì¹œ}</span>`;html+=`<p>${fs.ë³µì‹ ì˜ë¯¸}-${fs.ë³µì‹ ì‘ìš©}</p>`;html+=`</div>`;});html+='</div>';html+='<p class="fu-shen-summary"><strong>ë³µì‹  ì‘ìš©:</strong> ì ì¬ëœ ë„ì›€ì´ë‚˜ ì˜í–¥ìœ¼ë¡œ ì ì ˆí•œ ë•Œì— ë‚˜íƒ€ë‚˜ ìƒí™©ì„ ë•ìŠµë‹ˆë‹¤.</p>';}else{html+='<p class="no-fu-shen">í˜„ì¬ ë³µì‹ ì´ ì—†ì–´ ì ì¬ëœ ë„ì›€ì´ ì œí•œì ì…ë‹ˆë‹¤.</p>';}
html+='</div>';html+='<div class="void-calculation">';html+='<h6>ğŸ•³ï¸ ê³µë§ ë¶„ì„</h6>';if(this.najiaResult.kong_wang&&this.najiaResult.kong_wang.ê³µë§ìˆ˜>0){html+=`<p><strong>ê³µë§ ì§€ì§€:</strong>${this.najiaResult.kong_wang.ê³µë§ì§€ì§€.join(', ')}</p>`;html+=`<p><strong>ê³µë§ íš¨ìˆ˜:</strong>${this.najiaResult.kong_wang.ê³µë§ìˆ˜}ê°œ</p>`;html+='<div class="kong-wang-effects">';this.najiaResult.kong_wang.ê³µë§íš¨.forEach((kw)=>{html+=`<div class="kong-wang-effect">`;html+=`<span class="kong-wang-yao">${kw.íš¨ìœ„}íš¨</span>`;html+=`<span class="kong-wang-branch-badge">${kw.ì§€ì§€}</span>`;html+=`<span class="kong-wang-kin-badge">${kw.ìœ¡ì¹œ}</span>`;html+=`<p>${kw.ì˜ë¯¸}</p>`;html+=`</div>`;});html+='</div>';const worldLine=this.najiaResult.hexagram.find((line)=>line.note.includes('ä¸–'));const responseLine=this.najiaResult.hexagram.find((line)=>line.note.includes('æ‡‰'));if(worldLine&&this.najiaResult.kong_wang.ê³µë§ì§€ì§€.includes(worldLine.branch)){html+='<p class="critical-void">âš ï¸ <strong>ì„¸íš¨ê°€ ê³µë§</strong>: ìì‹ ì˜ ëŠ¥ë ¥ì´ í˜„ì¬ ë°œíœ˜ë˜ì§€ ëª»í•¨</p>';}
if(responseLine&&this.najiaResult.kong_wang.ê³µë§ì§€ì§€.includes(responseLine.branch)){html+='<p class="critical-void">âš ï¸ <strong>ì‘íš¨ê°€ ê³µë§</strong>: ìƒëŒ€ë°©ì´ë‚˜ ëª©í‘œê°€ í˜„ì‹¤ì„± ë¶€ì¡±</p>';}}else{html+='<p class="no-kong-wang">í˜„ì¬ ê³µë§ì— í•´ë‹¹í•˜ëŠ” íš¨ê°€ ì—†ì–´ ëª¨ë“  íš¨ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ìš©í•©ë‹ˆë‹¤.</p>';}
html+='</div>';html+='</div>';return html;}
analyzeWorldResponseRelation(){const worldLine=this.najiaResult.hexagram.find((line)=>line.note.includes('ä¸–'));const responseLine=this.najiaResult.hexagram.find((line)=>line.note.includes('æ‡‰'));let html='<div class="world-response-analysis">';html+='<h6>âš–ï¸ ì„¸íš¨ì™€ ì‘íš¨ì˜ ê´€ê³„</h6>';if(worldLine&&responseLine){html+='<div class="world-line-info">';html+=`<h7>ğŸ  ì„¸íš¨(${worldLine.yao_pos}íš¨)</h7>`;html+=`<p><strong>ì§€ì§€:</strong>${worldLine.branch}|<strong>ìœ¡ì¹œ:</strong>${worldLine.six_kin}|<strong>ì™•ì•½:</strong>${worldLine.wang_shuai}</p>`;if(this.najiaResult.kong_wang&&this.najiaResult.kong_wang.ê³µë§ì§€ì§€.includes(worldLine.branch)){html+='<p class="world-void">âš ï¸ ì„¸íš¨ê°€ ê³µë§ ìƒíƒœì…ë‹ˆë‹¤</p>';}
html+='</div>';html+='<div class="response-line-info">';html+=`<h7>ğŸ¤ ì‘íš¨(${responseLine.yao_pos}íš¨)</h7>`;html+=`<p><strong>ì§€ì§€:</strong>${responseLine.branch}|<strong>ìœ¡ì¹œ:</strong>${responseLine.six_kin}|<strong>ì™•ì•½:</strong>${responseLine.wang_shuai}</p>`;if(this.najiaResult.kong_wang&&this.najiaResult.kong_wang.ê³µë§ì§€ì§€.includes(responseLine.branch)){html+='<p class="response-void">âš ï¸ ì‘íš¨ê°€ ê³µë§ ìƒíƒœì…ë‹ˆë‹¤</p>';}
html+='</div>';html+='<div class="world-response-relation">';html+='<h7>ğŸ”— ì„¸ì‘ ê´€ê³„ ë¶„ì„</h7>';const relation=this.analyzeElementRelation(worldLine.branch,responseLine.branch);const harmonyRelation=this.analyzeHarmonyRelation(worldLine.branch,responseLine.branch);html+=`<p><strong>ì˜¤í–‰ ê´€ê³„:</strong>${relation}</p>`;html+=`<p><strong>í•©ì¶© ê´€ê³„:</strong>${harmonyRelation}</p>`;let overall='';if(harmonyRelation.includes('í•©')){overall='ğŸ¤ ì„¸ì‘ì´ ì„œë¡œ ì¡°í™”ë¡­ê³  í˜‘ë ¥ì ì¸ ê´€ê³„ì…ë‹ˆë‹¤';}else if(harmonyRelation.includes('ì¶©')){overall='âš¡ ì„¸ì‘ì´ ì„œë¡œ ì¶©ëŒí•˜ê³  ëŒ€ë¦½ì ì¸ ê´€ê³„ì…ë‹ˆë‹¤';}else if(relation.includes('ìƒ')){overall='ğŸŒ± ì„¸ì‘ì´ ì„œë¡œ ë„ì›€ì„ ì£¼ëŠ” ê´€ê³„ì…ë‹ˆë‹¤';}else if(relation.includes('ê·¹')){overall='âš”ï¸ ì„¸ì‘ì´ ì„œë¡œ ê²¬ì œí•˜ëŠ” ê´€ê³„ì…ë‹ˆë‹¤';}else{overall='âš–ï¸ ì„¸ì‘ì´ í‰í–‰í•œ ê´€ê³„ì…ë‹ˆë‹¤';}
html+=`<p class="overall-relation"><strong>ì¢…í•©:</strong>${overall}</p>`;html+='</div>';}else{html+='<p>ì„¸íš¨ë‚˜ ì‘íš¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';}
html+='</div>';return html;}
analyzeElementRelation(branch1,branch2){const elements={å­:'æ°´',äº¥:'æ°´',å¯…:'æœ¨',å¯:'æœ¨',å·³:'ç«',åˆ:'ç«',ç”³:'é‡‘',é…‰:'é‡‘',è¾°:'åœŸ',æˆŒ:'åœŸ',ä¸‘:'åœŸ',æœª:'åœŸ',};const elem1=elements[branch1];const elem2=elements[branch2];if(elem1===elem2)return`ë™ì¼ ì˜¤í–‰(${elem1})`;const generates={æ°´:'æœ¨',æœ¨:'ç«',ç«:'åœŸ',åœŸ:'é‡‘',é‡‘:'æ°´',};const destroys={æ°´:'ç«',ç«:'é‡‘',é‡‘:'æœ¨',æœ¨:'åœŸ',åœŸ:'æ°´',};if(generates[elem1]===elem2)return`${elem1}ì´ ${elem2}ë¥¼ ìƒ`;if(generates[elem2]===elem1)return`${elem2}ì´ ${elem1}ë¥¼ ìƒ`;if(destroys[elem1]===elem2)return`${elem1}ì´ ${elem2}ë¥¼ ê·¹`;if(destroys[elem2]===elem1)return`${elem2}ì´ ${elem1}ë¥¼ ê·¹`;return'ë¹„í™” ê´€ê³„';}
analyzeHarmonyRelation(branch1,branch2){const harmony={å­:'ä¸‘',ä¸‘:'å­',å¯…:'äº¥',äº¥:'å¯…',å¯:'æˆŒ',æˆŒ:'å¯',è¾°:'é…‰',é…‰:'è¾°',å·³:'ç”³',ç”³:'å·³',åˆ:'æœª',æœª:'åˆ',};const clash={å­:'åˆ',åˆ:'å­',ä¸‘:'æœª',æœª:'ä¸‘',å¯…:'ç”³',ç”³:'å¯…',å¯:'é…‰',é…‰:'å¯',è¾°:'æˆŒ',æˆŒ:'è¾°',å·³:'äº¥',äº¥:'å·³',};if(harmony[branch1]===branch2)return`${branch1}ê³¼ ${branch2}ê°€ ìœ¡í•©`;if(clash[branch1]===branch2)return`${branch1}ê³¼ ${branch2}ê°€ ìœ¡ì¶©`;return'ì¼ë°˜ ê´€ê³„';}
predictTiming(){const movingLines=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•'));let html='<div class="timing-prediction">';html+='<h6>ì‘ê¸°(æ‡‰æœŸ) ì˜ˆì¸¡</h6>';if(movingLines.length===0){html+='<p>ë™íš¨ê°€ ì—†ì–´ì„œ ì‘ê¸° ì˜ˆì¸¡ì´ ì–´ë µìŠµë‹ˆë‹¤.</p>';}else{const timingDistance=this.getTimingDistance(movingLines);html+=`<p><strong>ì˜ˆìƒ ì‹œê¸°:</strong>${timingDistance}</p>`;html+='<div class="detailed-timing">';html+='<h6>ìƒì„¸ ì‘ê¸°</h6>';movingLines.forEach((line)=>{const monthTiming=this.getBranchTiming(line.branch);html+=`<p>${line.yao_pos}íš¨ ${line.branch}:${monthTiming}</p>`;});html+='</div>';}
html+='</div>';return html;}
generateJudgmentChecklist(){let html='<div class="judgment-checklist">';html+='<h6>íŒë‹¨ ì²´í¬ë¦¬ìŠ¤íŠ¸</h6>';html+='<ul>';html+=`<li>ê´˜ëª…:${this.najiaResult.main_info}</li>`;html+=`<li>ë™íš¨ ê°œìˆ˜:${this.najiaResult.hexagram.filter((l)=>l.note.includes('å‹•')).length}ê°œ</li>`;const worldLine=this.najiaResult.hexagram.find((line)=>line.note.includes('ä¸–'));if(worldLine){html+=`<li>ì„¸íš¨ ìƒíƒœ:${worldLine.yao_pos}íš¨ ${worldLine.wang_shuai}</li>`;}
const responseLine=this.najiaResult.hexagram.find((line)=>line.note.includes('æ‡‰'));if(responseLine){html+=`<li>ì‘íš¨ ìƒíƒœ:${responseLine.yao_pos}íš¨ ${responseLine.wang_shuai}</li>`;}
html+='</ul>';html+='</div>';return html;}
makeFinalJudgment(){const score=this.calculateJudgmentScore();const level=this.getJudgmentLevel(score);const probability=this.getJudgmentProbability(level);return`<div class="final-judgment"><h6>ìµœì¢… íŒë‹¨</h6><p><strong>ì¢…í•© ì ìˆ˜:</strong>${score}ì </p><p><strong>íŒë‹¨:</strong><span class="judgment-level ${level.toLowerCase()}">${level}</span></p><p><strong>ì„±ê³µ í™•ë¥ :</strong>${probability}</p></div>`;}
generateFinalAdvice(){const level=this.getJudgmentLevel(this.calculateJudgmentScore());let html='<div class="final-advice">';html+='<h6>ìƒë‹´ ë° ì¡°ì–¸</h6>';html+='<div class="advice-sections">';html+='<div class="situation-diagnosis">';html+='<h6>ìƒí™© ì§„ë‹¨</h6>';html+=this.getSituationDiagnosis();html+='</div>';html+='<div class="positive-advice">';html+='<h6>ê¸ì •ì  ì¡°ì–¸</h6>';html+=this.getPositiveAdvice(level);html+='</div>';html+='<div class="negative-advice">';html+='<h6>ì£¼ì˜ì‚¬í•­</h6>';html+=this.getNegativeAdvice(level);html+='</div>';html+='<div class="timing-advice">';html+='<h6>íƒ€ì´ë° ì¡°ì–¸</h6>';html+=this.getTimingAdvice();html+='</div>';html+='<div class="najia-specific-advice">';html+='<h6>ë‚©ê°‘ ë§ì¶¤ ì¡°ì–¸</h6>';html+=this.getNajiaSpecificAdvice();html+='</div>';html+='</div>';html+='</div>';return html;}
getSpecialMeaning(specialType,description){if(description){return description;}
const meanings={ìœ¡ì¶©ê´˜:'ë¶„ì‚°, íŒŒì—´, ë³€í™”ë¥¼ ìƒì§•. ê¸‰ê²©í•œ ë³€í™”ë‚˜ ì¶©ëŒ ìƒí™©',ìœ¡í•©ê´˜:'ê²°í•©, ì•ˆì •, ì„±ì‚¬ë¥¼ ìƒì§•. ëŠë¦¬ì§€ë§Œ í™•ì‹¤í•œ ì§„ì „',ê·€í˜¼ê´˜:'ëë§ºìŒ, ë§ˆë¬´ë¦¬, ê·€ê²°ì„ ìƒì§•. ì•ˆì •ì  ê·€ì°©ì´ë‚˜ ì¢…ê²°',ìœ í˜¼ê´˜:'ë¶ˆì•ˆì •, ë– ëŒì•„ë‹¤ë‹˜, ë¯¸ì •ì„ ìƒì§•. ë§ˆìŒì˜ ë°©í™©ì´ë‚˜ ë¶ˆí™•ì‹¤',};return meanings[specialType]||'';}
generateTableRows(){let html='';this.najiaResult.hexagram.forEach((yao,index)=>{const isMoving=yao.note.includes('å‹•');const statusHtml=isMoving?`<strong>${yao.status}${yao.note}</strong>`:`${yao.status}${yao.note}`;const originalYaoValue=this.hexagram[5-index];const isKongWang=this.najiaResult.kong_wang&&this.najiaResult.kong_wang.ê³µë§ì§€ì§€.includes(yao.branch);const kongWangMarker=isKongWang?'<span class="kong-wang-marker">â—</span>':'';let changingInfo=yao.changing_info;if(isMoving&&this.najiaResult.changing_yao_detailed){const changingDetail=this.najiaResult.changing_yao_detailed.find((cyd)=>cyd.íš¨ìœ„===yao.yao_pos);if(changingDetail){changingInfo=`<div class="changing-yao-detail"><div class="original-info"><strong>ì›:</strong>${changingDetail.ì›ì§€ì§€}${changingDetail.ì›ìœ¡ì¹œ}</div><div class="arrow">â†’</div><div class="changed-info"><strong>ë³€:</strong>${changingDetail.ë³€ì§€ì§€}${changingDetail.ë³€ìœ¡ì¹œ}</div><div class="wang-shuai-info"><small>(${changingDetail.ë³€ì™•ì•½})</small></div></div>`;}}
html+=`<tr ${isMoving?'data-moving="true"':''}${isKongWang?'data-kong-wang="true"':''}><td>${yao.spirit}</td><td>${statusHtml}</td><td><strong>${yao.six_kin}</strong></td><td style="color: var(--primary-color); font-weight: 600;">${yao.branch}
${kongWangMarker}</td><td><div class="yao-position-cell"><div class="line-visual ${this.getLineVisualClass(
                              originalYaoValue
                            )}"></div><span class="yao-pos-text">${yao.yao_pos}íš¨${yao.note?' '+yao.note:''}</span>${kongWangMarker}</div></td><td>${yao.wang_shuai}</td><td>${yao.day_relation}</td><td>${changingInfo}</td></tr>`;});return html;}
getLineInfo(yaoNumber){const lineTypes={6:'è€é™° (ë³€ìŒ)',7:'å°‘é™½ (ì •ì–‘)',8:'å°‘é™° (ì •ìŒ)',9:'è€é™½ (ë³€ì–‘)',};return lineTypes[yaoNumber]||'ì•Œ ìˆ˜ ì—†ìŒ';}
getLineVisualClass(yaoNumber){const classes={6:'yin-moving-visual',7:'yang-visual',8:'yin-visual',9:'yang-moving-visual',};return classes[yaoNumber]||'yang-visual';}
getPositionMeaning(position){const meanings={1:'ì´ˆíš¨ - ì‹œì‘, ê¸°ì´ˆ, ì¤€ë¹„ ë‹¨ê³„',2:'ì´íš¨ - ë°œì „, ì§„í–‰, ì‹¤í–‰ ë‹¨ê³„',3:'ì‚¼íš¨ - ì „í™˜, ìœ„ê¸°, ì„ íƒì˜ ê¸°ë¡œ',4:'ì‚¬íš¨ - ì ‘ê·¼, ê¸°íšŒ, ê²°ê³¼ ë„ì¶œ',5:'ì˜¤íš¨ - ì„±ì·¨, ê¶Œë ¥, ìµœê³ ì¡°',6:'ìƒíš¨ - ì™„ì„±, ì¢…ë£Œ, ìƒˆë¡œìš´ ì‹œì‘',};return meanings[position]||'ì¼ë°˜ì  ì˜ë¯¸';}
getStrengthDescription(strength){const descriptions={æ—º:'ìµœê°• - ë§¤ìš° ìœ ë¦¬í•œ ìƒíƒœ',ç›¸:'ê°•í•¨ - ìœ ë¦¬í•œ ìƒíƒœ',ä¼‘:'ë³´í†µ - ì¤‘ë¦½ì  ìƒíƒœ',å›š:'ì•½í•¨ - ë¶ˆë¦¬í•œ ìƒíƒœ',æ­»:'ìµœì•½ - ë§¤ìš° ë¶ˆë¦¬í•œ ìƒíƒœ',};return descriptions[strength]||'ì•Œ ìˆ˜ ì—†ìŒ';}
getChangingHexagramCode(){return this.hexagram.map((yao)=>{if(yao===6)return'1';if(yao===9)return'0';return[7,9].includes(yao)?'1':'0';}).reverse().join('');}
getHexagramName(code){const simpleNames={111111:'ä¹¾','000000':'å¤','010001':'å±¯',100010:'è’™',111010:'è¨Ÿ','010111':'éœ€','010000':'å¸«','000010':'æ¯”',};return simpleNames[code]||'ë¯¸ì •ì˜ê´˜';}
getChangeDirection(){const movingCount=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•')).length;if(movingCount<=2)return'ì ì§„ì  ë³€í™” - ì•ˆì •ì  ì „í™˜';if(movingCount<=4)return'ì¤‘ê°„ ë³€í™” - ì£¼ì˜ê¹Šì€ ëŒ€ì‘ í•„ìš”';return'ê¸‰ê²©í•œ ë³€í™” - í° ì „í™˜ì ';}
getChangeDescription(){const movingLines=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•'));return movingLines.map((line)=>`${line.yao_pos}íš¨:${line.status}â†’ ${line.changing_info.split('â†’')[1]||'ë³€í™”'}`).join(', ');}
getPrimarySpirit(questionType){const spiritMap={ì¬ë¬¼:'å¦»è²¡',ì§ì—…:'å®˜é¬¼',ê±´ê°•:'ä¸–çˆ»',í•™ì—…:'çˆ¶æ¯',ì—°ì• :'å¦»è²¡',ê°€ì¡±:'çˆ¶æ¯',ìë…€:'å­å­«',ì¹œêµ¬:'å…„å¼Ÿ',ì†Œì†¡:'å®˜é¬¼',ì¼ë°˜:'ä¸–çˆ»',};return spiritMap[questionType]||'ä¸–çˆ»';}
getHelpingSpirit(primarySpirit){const helpMap={å¦»è²¡:'å­å­«',å®˜é¬¼:'çˆ¶æ¯',çˆ¶æ¯:'å®˜é¬¼',å­å­«:'å…„å¼Ÿ',å…„å¼Ÿ:'å¦»è²¡',ä¸–çˆ»:'ì›ì‹ ',};return helpMap[primarySpirit]||'ì›ì‹ ';}
getHinderingSpirit(primarySpirit){const hinderMap={å¦»è²¡:'å…„å¼Ÿ',å®˜é¬¼:'å­å­«',çˆ¶æ¯:'å¦»è²¡',å­å­«:'å®˜é¬¼',å…„å¼Ÿ:'çˆ¶æ¯',ä¸–çˆ»:'ê¸°ì‹ ',};return hinderMap[primarySpirit]||'ê¸°ì‹ ';}
checkSpiritPresence(){const allKins=this.najiaResult.hexagram.map((line)=>line.six_kin);const uniqueKins=[...new Set(allKins)];return uniqueKins.map((kin)=>`${kin}:${allKins.filter((k)=>k===kin).length}ê°œ`);}
calculateVoid(){const dayBranch=this.najiaResult.base_info['ì¼ì§„'].charAt(1);const branchIndex=['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥',].indexOf(dayBranch);const voidIndex1=(branchIndex+10)%12;const voidIndex2=(branchIndex+11)%12;const branches=['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥',];return[branches[voidIndex1],branches[voidIndex2]];}
getWorldResponseRelation(worldLine,responseLine){const worldBinary=[7,9].includes(worldLine.status)?1:0;const responseBinary=[7,9].includes(responseLine.status)?1:0;if(worldBinary===responseBinary){return'ì„¸ì‘ë¹„í™” - ì¡°í™”ë¡œìš´ ê´€ê³„';}else{return'ì„¸ì‘ìƒì¶© - ëŒ€ë¦½ì  ê´€ê³„';}}
getTimingDistance(movingLines){const positions=movingLines.map((line)=>line.yao_pos);const nearCount=positions.filter((pos)=>pos<=3).length;const farCount=positions.filter((pos)=>pos>3).length;if(nearCount>farCount)return'1-3ê°œì›” (ê°€ê¹Œìš´ ì‹œê¸°)';if(farCount>nearCount)return'6-12ê°œì›” (ë¨¼ ì‹œê¸°)';return'3-6ê°œì›” (ì¤‘ê°„ ì‹œê¸°)';}
getBranchTiming(branch){const timing={å­:'11ì›”(ìì›”)',ä¸‘:'12ì›”(ì¶•ì›”)',å¯…:'1ì›”(ì¸ì›”)',å¯:'2ì›”(ë¬˜ì›”)',è¾°:'3ì›”(ì§„ì›”)',å·³:'4ì›”(ì‚¬ì›”)',åˆ:'5ì›”(ì˜¤ì›”)',æœª:'6ì›”(ë¯¸ì›”)',ç”³:'7ì›”(ì‹ ì›”)',é…‰:'8ì›”(ìœ ì›”)',æˆŒ:'9ì›”(ìˆ ì›”)',äº¥:'10ì›”(í•´ì›”)',};return timing[branch]||'ë¯¸ì •';}
calculateJudgmentScore(){let score=0;const movingCount=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•')).length;if(movingCount===0)score+=5;else if(movingCount===1)score+=15;else if(movingCount<=3)score+=10;else score-=5;const yangCount=this.hexagram.filter((y)=>[7,9].includes(y)).length;if(yangCount>=2&&yangCount<=4)score+=10;const worldLine=this.najiaResult.hexagram.find((line)=>line.note.includes('ä¸–'));if(worldLine){if(['æ—º','ç›¸'].includes(worldLine.wang_shuai))score+=10;else if(worldLine.wang_shuai==='æ­»')score-=10;}
const strongSpirits=this.najiaResult.hexagram.filter((line)=>['æ—º','ç›¸'].includes(line.wang_shuai)).length;if(strongSpirits>=3)score+=15;else if(strongSpirits<=1)score-=10;return score;}
getJudgmentLevel(score){if(score>=25)return'ëŒ€ê¸¸';if(score>=15)return'ê¸¸';if(score>=5)return'í‰';if(score>=-5)return'í‰';return'ëŒ€í‰';}
getJudgmentProbability(level){const probabilities={ëŒ€ê¸¸:'85-95%',ê¸¸:'70-85%',í‰:'50-70%',í‰:'25-50%',ëŒ€í‰:'5-25%',};return probabilities[level]||'50%';}
getSituationDiagnosis(){const movingCount=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•')).length;if(movingCount===0)
return'<p>í˜„ì¬ ìƒí™©ì´ ì•ˆì •ì ì´ë©° í° ë³€í™”ê°€ ì—†ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.</p>';if(movingCount===1)
return'<p>ëª…í™•í•œ ë³€í™”ì˜ ë°©í–¥ì´ ë³´ì´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.</p>';if(movingCount<=3)
return'<p>ë³µì¡í•œ ìƒí™©ì´ì§€ë§Œ ê´€ë¦¬ ê°€ëŠ¥í•œ ë²”ìœ„ì…ë‹ˆë‹¤.</p>';return'<p>ê¸‰ë³€í•˜ëŠ” ì‹œê¸°ë¡œ ì‹ ì¤‘í•œ ëŒ€ì‘ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';}
getPositiveAdvice(level){const advice={ëŒ€ê¸¸:'<p>ì ê·¹ì ìœ¼ë¡œ í–‰ë™í•˜ì„¸ìš”. ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.</p>',ê¸¸:'<p>ê³„íšì„ ì‹¤í–‰ì— ì˜®ê¸°ê¸° ì¢‹ì€ ì‹œê¸°ì…ë‹ˆë‹¤.</p>',í‰:'<p>ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•˜ë©´ ë¬´ë‚œí•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>',í‰:'<p>í˜„ìƒ ìœ ì§€ì— ì§‘ì¤‘í•˜ê³  ìƒˆë¡œìš´ ì‹œë„ëŠ” ë¯¸ë£¨ì„¸ìš”.</p>',ëŒ€í‰:'<p>ë°©ì–´ì  ìì„¸ë¥¼ ì·¨í•˜ê³  ì†ì‹¤ì„ ìµœì†Œí™”í•˜ì„¸ìš”.</p>',};return advice[level]||'<p>ê· í˜•ì¡íŒ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';}
getNegativeAdvice(level){const warnings={ëŒ€ê¸¸:'<p>ê³¼ë„í•œ ìì‹ ê°ì€ ê¸ˆë¬¼ì…ë‹ˆë‹¤.</p>',ê¸¸:'<p>ì•ˆì£¼í•˜ì§€ ë§ê³  ì§€ì†ì ì¸ ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>',í‰:'<p>ì„±ê¸‰í•œ íŒë‹¨ì„ í”¼í•˜ì„¸ìš”.</p>',í‰:'<p>ìœ„í—˜í•œ íˆ¬ìë‚˜ ê²°ì •ì„ í”¼í•˜ì„¸ìš”.</p>',ëŒ€í‰:'<p>ëª¨ë“  í–‰ë™ì„ ì‹ ì¤‘íˆ ì¬ê²€í† í•˜ì„¸ìš”.</p>',};return warnings[level]||'<p>ì£¼ì˜ê¹Šì€ ê´€ì°°ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';}
getTimingAdvice(){const movingLines=this.najiaResult.hexagram.filter((line)=>line.note.includes('å‹•'));if(movingLines.length===0)
return'<p>ê¸‰í•˜ì§€ ì•Šìœ¼ë‹ˆ ì¶©ë¶„íˆ ì¤€ë¹„í•˜ì„¸ìš”.</p>';const nearPositions=movingLines.filter((line)=>line.yao_pos<=3).length;if(nearPositions>movingLines.length/2){return'<p>ê°€ê¹Œìš´ ì‹œì¼ ë‚´ì— í–‰ë™í•˜ì„¸ìš”.</p>';}
return'<p>ì¢€ ë” ê¸°ë‹¤ë¦° í›„ í–‰ë™í•˜ëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤.</p>';}
getNajiaSpecificAdvice(){let html='<div class="najia-advice">';const worldLine=this.najiaResult.hexagram.find((line)=>line.note.includes('ä¸–'));if(worldLine){if(['æ—º','ç›¸'].includes(worldLine.wang_shuai)){html+='<p><strong>ì„¸íš¨ ê°•í•¨:</strong> ìì‹ ì˜ ì˜ì§€ëŒ€ë¡œ ìƒí™©ì„ ì´ëŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';}else{html+='<p><strong>ì„¸íš¨ ì•½í•¨:</strong> ì™¸ë¶€ ë„ì›€ì„ êµ¬í•˜ê±°ë‚˜ ì‹œê¸°ë¥¼ ê¸°ë‹¤ë¦¬ì„¸ìš”.</p>';}}
const strongLines=this.najiaResult.hexagram.filter((line)=>['æ—º','ç›¸'].includes(line.wang_shuai));const weakLines=this.najiaResult.hexagram.filter((line)=>['å›š','æ­»'].includes(line.wang_shuai));if(strongLines.length>weakLines.length){html+='<p><strong>ì „ì²´ì  ê°•ì„¸:</strong> ì ê·¹ì ì¸ ì ‘ê·¼ì´ ìœ ë¦¬í•©ë‹ˆë‹¤.</p>';}else{html+='<p><strong>ì „ì²´ì  ì•½ì„¸:</strong> ë³´ìˆ˜ì  ì ‘ê·¼ì´ ì•ˆì „í•©ë‹ˆë‹¤.</p>';}
const kinCounts={};this.najiaResult.hexagram.forEach((line)=>{kinCounts[line.six_kin]=(kinCounts[line.six_kin]||0)+1;});const dominantKin=Object.keys(kinCounts).reduce((a,b)=>kinCounts[a]>kinCounts[b]?a:b);html+=`<p><strong>ì£¼ìš” ìœ¡ì¹œ ${dominantKin}:</strong>ì´ ì˜ì—­ì— ì§‘ì¤‘í•˜ì—¬ ëŒ€ì‘í•˜ì„¸ìš”.</p>`;html+='</div>';return html;}}
document.addEventListener('DOMContentLoaded',()=>{new IntegratedNajiaSystem();});