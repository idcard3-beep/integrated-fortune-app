let currentTicketId=null;function getTicketIdFromUrl(){const urlParams=new URLSearchParams(window.location.search);let ticketId=urlParams.get('ticket_id');if(!ticketId){const pendingTicketId=sessionStorage.getItem('pendingTicketId');if(pendingTicketId){console.log('   ğŸ“‹ pendingTicketId ë°œê²¬:',pendingTicketId);ticketId=pendingTicketId;sessionStorage.removeItem('pendingTicketId');}}
return ticketId;}
window.addEventListener('DOMContentLoaded',function(){console.log('ğŸš€ DOMContentLoaded - í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');const ticketId=getTicketIdFromUrl();console.log('   - ticket_id:',ticketId);const returnAfterLogin=sessionStorage.getItem('returnAfterLogin');const hasSajuFormData=sessionStorage.getItem('sajuFormData');console.log('   - returnAfterLogin:',returnAfterLogin);console.log('   - hasSajuFormData:',hasSajuFormData?'YES':'NO');if(ticketId){currentTicketId=ticketId;console.log('âœ… ticket_id ì¡´ì¬ - í‹°ì¼“ ë°ì´í„° ë¡œë“œ:',currentTicketId);window['loadTicketData'](ticketId);}else if(returnAfterLogin==='true'&&hasSajuFormData){console.log('ğŸ”„ ë¡œê·¸ì¸ í›„ ëŒì•„ì˜´ - ë°ì´í„° ë³µì›ë§Œ ìˆ˜í–‰');setTimeout(()=>{console.log('â° ë°ì´í„° ë³µì› ì‹¤í–‰');const restored=restoreFormData();if(restored){console.log('âœ… ë°ì´í„° ë³µì› ì™„ë£Œ');console.log('â„¹ï¸  ì´ì œ ë¡œê·¸ì¸ëœ ìƒíƒœì´ë¯€ë¡œ ì›í•˜ëŠ” ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');sessionStorage.removeItem('returnAfterLogin');alert('âœ… ë¡œê·¸ì¸ ì„±ê³µ!\n\nì…ë ¥í•˜ì‹  ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.\n"ì‚¬ì£¼ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‹¤ì‹œ ë¶„ì„í•˜ì‹  í›„\nì›í•˜ëŠ” ì‘ì—…(DBì €ì¥, ë³´ë‚´ê¸°, DBë³´ê¸°)ì„ ìˆ˜í–‰í•˜ì„¸ìš”.');}else{console.error('âŒ ë°ì´í„° ë³µì› ì‹¤íŒ¨');sessionStorage.removeItem('returnAfterLogin');sessionStorage.removeItem('sajuFormData');}},500);}else if(hasSajuFormData&&!ticketId){console.log('ğŸ”„ ë¡œê·¸ì¸ ì·¨ì†Œ í›„ ëŒì•„ì˜´ - ë°ì´í„° ë³µì› ìˆ˜í–‰');setTimeout(()=>{console.log('â° ë°ì´í„° ë³µì› ì‹¤í–‰ (ì·¨ì†Œ í›„ ë³µê·€)');const restored=restoreFormData();if(restored){console.log('âœ… ë°ì´í„° ë³µì› ì™„ë£Œ (ì·¨ì†Œ í›„ ë³µê·€)');}else{console.error('âŒ ë°ì´í„° ë³µì› ì‹¤íŒ¨');sessionStorage.removeItem('sajuFormData');}},300);}else{console.log('â„¹ï¸ ì¼ë°˜ í˜ì´ì§€ ë¡œë“œ (ë³µì› ì—†ìŒ)');}});async function loadTicketData(ticketId){try{console.log('ğŸ”„ í‹°ì¼“ ë°ì´í„° ë¡œë“œ ì‹œì‘:',ticketId);const response=await fetch(`/secret/api/v1/tickets/${ticketId}`);if(!response.ok){throw new Error(`HTTP ${response.status}: ${response.statusText}`);}
const result=await response.json();console.log('ğŸ“¦ API ì‘ë‹µ:',result);console.log('ğŸ“¦ API ì‘ë‹µ (JSON):',JSON.stringify(result,null,2));if(result.ok&&result.ticket){const ticket=result.ticket;console.log('ğŸ“‹ í‹°ì¼“ ë°ì´í„°:',ticket);console.log('ğŸ“‹ í‹°ì¼“ ë°ì´í„° (ìƒì„¸):',{author_name:ticket.author_name,birth_datetime:ticket.birth_datetime,birth_hour:ticket.birth_hour,birth_minute:ticket.birth_minute,calendar_type:ticket.calendar_type,yundal:ticket.yundal,author_gender:ticket.author_gender,hour_ji:ticket.hour_ji,});console.log('1ï¸âƒ£ ì„±ëª… ì„¤ì •:',ticket.author_name);const nameInput=document.getElementById('name');if(nameInput){nameInput.value=ticket.author_name||'';console.log('   âœ… ì„±ëª… ì…ë ¥ ì™„ë£Œ:',nameInput.value);}else{console.error('   âŒ name ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
console.log('2ï¸âƒ£ ìƒë…„ì›”ì¼ ì„¤ì •:',ticket.birth_datetime,'(íƒ€ì…:',typeof ticket.birth_datetime,')');if(ticket.birth_datetime){const birthDate=new Date(ticket.birth_datetime);if(isNaN(birthDate.getTime())){console.error('   âŒ birth_datetime íŒŒì‹± ì‹¤íŒ¨:',ticket.birth_datetime);}else{const yearInput=document.getElementById('year');const monthInput=document.getElementById('month');const dayInput=document.getElementById('day');if(yearInput){yearInput.value=birthDate.getFullYear();console.log('   âœ… ë…„ë„:',yearInput.value);}else{console.error('   âŒ year ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
if(monthInput){monthInput.value=birthDate.getMonth()+1;console.log('   âœ… ì›”:',monthInput.value);}else{console.error('   âŒ month ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
if(dayInput){dayInput.value=birthDate.getDate();console.log('   âœ… ì¼:',dayInput.value);}else{console.error('   âŒ day ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}}else{console.warn('   âš ï¸ birth_datetime ì—†ìŒ');}
console.log('3ï¸âƒ£ ì‹œê°„ ì„¤ì •:',ticket.birth_hour);if(ticket.birth_hour!==null&&ticket.birth_hour!==undefined){const hourInput=document.getElementById('hour');if(hourInput){hourInput.value=ticket.birth_hour;console.log('   âœ… ì‹œê°„:',hourInput.value);}else{console.error('   âŒ hour ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}else{console.warn('   âš ï¸ birth_hour ì—†ìŒ');}
console.log('4ï¸âƒ£ ë¶„ ì„¤ì •:',ticket.birth_minute);if(ticket.birth_minute!==null&&ticket.birth_minute!==undefined){const minuteInput=document.getElementById('minute');if(minuteInput){minuteInput.value=ticket.birth_minute;console.log('   âœ… ë¶„:',minuteInput.value);}else{console.error('   âŒ minute ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}else{console.warn('   âš ï¸ birth_minute ì—†ìŒ');}
console.log('5ï¸âƒ£ ì—­ë²• ì„¤ì •:',ticket.calendar_type);if(ticket.calendar_type){const isLunar=ticket.calendar_type==='ìŒë ¥'||ticket.calendar_type==='LUNAR'||ticket.calendar_type==='lunar';const calendarValue=isLunar?'lunar':'solar';const calendarRadio=document.querySelector(`input[name="calendar"][value="${calendarValue}"]`);if(calendarRadio){calendarRadio.checked=true;console.log('   âœ… ì—­ë²•:',calendarValue);if(isLunar){const yundalSection=document.getElementById('yundal-section');if(yundalSection){yundalSection.style.display='block';console.log('   âœ… ìœ¤ë‹¬ ì„¹ì…˜ í‘œì‹œ');}
console.log('6ï¸âƒ£ ìœ¤ë‹¬ ì„¤ì •:',ticket.yundal,'(íƒ€ì…:',typeof ticket.yundal,')');if(ticket.yundal===true||ticket.yundal==='Y'||ticket.yundal===1){const yundalCheck=document.getElementById('yundal');if(yundalCheck){yundalCheck.checked=true;console.log('   âœ… ìœ¤ë‹¬ ì²´í¬ë¨');}else{console.error('   âŒ yundal ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}}}else{console.error('   âŒ calendar ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}else{console.warn('   âš ï¸ calendar_type ì—†ìŒ');}
console.log('7ï¸âƒ£ ì„±ë³„ ì„¤ì •:',ticket.author_gender);if(ticket.author_gender){const genderValue=ticket.author_gender==='M'?'male':'female';const genderRadio=document.querySelector(`input[name="gender"][value="${genderValue}"]`);if(genderRadio){genderRadio.checked=true;console.log('   âœ… ì„±ë³„:',genderValue);}else{console.error('   âŒ gender ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}else{console.warn('   âš ï¸ author_gender ì—†ìŒ');}
console.log('8ï¸âƒ£ ì‹œì£¼ ì„¤ì •:',ticket.hour_ji);if(ticket.hour_ji&&ticket.hour_ji.trim()!==''){console.log('   ğŸ“ hour_ji ê°’ ìˆìŒ â†’ ê°„ì§€ì…ë ¥ ëª¨ë“œë¡œ ì „í™˜');const ganjiRadio=document.querySelector('input[name="timeInputType"][value="ganji"]');if(ganjiRadio){ganjiRadio.checked=true;console.log('   âœ… ì‹œê° ì…ë ¥ ë°©ì‹: ê°„ì§€ ì…ë ¥ ì²´í¬');const timeInputSection=document.getElementById('time-input-section');const ganjiInputSection=document.getElementById('ganji-input-section');if(timeInputSection){timeInputSection.style.display='none';console.log('   âœ… ì‹œê° ì…ë ¥ í•„ë“œ ìˆ¨ê¹€');}
if(ganjiInputSection){ganjiInputSection.style.display='block';console.log('   âœ… ê°„ì§€ ì…ë ¥ í•„ë“œ í‘œì‹œ');}}else{console.error('   âŒ ê°„ì§€ ì…ë ¥ ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
const hourJiSelect=document.getElementById('hour-ji-select');if(hourJiSelect){hourJiSelect.value=ticket.hour_ji;console.log('   âœ… ì‹œì£¼ ì„ íƒ:',hourJiSelect.value);}else{console.error('   âŒ hour-ji-selectë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}else{console.log('   ğŸ“ hour_ji ê°’ ì—†ìŒ â†’ ì‹œê°ì…ë ¥ ëª¨ë“œ ìœ ì§€');const timeRadio=document.querySelector('input[name="timeInputType"][value="time"]');if(timeRadio){timeRadio.checked=true;console.log('   âœ… ì‹œê° ì…ë ¥ ë°©ì‹: ì‹œê° ì…ë ¥ ì²´í¬');const timeInputSection=document.getElementById('time-input-section');const ganjiInputSection=document.getElementById('ganji-input-section');if(timeInputSection){timeInputSection.style.display='block';console.log('   âœ… ì‹œê° ì…ë ¥ í•„ë“œ í‘œì‹œ');}
if(ganjiInputSection){ganjiInputSection.style.display='none';console.log('   âœ… ê°„ì§€ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€');}}else{console.error('   âŒ ì‹œê° ì…ë ¥ ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}
console.log('âœ… í‹°ì¼“ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');console.log('ğŸ“Š ë¡œë“œëœ ë°ì´í„° ìš”ì•½:',{ì„±ëª…:ticket.author_name,ìƒë…„ì›”ì¼:ticket.birth_datetime,ì‹œê°„:ticket.birth_hour,ë¶„:ticket.birth_minute,ì—­ë²•:ticket.calendar_type,ìœ¤ë‹¬:ticket.yundal,ì„±ë³„:ticket.author_gender,ì‹œì£¼:ticket.hour_ji,});console.log('9ï¸âƒ£ ìë™ ì‚¬ì£¼ ë¶„ì„ ì¤€ë¹„');setTimeout(()=>{console.log('ğŸ”® ìë™ìœ¼ë¡œ ì‚¬ì£¼ ë¶„ì„ ì‹¤í–‰');const analyzeBtn=document.getElementById('analyze-btn');if(analyzeBtn){analyzeBtn.click();console.log('âœ… ì‚¬ì£¼ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì™„ë£Œ');}else{console.error('âŒ ì‚¬ì£¼ë³´ê¸° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}},800);}else{console.error('âŒ í‹°ì¼“ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:',result);alert('í‹°ì¼“ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì‘ë‹µ: '+
JSON.stringify(result,null,2));}}catch(error){console.error('âŒ í‹°ì¼“ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:',error);console.error('   ìŠ¤íƒ:',error.stack);alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: '+error.message);}}
window['loadTicketData']=loadTicketData;function checkMemberLogin(){let memberId=null;console.log('ğŸ” íšŒì› ë¡œê·¸ì¸ ì²´í¬ ì‹œì‘ ============');console.log('   ğŸŒ í˜„ì¬ í™˜ê²½:',window.location.hostname);console.log('   ğŸ“ URL:',window.location.href);console.log('   1ï¸âƒ£ window.MEMBER_SESSION í™•ì¸:',window.MEMBER_SESSION);if(window.MEMBER_SESSION){console.log('      - typeof:',typeof window.MEMBER_SESSION);console.log('      - keys:',Object.keys(window.MEMBER_SESSION));console.log('      - sMem_id:',window.MEMBER_SESSION.sMem_id);console.log('      - isLoggedIn:',window.MEMBER_SESSION.isLoggedIn);if(window.MEMBER_SESSION.sMem_id){memberId=window.MEMBER_SESSION.sMem_id;console.log('   âœ… MEMBER_SESSIONì—ì„œ íšŒì› ID í™•ì¸:',memberId);console.log('ğŸ”„ checkMemberLogin í•¨ìˆ˜ ì¢…ë£Œ - ë°˜í™˜ê°’:',memberId);console.log('=====================================');return memberId;}else{console.log('   âš ï¸ MEMBER_SESSIONì€ ìˆì§€ë§Œ sMem_idê°€ ì—†ìŒ');}}else{console.log('   âš ï¸ window.MEMBER_SESSIONì´ ì—†ìŒ (undefined ë˜ëŠ” null)');}
console.log('   2ï¸âƒ£ sessionStorage í™•ì¸...');try{const storedSession=sessionStorage.getItem('memberSession');console.log('      - sessionStorage.memberSession:',storedSession);if(storedSession){const sessionData=JSON.parse(storedSession);console.log('      - íŒŒì‹±ëœ ë°ì´í„°:',sessionData);if(sessionData&&sessionData.sMem_id){memberId=sessionData.sMem_id;console.log('   âœ… sessionStorageì—ì„œ íšŒì› ID í™•ì¸:',memberId);console.log('ğŸ”„ checkMemberLogin í•¨ìˆ˜ ì¢…ë£Œ - ë°˜í™˜ê°’:',memberId);console.log('=====================================');return memberId;}}}catch(e){console.error('   âŒ sessionStorage íŒŒì‹± ì˜¤ë¥˜:',e);}
console.log('   3ï¸âƒ£ ì „ì—­ë³€ìˆ˜ í™•ì¸...');console.log('      - window.sMem_id:',typeof window.sMem_id,window.sMem_id);console.log('      - sMem_id:',typeof sMem_id!=='undefined'?sMem_id:'undefined');if(typeof window.sMem_id!=='undefined'&&window.sMem_id){memberId=window.sMem_id;console.log('   âœ… window.sMem_idì—ì„œ íšŒì› ID í™•ì¸:',memberId);}else if(typeof sMem_id!=='undefined'&&sMem_id){memberId=sMem_id;console.log('   âœ… ì „ì—­ sMem_idì—ì„œ íšŒì› ID í™•ì¸:',memberId);}else{console.log('   âš ï¸ ì „ì—­ë³€ìˆ˜ì—ì„œë„ íšŒì› IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');}
console.log('ğŸ”„ checkMemberLogin í•¨ìˆ˜ ì¢…ë£Œ - ìµœì¢… ë°˜í™˜ê°’:',memberId);console.log('=====================================');return memberId;}
window['checkMemberLogin']=checkMemberLogin;(function(fn){window['checkMemberLogin']=fn;})(checkMemberLogin);function saveFormData(){const formData={name:document.getElementById('name')?.value||'',year:document.getElementById('year')?.value||'',month:document.getElementById('month')?.value||'',day:document.getElementById('day')?.value||'',hour:document.getElementById('hour')?.value||'',minute:document.getElementById('minute')?.value||'',calendar:document.querySelector('input[name="calendar"]:checked')?.value||'solar',yundal:document.getElementById('yundal')?.checked||false,gender:document.querySelector('input[name="gender"]:checked')?.value||'male',hourJi:document.getElementById('hour-ji-select')?.value||'',};sessionStorage.setItem('sajuFormData',JSON.stringify(formData));console.log('ğŸ’¾ ì…ë ¥ ë°ì´í„° ì €ì¥ ì™„ë£Œ (ì‚¬ì£¼ ê²°ê³¼ëŠ” ì œì™¸):',formData);}
window['saveFormData']=saveFormData;function restoreFormData(){const savedData=sessionStorage.getItem('sajuFormData');if(!savedData){console.log('âš ï¸ ì €ì¥ëœ ë°ì´í„° ì—†ìŒ');return false;}
try{const formData=JSON.parse(savedData);console.log('ğŸ“¥ ì…ë ¥ ë°ì´í„° ë³µì› ì‹œì‘:',formData);if(formData.name)document.getElementById('name').value=formData.name;if(formData.year)document.getElementById('year').value=formData.year;if(formData.month)document.getElementById('month').value=formData.month;if(formData.day)document.getElementById('day').value=formData.day;if(formData.hour)document.getElementById('hour').value=formData.hour;if(formData.minute)
document.getElementById('minute').value=formData.minute;const calendarRadio=document.querySelector(`input[name="calendar"][value="${formData.calendar}"]`);if(calendarRadio)calendarRadio.checked=true;const genderRadio=document.querySelector(`input[name="gender"][value="${formData.gender}"]`);if(genderRadio)genderRadio.checked=true;if(formData.yundal)document.getElementById('yundal').checked=true;if(formData.hourJi)
document.getElementById('hour-ji-select').value=formData.hourJi;console.log('âœ… ì…ë ¥ ë°ì´í„° ë³µì› ì™„ë£Œ (ì‚¬ì£¼ ê²°ê³¼ëŠ” ì œì™¸ - ì‚¬ì£¼ë³´ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”)');return true;}catch(error){console.error('âŒ ë°ì´í„° ë³µì› ì˜¤ë¥˜:',error);return false;}}
window['restoreFormData']=restoreFormData;function checkSajuResult(){const resultWrap=document.getElementById('resultWrap');if(!resultWrap||resultWrap.classList.contains('hidden')){console.log('âŒ resultWrapì´ ìˆ¨ê²¨ì ¸ ìˆìŒ');return false;}
const dayGan=document.getElementById('day-gan');if(!dayGan||!dayGan.textContent.trim()){console.log('âŒ ì¼ì£¼(day-gan)ê°€ ë¹„ì–´ìˆìŒ');return false;}
const dayJi=document.getElementById('day-ji');if(!dayJi||!dayJi.textContent.trim()){console.log('âŒ ì¼ì§€(day-ji)ê°€ ë¹„ì–´ìˆìŒ');return false;}
console.log('âœ… ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ í™•ì¸: day-gan =',dayGan.textContent,', day-ji =',dayJi.textContent);return true;}
window['checkSajuResult']=checkSajuResult;(function(fn){window['checkSajuResult']=fn;})(checkSajuResult);window['_checkSajuResult']=(function(){return checkSajuResult;})();function redirectToLogin(message){saveFormData();console.log('ğŸ’¾ í˜„ì¬ í™”ë©´ ë°ì´í„° ì €ì¥ ì™„ë£Œ');if(confirm(message+'\n\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){sessionStorage.setItem('returnUrl',window.location.href);sessionStorage.setItem('returnAfterLogin','true');console.log('ğŸ”„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');window.location.href='/secret/member_login.html';}else{console.log('âŒ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ì´ë™ì„ ì·¨ì†Œí•¨ (ë°ì´í„°ëŠ” ì €ì¥ë¨)');}}
window['redirectToLogin']=redirectToLogin;setTimeout(function(){console.log('ğŸš¨ ê°•ì œ í•¨ìˆ˜ ë“±ë¡ ì‹œì‘ (3ì´ˆ í›„)...');console.log('   - checkSajuResult ì •ì˜ë¨:',typeof checkSajuResult);console.log('   - checkMemberLogin ì •ì˜ë¨:',typeof checkMemberLogin);if(typeof checkSajuResult!=='undefined'){window['checkSajuResult']=checkSajuResult;console.log('   âœ… checkSajuResult ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof checkMemberLogin!=='undefined'){window['checkMemberLogin']=checkMemberLogin;console.log('   âœ… checkMemberLogin ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof redirectToLogin!=='undefined'){window['redirectToLogin']=redirectToLogin;console.log('   âœ… redirectToLogin ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof saveFormData!=='undefined'){window['saveFormData']=saveFormData;console.log('   âœ… saveFormData ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof restoreFormData!=='undefined'){window['restoreFormData']=restoreFormData;console.log('   âœ… restoreFormData ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof loadTicketData!=='undefined'){window['loadTicketData']=loadTicketData;console.log('   âœ… loadTicketData ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof generateSajuShareText!=='undefined'){window['generateSajuShareText']=generateSajuShareText;console.log('   âœ… generateSajuShareText ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof showShareOptions!=='undefined'){window['showShareOptions']=showShareOptions;console.log('   âœ… showShareOptions ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof copyToClipboard!=='undefined'){window['copyToClipboard']=copyToClipboard;console.log('   âœ… copyToClipboard ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof fallbackCopyToClipboard!=='undefined'){window['fallbackCopyToClipboard']=fallbackCopyToClipboard;console.log('   âœ… fallbackCopyToClipboard ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof shareToKakao!=='undefined'){window['shareToKakao']=shareToKakao;console.log('   âœ… shareToKakao ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
if(typeof shareViaWeb!=='undefined'){window['shareViaWeb']=shareViaWeb;console.log('   âœ… shareViaWeb ê°•ì œ ë“±ë¡ ì™„ë£Œ');}
console.log('ğŸš¨ ê°•ì œ í•¨ìˆ˜ ë“±ë¡ ì™„ë£Œ!');console.log('ğŸ” ê°•ì œ ë“±ë¡ í›„ ìƒíƒœ í™•ì¸:');console.log('   - checkSajuResult:',typeof window['checkSajuResult']);console.log('   - checkMemberLogin:',typeof window['checkMemberLogin']);console.log('   - generateSajuShareText:',typeof window['generateSajuShareText']);console.log('   - showShareOptions:',typeof window['showShareOptions']);},3000);function diagnoseDOMState(){console.log('=== ğŸ” DOM ìƒíƒœ ì§„ë‹¨ ===');console.log('1. ë¬¸ì„œ ìƒíƒœ:',document.readyState);console.log('2. í˜„ì¬ ì‹œê°„:',new Date().toLocaleTimeString());console.log('3. ë²„íŠ¼ ì¡´ì¬ ì—¬ë¶€:');console.log('   - DBì €ì¥:',!!document.getElementById('db-save-btn'));console.log('   - ë³´ë‚´ê¸°:',!!document.getElementById('send-btn'));console.log('   - DBë³´ê¸°:',!!document.getElementById('db-view-btn'));console.log('4. í•¨ìˆ˜ ë“±ë¡ ìƒíƒœ:');console.log('   - checkSajuResult:',typeof window['checkSajuResult']);console.log('   - checkMemberLogin:',typeof window['checkMemberLogin']);console.log('   - generateSajuShareText:',typeof window['generateSajuShareText']);const dbBtn=document.getElementById('db-save-btn');if(dbBtn){const hasClickListener=dbBtn.onclick!==null||(dbBtn.getAttribute&&dbBtn.getAttribute('onclick'))||(window.getEventListeners&&Object.keys(window.getEventListeners(dbBtn)).length>0);console.log('5. DBì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ:',hasClickListener?'ë“±ë¡ë¨':'ì—†ìŒ');}
console.log('========================');}
diagnoseDOMState();if(document.readyState==='loading'){console.log('ğŸ“‹ ë¬¸ì„œ ë¡œë”© ì¤‘ - DOMContentLoaded ëŒ€ê¸°');}else if(document.readyState==='interactive'){console.log('ğŸ“‹ ë¬¸ì„œ ì¸í„°ë™í‹°ë¸Œ ìƒíƒœ - DOM ì¤€ë¹„ë¨');}else if(document.readyState==='complete'){console.log('ğŸ“‹ ë¬¸ì„œ ì™„ì „ ë¡œë“œë¨ - ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì¤€ë¹„');}
function registerButtonEvents(){console.log('ğŸš€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì‹œì‘');setTimeout(()=>{console.log('ğŸ”„ ìƒíƒœ ì¬ì§„ë‹¨:');diagnoseDOMState();},100);const dbViewBtn=document.getElementById('db-view-btn');if(dbViewBtn){console.log('ğŸ”§ DBë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì‹œì‘...');dbViewBtn.addEventListener('click',function(event){console.log('=====================================');console.log('ğŸ” DBë³´ê¸° ë²„íŠ¼ í´ë¦­ë¨');console.log('   - ì´ë²¤íŠ¸ íƒ€ì…:',event.type);console.log('   - íƒ€ê²Ÿ:',event.target);console.log('=====================================');console.log('1ï¸âƒ£ íšŒì› ë¡œê·¸ì¸ ì²´í¬ ì‹œì‘...');const memberId=window['checkMemberLogin']();console.log('   - checkMemberLogin() ë°˜í™˜ê°’:',memberId);if(!memberId){console.log('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - redirectToLogin í˜¸ì¶œ');window['redirectToLogin']('íšŒì› ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');return;}
console.log('âœ… ë¡œê·¸ì¸ í™•ì¸ ì™„ë£Œ - memberId:',memberId);window['saveFormData']();console.log('ğŸ’¾ í˜„ì¬ í™”ë©´ ë°ì´í„° ì €ì¥ ì™„ë£Œ (DBë³´ê¸° ì´ë™ ì „)');console.log('ğŸ”’ í•„í„° ì¡°ê±´:',{snsgu:'B0001',smember_id:memberId,});window.location.href=`/secret/tickboard?snsgu=B0001&smember_id=${memberId}`;});console.log('âœ… DBë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');}else{console.error('âŒ DBë³´ê¸° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
const dbSaveBtn=document.getElementById('db-save-btn');if(dbSaveBtn){console.log('ğŸ”§ DBì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì‹œì‘...');dbSaveBtn.addEventListener('click',async function(event){console.log('=====================================');console.log('ğŸ’¾ DBì €ì¥ ë²„íŠ¼ í´ë¦­ë¨');console.log('   - ì´ë²¤íŠ¸ íƒ€ì…:',event.type);console.log('   - íƒ€ê²Ÿ:',event.target);console.log('=====================================');console.log('1ï¸âƒ£ ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ ì²´í¬...');const sajuResultExists=window['checkSajuResult']();console.log('   - checkSajuResult() ë°˜í™˜ê°’:',sajuResultExists);if(!sajuResultExists){console.log('âŒ ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ ì—†ìŒ - alert í‘œì‹œ');alert('ë¨¼ì € "ì‚¬ì£¼ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‚¬ì£¼ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.');return;}
console.log('âœ… ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ í™•ì¸ ì™„ë£Œ');console.log('2ï¸âƒ£ íšŒì› ë¡œê·¸ì¸ ì²´í¬ ì‹œì‘...');const memberId=window['checkMemberLogin']();console.log('   - checkMemberLogin() ë°˜í™˜ê°’:',memberId);console.log('   - íƒ€ì…:',typeof memberId);console.log('   - Boolean:',!!memberId);if(!memberId){console.log('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - redirectToLogin í˜¸ì¶œ');window['redirectToLogin']('íšŒì› ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');return;}
console.log('âœ… ë¡œê·¸ì¸ í™•ì¸ ì™„ë£Œ - memberId:',memberId);console.log('3ï¸âƒ£ DBì €ì¥ í”„ë¡œì„¸ìŠ¤ ì‹œì‘...');try{const nameInput=document.getElementById('name');const yearInput=document.getElementById('year');const monthInput=document.getElementById('month');const dayInput=document.getElementById('day');const hourInput=document.getElementById('hour');const minuteInput=document.getElementById('minute');const calendarRadio=document.querySelector('input[name="calendar"]:checked');const yundalCheckbox=document.getElementById('yundal');const genderRadio=document.querySelector('input[name="gender"]:checked');const hourJiInput=document.getElementById('hour-ji-select');if(!nameInput||!nameInput.value.trim()){alert('ì„±ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
if(!yearInput||!yearInput.value||!monthInput||!monthInput.value||!dayInput||!dayInput.value){alert('ìƒë…„ì›”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');return;}
const year=yearInput.value;const month=String(monthInput.value).padStart(2,'0');const day=String(dayInput.value).padStart(2,'0');const hour=hourInput&&hourInput.value?String(hourInput.value).padStart(2,'0'):'00';const minute=minuteInput&&minuteInput.value?String(minuteInput.value).padStart(2,'0'):'00';const birthDatetime=`${year}-${month}-${day}T${hour}:${minute}:00`;console.log('ğŸ“… birth_datetime ìƒì„±:',birthDatetime,`(${year}ë…„ ${month}ì›” ${day}ì¼ ${hour}ì‹œ ${minute}ë¶„)`);console.log('ğŸ“ content_enc ìƒì„± ì‹œì‘');let contentText='';contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;contentText+=`ğŸ“Š ì‚¬ì£¼íŒ”ì ë¶„ì„ ê²°ê³¼\n`;contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;const userInfoDisplay=document.getElementById('user-info-display');console.log('   - user-info-display ìš”ì†Œ:',userInfoDisplay?'ì°¾ìŒ':'ì—†ìŒ');if(userInfoDisplay){const nameAgeElement=userInfoDisplay.querySelector('h3');if(nameAgeElement){const nameAgeText=nameAgeElement.textContent.trim();contentText+=`ğŸ‘¤ ${nameAgeText}\n\n`;console.log('   - ì´ë¦„/ë‚˜ì´:',nameAgeText);}
const infoBoxes=userInfoDisplay.querySelectorAll('div[style*="background:white"]');console.log('   - ì •ë³´ ë°•ìŠ¤ ê°œìˆ˜:',infoBoxes.length);infoBoxes.forEach((box,idx)=>{const label=box.querySelector('div[style*="color:#6c757d"]');const value=box.querySelector('div[style*="font-weight:700"]');if(label&&value){const labelText=label.textContent.trim();const valueText=value.textContent.trim();contentText+=`${labelText}: ${valueText}\n`;console.log(`   - ì •ë³´[${idx}] ${labelText}: ${valueText}`);}});contentText+=`\n`;}else{console.warn('âš ï¸ user-info-displayë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì£¼ ë¶„ì„ì„ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.');}
contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;contentText+=`ğŸ”® å››æŸ±å…«å­— (ì‚¬ì£¼íŒ”ì)\n`;contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;console.log('   - ì‚¬ì£¼ê¸°ë‘¥ ì •ë³´ ì¶”ì¶œ ì‹œì‘');const pillars=['hour','day','month','year'];const pillarNames=['æ™‚æŸ±(ì‹œì£¼)','æ—¥æŸ±(ì¼ì£¼)â­','æœˆæŸ±(ì›”ì£¼)','å¹´æŸ±(ë…„ì£¼)',];const pillarDescs=['ë§ë…„Â·ìì‹Â·55ì„¸ ì´í›„','ë³¸ì¸Â·ë°°ìš°ìÂ·33-55ì„¸','ë¶€ëª¨Â·ì§ì¥Â·17-33ì„¸','ì¡°ìƒÂ·ì–´ë¦°ì‹œì ˆÂ·1-17ì„¸',];const sajuGanList=[];const sajuJiList=[];pillars.forEach((pillar,idx)=>{const ganEl=document.getElementById(`${pillar}-gan`);const jiEl=document.getElementById(`${pillar}-ji`);if(ganEl&&jiEl){const ganDivs=ganEl.querySelectorAll('div');const jiDivs=jiEl.querySelectorAll('div');let ganText='';let jiText='';if(ganDivs.length>=2){ganText=ganDivs[1].textContent.trim();}else{ganText=ganEl.textContent.trim().split('\n').filter((t)=>t.trim())[0]||'';}
if(jiDivs.length>=2){jiText=jiDivs[0].textContent.trim();}else{jiText=jiEl.textContent.trim().split('\n').filter((t)=>t.trim())[0]||'';}
sajuGanList.push(ganText);sajuJiList.push(jiText);}});if(sajuGanList.length===4&&sajuJiList.length===4){contentText+=`ã€æ™‚æŸ±(ì‹œì£¼)ã€‘: "${sajuGanList[0]}${sajuJiList[0]}" / ã€æ—¥æŸ±(ì¼ì£¼)â­ã€‘: "${sajuGanList[1]}${sajuJiList[1]}" / ã€æœˆæŸ±(ì›”ì£¼)ã€‘: "${sajuGanList[2]}${sajuJiList[2]}" / ã€å¹´æŸ±(ë…„ì£¼)ã€‘: "${sajuGanList[3]}${sajuJiList[3]}"\n\n`;console.log('   - ì‚¬ì£¼íŒ”ì ìš”ì•½ (ê°„ê²° í˜•íƒœ):');console.log(`     æ™‚: ${sajuGanList[0]}${sajuJiList[0]}, æ—¥: ${sajuGanList[1]}${sajuJiList[1]}, æœˆ: ${sajuGanList[2]}${sajuJiList[2]}, å¹´: ${sajuGanList[3]}${sajuJiList[3]}`);}
pillars.forEach((pillar,idx)=>{const ganEl=document.getElementById(`${pillar}-gan`);const jiEl=document.getElementById(`${pillar}-ji`);const sibiunEl=document.getElementById(`${pillar}-sibiun`);const napeumEl=document.getElementById(`${pillar}-napeum`);const gongmangEl=document.getElementById(`${pillar}-gongmang`);console.log(`   - ${pillarNames[idx]}: gan=${ganEl ? 'O' : 'X'}, ji=${
              jiEl ? 'O' : 'X'
            }`);if(ganEl&&jiEl){const ganDivs=ganEl.querySelectorAll('div');let ganText='';let ganSipseong='';if(ganDivs.length>=2){ganSipseong=ganDivs[0].textContent.trim();ganText=ganDivs[1].textContent.trim();}else{ganText=ganEl.textContent.trim().split('\n').filter((t)=>t.trim())[0]||'';}
const jiDivs=jiEl.querySelectorAll('div');let jiText='';let jiSipseong='';if(jiDivs.length>=2){jiText=jiDivs[0].textContent.trim();jiSipseong=jiDivs[1].textContent.trim();}else{jiText=jiEl.textContent.trim().split('\n').filter((t)=>t.trim())[0]||'';}
const sibiun=sibiunEl?sibiunEl.textContent.trim():'';const napeum=napeumEl?napeumEl.textContent.trim():'';const gongmang=gongmangEl&&gongmangEl.classList.contains('empty')?'ê³µë§':'';contentText+=`ã€${pillarNames[idx]}ã€‘ ${pillarDescs[idx]}\n`;contentText+=`  å¤©å¹²: ${ganText} ${ganSipseong}\n`;contentText+=`  åœ°æ”¯: ${jiText} ${jiSipseong}\n`;if(sibiun)contentText+=`  åäºŒé‹: ${sibiun}\n`;if(napeum)contentText+=`  ç´éŸ³: ${napeum}\n`;if(gongmang)contentText+=`  ç©ºäº¡: ${gongmang}\n`;contentText+=`\n`;}});console.log('   - ì˜¤í–‰ ë¶„ì„ ì •ë³´ ì¶”ì¶œ ì‹œì‘');const elementSummary=document.getElementById('element-summary-header');console.log('   - element-summary-header:',elementSummary?'ì°¾ìŒ':'ì—†ìŒ');if(elementSummary){contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;contentText+=`ğŸŒŸ ì˜¤í–‰ ë¶„ì„\n`;contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;const summaryText=elementSummary.textContent.trim().replace(/\(í´ë¦­:ç¥æ®ºë³´ê¸°\)/g,'').trim();contentText+=summaryText+`\n\n`;console.log('   - ì˜¤í–‰ ìš”ì•½:',summaryText.substring(0,50));const detailsDiv=document.getElementById('element-summary-details');if(detailsDiv){const detailItems=detailsDiv.querySelectorAll('div[style*="margin-bottom"]');console.log('   - ìƒì„¸ í•­ëª© ê°œìˆ˜:',detailItems.length);detailItems.forEach((item)=>{const itemText=item.textContent.trim().replace(/\s+/g,' ').replace(/\//g,'\n  ');if(itemText&&!itemText.includes('ì—†ìŒ')&&itemText.length>5){contentText+=itemText+`\n`;}});}
contentText+=`\n`;}
const saveDateTime=new Date().toLocaleString('ko-KR');contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;contentText+=`ì €ì¥ì¼ì‹œ: ${saveDateTime}\n`;contentText+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;console.log('   - ì €ì¥ì¼ì‹œ:',saveDateTime);console.log('âœ… content_enc ìƒì„± ì™„ë£Œ (ì´',contentText.length,'ì)');let memberId=null;if(window.MEMBER_SESSION&&window.MEMBER_SESSION.sMem_id){memberId=window.MEMBER_SESSION.sMem_id;console.log('âœ… MEMBER_SESSIONì—ì„œ íšŒì› ID:',memberId);}else if(typeof window.sMem_id!=='undefined'&&window.sMem_id){memberId=window.sMem_id;console.log('âœ… window.sMem_idì—ì„œ íšŒì› ID:',memberId);}else if(typeof sMem_id!=='undefined'&&sMem_id){memberId=sMem_id;console.log('âœ… ì „ì—­ sMem_idì—ì„œ íšŒì› ID:',memberId);}
if(!memberId){console.log('âš ï¸ íšŒì› IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');console.log('ğŸ“‹ DBì €ì¥ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘');console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');const title='ì¼ë°˜ì‚¬ì£¼ë³´ê¸°';const title_masked='ì¼ë°˜ì‚¬ì£¼ë³´ê¸°';console.log('1. title:',title);console.log('2. title_masked:',title_masked);const author_name=nameInput.value.trim();console.log('3. author_name:',author_name);console.log('4. birth_datetime:',birthDatetime);const timeInputTypeRadio=document.querySelector('input[name="timeInputType"]:checked');const isTimeInput=timeInputTypeRadio&&timeInputTypeRadio.value==='time';const isGanjiInput=timeInputTypeRadio&&timeInputTypeRadio.value==='ganji';console.log('5. ì‹œê° ì…ë ¥ ë°©ì‹:',isTimeInput?'ì‹œê° ì…ë ¥':isGanjiInput?'ê°„ì§€ ì…ë ¥':'ì•Œ ìˆ˜ ì—†ìŒ');let birth_hour=null;let birth_minute=null;let hour_ji='';if(isTimeInput){birth_hour=hourInput&&hourInput.value?parseInt(hourInput.value):0;birth_minute=minuteInput&&minuteInput.value?parseInt(minuteInput.value):0;hour_ji='';console.log('   âœ… ì‹œê° ì…ë ¥ ëª¨ë“œ - birth_hour:',birth_hour,', birth_minute:',birth_minute);console.log('   âœ… hour_ji ì´ˆê¸°í™”: ""');}else if(isGanjiInput){birth_hour=null;birth_minute=null;hour_ji=hourJiInput&&hourJiInput.value?hourJiInput.value:'';console.log('   âœ… ê°„ì§€ ì…ë ¥ ëª¨ë“œ - hour_ji:',hour_ji);console.log('   âœ… birth_hour ì´ˆê¸°í™”: null');console.log('   âœ… birth_minute ì´ˆê¸°í™”: null');}
const birth_year=yearInput&&yearInput.value?parseInt(yearInput.value):0;console.log('7. birth_year:',birth_year,'(ì…ë ¥ê°’:',yearInput?.value,')');const calendar_type=calendarRadio&&calendarRadio.value==='solar'?'ì–‘ë ¥':'ìŒë ¥';console.log('8. calendar_type:',calendar_type,'(ë¼ë””ì˜¤ê°’:',calendarRadio?.value,')');const yundal=yundalCheckbox&&yundalCheckbox.checked?'Y':'N';console.log('9. yundal:',yundal,'(ì²´í¬ë¨:',yundalCheckbox?.checked,')');const author_gender=genderRadio&&genderRadio.value==='male'?'M':'F';console.log('10. author_gender:',author_gender,'(ë¼ë””ì˜¤ê°’:',genderRadio?.value,')');console.log('11. content_enc ê¸¸ì´:',contentText.length,'ì');console.log('    content_enc ë¯¸ë¦¬ë³´ê¸°:',contentText.substring(0,100)+'...');console.log('12. created_at: ì„œë²„ì—ì„œ ìë™ ìƒì„±');console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');const data={title:title,title_masked:title_masked,content:`ì„±ëª…: ${author_name}, ìƒë…„ì›”ì¼: ${birthDatetime}`,content_enc:contentText,post_password:'saju2024',author_name:author_name,birth_datetime:birthDatetime,birth_hour:birth_hour,birth_minute:birth_minute,birth_year:birth_year,calendar_type:calendar_type,yundal:yundal,author_gender:author_gender,hour_ji:hour_ji,snsgu:'B0001',smember_id:memberId,agreement:1,};console.log('ğŸ“¦ ìµœì¢… ì €ì¥ ë°ì´í„°:',JSON.stringify(data,null,2));let url='/secret/api/v1/tickets';let method='POST';let shouldResetTicketId=false;if(currentTicketId){console.log('ğŸ“ ê¸°ì¡´ ticket_id ì¡´ì¬:',currentTicketId);const userChoice=confirm('ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤.\n\n'+'[í™•ì¸] = ìˆ˜ì •í•˜ê¸° (ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸)\n'+'[ì·¨ì†Œ] = ì¶”ê°€í•˜ê¸° (ìƒˆë¡œìš´ ë°ì´í„° ìƒì„±)\n\n'+'ì–´ë–»ê²Œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');if(userChoice){url=`/secret/api/v1/tickets/${currentTicketId}`;method='PUT';shouldResetTicketId=true;console.log('ğŸ”„ ì‚¬ìš©ì ì„ íƒ: ê¸°ì¡´ í‹°ì¼“ ìˆ˜ì •');}else{method='POST';console.log('â• ì‚¬ìš©ì ì„ íƒ: ìƒˆ í‹°ì¼“ ìƒì„±');}}else{console.log('â• ticket_id ì—†ìŒ - ìƒˆ í‹°ì¼“ ìƒì„±');}
console.log('ğŸŒ API í˜¸ì¶œ ì‹œì‘:',method,url);const response=await fetch(url,{method:method,headers:{'Content-Type':'application/json',},body:JSON.stringify(data),});console.log('ğŸ“¡ API ì‘ë‹µ ìƒíƒœ:',response.status,response.statusText);const result=await response.json();console.log('ğŸ“¦ API ì‘ë‹µ ë°ì´í„°:',result);if(result.ok){if(method==='POST'&&result.ticket_id){currentTicketId=result.ticket_id;console.log('âœ… ì €ì¥ ì™„ë£Œ. ticket_id:',currentTicketId);}else if(method==='PUT'&&shouldResetTicketId){console.log('ğŸ”„ ìˆ˜ì • ì™„ë£Œ - ticket_id ì´ˆê¸°í™”:',currentTicketId,'â†’ null');currentTicketId=null;const url=new URL(window.location.href);url.searchParams.delete('ticket_id');window.history.replaceState({},'',url.toString());console.log('âœ… URLì—ì„œ ticket_id íŒŒë¼ë¯¸í„° ì œê±° ì™„ë£Œ');}
sessionStorage.removeItem('sajuFormData');sessionStorage.removeItem('returnAfterLogin');alert(method==='POST'?'DBì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.':'DBê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');}else{console.error('âŒ ì €ì¥ ì‹¤íŒ¨:',result.error);alert('ì €ì¥ ì‹¤íŒ¨: '+(result.error||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));}}catch(error){console.error('âŒ DB ì €ì¥ ì˜¤ë¥˜:',error);console.error('   ì˜¤ë¥˜ ìƒì„¸:',error.message);console.error('   ìŠ¤íƒ:',error.stack);alert('DB ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n'+error.message);}});console.log('âœ… DBì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');}else{console.error('âŒ DBì €ì¥ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}
const sendBtn=document.getElementById('send-btn');if(sendBtn){console.log('ğŸ”§ ë³´ë‚´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì‹œì‘...');sendBtn.addEventListener('click',function(event){console.log('=====================================');console.log('ğŸ“¤ ë³´ë‚´ê¸° ë²„íŠ¼ í´ë¦­ë¨');console.log('   - ì´ë²¤íŠ¸ íƒ€ì…:',event.type);console.log('   - íƒ€ê²Ÿ:',event.target);console.log('=====================================');console.log('1ï¸âƒ£ ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ ì²´í¬...');const sajuResultExists=window['checkSajuResult']();console.log('   - checkSajuResult() ë°˜í™˜ê°’:',sajuResultExists);if(!sajuResultExists){console.log('âŒ ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ ì—†ìŒ - alert í‘œì‹œ');alert('ë¨¼ì € "ì‚¬ì£¼ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‚¬ì£¼ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.');return;}
console.log('âœ… ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼ í™•ì¸ ì™„ë£Œ');console.log('2ï¸âƒ£ íšŒì› ë¡œê·¸ì¸ ì²´í¬ ì‹œì‘...');const memberId=window['checkMemberLogin']();console.log('   - checkMemberLogin() ë°˜í™˜ê°’:',memberId);if(!memberId){console.log('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - redirectToLogin í˜¸ì¶œ');window['redirectToLogin']('íšŒì› ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');return;}
console.log('âœ… ë¡œê·¸ì¸ í™•ì¸ ì™„ë£Œ - memberId:',memberId);const shareText=window['generateSajuShareText']();if(!shareText){alert('ê³µìœ í•  ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');return;}
window['showShareOptions'](shareText);});console.log('âœ… ë³´ë‚´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');}else{console.error('âŒ ë³´ë‚´ê¸° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');}}
if(document.readyState==='loading'){console.log('â³ DOM ë¡œë”© ì¤‘ - DOMContentLoaded ì´ë²¤íŠ¸ ëŒ€ê¸°');document.addEventListener('DOMContentLoaded',registerButtonEvents);}else{console.log('âœ… DOM ì´ë¯¸ ë¡œë“œë¨ - ë²„íŠ¼ ì´ë²¤íŠ¸ ì¦‰ì‹œ ë“±ë¡');registerButtonEvents();}
function generateSajuShareText(){try{let text='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';text+='ğŸ“Š ì‚¬ì£¼íŒ”ì ë¶„ì„ ê²°ê³¼\n';text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';const userInfoDisplay=document.getElementById('user-info-display');if(userInfoDisplay){const nameAgeElement=userInfoDisplay.querySelector('h3');if(nameAgeElement){text+='ğŸ‘¤ '+nameAgeElement.textContent.trim()+'\n\n';}
const infoBoxes=userInfoDisplay.querySelectorAll('div[style*="background:white"]');infoBoxes.forEach((box)=>{const label=box.querySelector('div[style*="color:#6c757d"]');const value=box.querySelector('div[style*="font-weight:700"]');if(label&&value){text+=label.textContent.trim()+': '+value.textContent.trim()+'\n';}});text+='\n';}
text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';text+='ğŸ”® å››æŸ±å…«å­— (ì‚¬ì£¼íŒ”ì)\n';text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';const pillars=['hour','day','month','year'];const pillarNames=['æ™‚æŸ±(ì‹œì£¼)','æ—¥æŸ±(ì¼ì£¼)â­','æœˆæŸ±(ì›”ì£¼)','å¹´æŸ±(ë…„ì£¼)',];const sajuGanList=[];const sajuJiList=[];pillars.forEach((pillar,idx)=>{const ganEl=document.getElementById(`${pillar}-gan`);const jiEl=document.getElementById(`${pillar}-ji`);if(ganEl&&jiEl){const ganDivs=ganEl.querySelectorAll('div');const jiDivs=jiEl.querySelectorAll('div');let ganText='';let jiText='';if(ganDivs.length>=2){ganText=ganDivs[1].textContent.trim();}else{ganText=ganEl.textContent.trim().split('\n').filter((t)=>t.trim())[0]||'';}
if(jiDivs.length>=2){jiText=jiDivs[0].textContent.trim();}else{jiText=jiEl.textContent.trim().split('\n').filter((t)=>t.trim())[0]||'';}
sajuGanList.push(ganText);sajuJiList.push(jiText);}});if(sajuGanList.length===4&&sajuJiList.length===4){text+=`ã€æ™‚æŸ±(ì‹œì£¼)ã€‘: "${sajuGanList[0]}${sajuJiList[0]}" / ã€æ—¥æŸ±(ì¼ì£¼)â­ã€‘: "${sajuGanList[1]}${sajuJiList[1]}" / ã€æœˆæŸ±(ì›”ì£¼)ã€‘: "${sajuGanList[2]}${sajuJiList[2]}" / ã€å¹´æŸ±(ë…„ì£¼)ã€‘: "${sajuGanList[3]}${sajuJiList[3]}"\n\n`;text+=`ã€æ™‚æŸ±(ì‹œì£¼)ã€‘ã€æ—¥æŸ±(ì¼ì£¼)â­ã€‘ã€æœˆæŸ±(ì›”ì£¼)ã€‘ã€å¹´æŸ±(ë…„ì£¼)ã€‘\n`;text+=`------"${sajuGanList[0]}"----------"${sajuGanList[1]}"------------"${sajuGanList[2]}"----------"${sajuGanList[3]}"-----\n`;text+=`------"${sajuJiList[0]}"----------"${sajuJiList[1]}"------------"${sajuJiList[2]}"----------"${sajuJiList[3]}"-----\n\n`;}
pillars.forEach((pillar,idx)=>{const ganEl=document.getElementById(`${pillar}-gan`);const jiEl=document.getElementById(`${pillar}-ji`);const sibiunEl=document.getElementById(`${pillar}-sibiun`);const napeumEl=document.getElementById(`${pillar}-napeum`);const pillarDescElements=document.querySelectorAll('.pillar-desc');if(ganEl&&jiEl){const ganText=ganEl.textContent.trim().split('\n').filter((t)=>t.trim()).join(' ');const jiText=jiEl.textContent.trim().split('\n').filter((t)=>t.trim()).join(' ');const sibiun=sibiunEl?sibiunEl.textContent.trim():'';const napeum=napeumEl?napeumEl.textContent.trim():'';const pillarDesc=pillarDescElements[idx]?pillarDescElements[idx].textContent.trim():'';text+=`ã€${pillarNames[idx]}ã€‘ ${pillarDesc}\n`;text+=`  å¤©å¹²: ${ganText}\n`;text+=`  åœ°æ”¯: ${jiText}\n`;if(sibiun)text+=`  åäºŒé‹: ${sibiun}\n`;if(napeum)text+=`  ç´éŸ³: ${napeum}\n`;text+='\n';}});const elementSummary=document.getElementById('element-summary-header');if(elementSummary){text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';text+='ğŸŒŸ ì˜¤í–‰ ë¶„ì„\n';text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';const summaryText=elementSummary.textContent.trim().replace(/\(í´ë¦­:ç¥æ®ºë³´ê¸°\)/g,'').trim();text+=summaryText+'\n\n';const detailsDiv=document.getElementById('element-summary-details');if(detailsDiv){const detailItems=detailsDiv.querySelectorAll('div[style*="margin-bottom"]');detailItems.forEach((item)=>{const itemText=item.textContent.trim().replace(/\s+/g,' ').replace(/\//g,'\n  ');if(itemText&&!itemText.includes('ì—†ìŒ')){text+=itemText+'\n';}});}}
text+='\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';text+='ğŸŒŠ å¤§é‹ (ëŒ€ìš´) ê°„ì§€ - 10ë…„ ë‹¨ìœ„ (ì™¼ìª½â†’ì˜¤ë¥¸ìª½)\n';text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';const daeunChart=document.getElementById('daeun-chart');const daeunSummary=document.getElementById('daeun-summary');let daeunFound=false;if(daeunChart&&daeunChart.textContent.trim()){console.log('ğŸ” ëŒ€ìš´ ì°¨íŠ¸ ë°œê²¬, ì „ì²´ í…ìŠ¤íŠ¸ íŒŒì‹± ì‹œì‘...');const chartText=daeunChart.textContent.trim();console.log('ğŸ“„ ëŒ€ìš´ ì°¨íŠ¸ ì›ë³¸:',chartText.substring(0,200));const allDivs=daeunChart.querySelectorAll('div');const daeunData=[];if(allDivs.length>0){console.log('ğŸ“¦ ì´ div ê°œìˆ˜:',allDivs.length);let currentAge=null;let currentGan=null;let currentJi=null;allDivs.forEach((div,idx)=>{const text=div.textContent.trim();if(text.match(/^\d+-\d+ì„¸$/)){if(currentAge&&currentGan&&currentJi){daeunData.push({ageRange:currentAge,gan:currentGan,ji:currentJi,});}
currentAge=text;currentGan=null;currentJi=null;}
else if(currentAge&&!currentGan&&text.length===1&&text.match(/[ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸]/)){currentGan=text;}
else if(currentAge&&currentGan&&!currentJi&&text.length===1&&text.match(/[å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥]/)){currentJi=text;}});if(currentAge&&currentGan&&currentJi){daeunData.push({ageRange:currentAge,gan:currentGan,ji:currentJi,});}
console.log('âœ… ì¶”ì¶œëœ ëŒ€ìš´ ê°œìˆ˜:',daeunData.length);}
if(daeunData.length===0&&chartText){console.log('âš ï¸ div íŒŒì‹± ì‹¤íŒ¨, í…ìŠ¤íŠ¸ ë¼ì¸ íŒŒì‹± ì‹œë„...');const lines=chartText.split('\n').map((line)=>line.trim()).filter((line)=>line.length>0);console.log('ğŸ“ ì´ ë¼ì¸ ìˆ˜:',lines.length);console.log('ğŸ“ ì²« 10ì¤„:',lines.slice(0,10));for(let i=0;i<lines.length;i+=3){if(i+2<lines.length){const line1=lines[i];const line2=lines[i+1];const line3=lines[i+2];if(line1.match(/\d+-\d+ì„¸/)){daeunData.push({ageRange:line1,gan:line2,ji:line3,});}}}
console.log('âœ… ë¼ì¸ íŒŒì‹± ê²°ê³¼:',daeunData.length,'ê°œ');}
if(daeunData.length>0){console.log('ğŸ‰ ìµœì¢… ëŒ€ìš´ ë°ì´í„°:',daeunData.length,'ê°œ');daeunData.reverse();const ageRangeLine=daeunData.map((d)=>d.ageRange.padEnd(13,' ')).join('');const ganLine=daeunData.map((d)=>d.gan.padEnd(13,' ')).join('');const jiLine=daeunData.map((d)=>d.ji.padEnd(13,' ')).join('');text+=ageRangeLine+'\n';text+=ganLine+'\n';text+=jiLine+'\n';daeunFound=true;console.log('âœ… ëŒ€ìš´ í…ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ!');}else{console.warn('âš ï¸ ëŒ€ìš´ ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨, ì›ë³¸ í‘œì‹œ');const lines=chartText.split('\n').map((line)=>line.trim()).filter((line)=>line.length>0);lines.forEach((line)=>{text+=line+'\n';});daeunFound=true;}}
if(daeunSummary&&daeunSummary.textContent.trim()){const summaryText=daeunSummary.textContent.trim().replace(/\s+/g,' ').replace(/í˜„ì¬ ëŒ€ìš´:/g,'\nğŸ“ í˜„ì¬ ëŒ€ìš´:').replace(/ë‹¤ìŒ ëŒ€ìš´:/g,'\nâ¡ï¸ ë‹¤ìŒ ëŒ€ìš´:').replace(/ëŒ€ìš´ ì „í™˜:/g,'\nğŸ”„ ëŒ€ìš´ ì „í™˜:').trim();if(summaryText){text+='\n'+summaryText+'\n';daeunFound=true;}}
if(!daeunFound){text+='ëŒ€ìš´ ì •ë³´ë¥¼ í‘œì‹œí•˜ë ¤ë©´ "ì‚¬ì£¼ë³´ê¸°"ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.\n';}
text+='\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';text+='ğŸ“… å¹´é‹ (ë…„ìš´) ê°„ì§€ - í•´ë‹¹ë…„ë„\n';text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';let yeonunData=[];const currentYear=new Date().getFullYear();const currentYearStr=currentYear+'ë…„';if(window.lastYeonunResult&&Array.isArray(window.lastYeonunResult)&&window.lastYeonunResult.length>0){console.log('âœ… ì „ì—­ ë³€ìˆ˜ì—ì„œ ë…„ìš´ ë°ì´í„° ë°œê²¬:',window.lastYeonunResult.length,'ê°œ');console.log('ğŸ¯ í˜„ì¬ ë…„ë„ í•„í„°ë§:',currentYearStr,'(ìˆ«ì:',currentYear,')');console.log('ğŸ“Š ì²« ë²ˆì§¸ API ë°ì´í„° ìƒ˜í”Œ:',window.lastYeonunResult[0]);const currentYearData=window.lastYeonunResult.find((item)=>item.year===currentYear);if(currentYearData){console.log('ğŸ” ì°¾ì€ ì›ë³¸ ë°ì´í„°:',currentYearData);console.log('  - year:',currentYearData.year);console.log('  - gan:',currentYearData.gan);console.log('  - ji:',currentYearData.ji);yeonunData=[{year:currentYearData.year+'ë…„',gan:currentYearData.gan,ji:currentYearData.ji,},];console.log('âœ… í˜„ì¬ ë…„ë„ ë…„ìš´ ë°œê²¬:',yeonunData[0]);}else{console.warn('âš ï¸ í˜„ì¬ ë…„ë„ ë…„ìš´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:',currentYear);}
console.log('ğŸ‰ ì „ì—­ ë³€ìˆ˜ì—ì„œ ìµœì¢… ë…„ìš´ ë°ì´í„°:',yeonunData.length,'ê°œ');}
const sewunAnalysis=document.getElementById('sewun-analysis');if(yeonunData.length===0&&sewunAnalysis&&sewunAnalysis.textContent.trim()){console.log('ğŸ” DOMì—ì„œ í˜„ì¬ ë…„ë„ ë…„ìš´ íŒŒì‹± ì‹œì‘...');console.log('ğŸ¯ ì°¾ì„ ë…„ë„:',currentYearStr);const sewunFullText=sewunAnalysis.textContent.trim();console.log('ğŸ“„ ë…„ìš´ ì›ë³¸:',sewunFullText.substring(0,200));const allElements=sewunAnalysis.querySelectorAll('*');console.log('ğŸ“¦ ì´ ìš”ì†Œ ê°œìˆ˜:',allElements.length);if(allElements.length>0){let foundYear=null;let foundGan=null;let foundJi=null;let debugCount=0;let isCurrentYear=false;allElements.forEach((elem,idx)=>{const text=elem.textContent.trim();if(elem.children.length===0&&text.length>0){if(debugCount<20){console.log(`  [${idx}] í…ìŠ¤íŠ¸: "${text}"`);debugCount++;}
if(text.match(/^\d{4}ë…„$/)){if(text===currentYearStr){console.log(`  ğŸ¯ í˜„ì¬ ë…„ë„ ë°œê²¬: ${text}`);isCurrentYear=true;foundYear=text;foundGan=null;foundJi=null;}else{console.log(`  â­ï¸ ë‹¤ë¥¸ ë…„ë„ ê±´ë„ˆëœ€: ${text}`);isCurrentYear=false;}}
else if(isCurrentYear){if(!foundGan&&text.length===1&&text.match(/[ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸]/)){console.log(`  âœ“ ì²œê°„ ë°œê²¬: ${text}`);foundGan=text;}
else if(foundGan&&!foundJi&&text.length===1&&text.match(/[å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥]/)){console.log(`  âœ“ ì§€ì§€ ë°œê²¬: ${text}`);foundJi=text;if(foundYear&&foundGan&&foundJi){console.log(`  âœ… í˜„ì¬ ë…„ë„ ë…„ìš´ ì™„ì„±: ${foundYear} ${foundGan}${foundJi}`);yeonunData.push({year:foundYear,gan:foundGan,ji:foundJi,});return;}}}}});console.log('âœ… ì¶”ì¶œëœ ë…„ìš´ ê°œìˆ˜:',yeonunData.length);}
if(yeonunData.length===0&&sewunFullText){console.log('âš ï¸ div íŒŒì‹± ì‹¤íŒ¨, í…ìŠ¤íŠ¸ ë¼ì¸ íŒŒì‹± ì‹œë„...');console.log('ğŸ¯ ì°¾ì„ ë…„ë„:',currentYearStr);const lines=sewunFullText.split('\n').map((line)=>line.trim()).filter((line)=>line.length>0);console.log('ğŸ“ ì´ ë¼ì¸ ìˆ˜:',lines.length);console.log('ğŸ“ ì²« 10ì¤„:',lines.slice(0,10));for(let i=0;i<lines.length;i++){const line=lines[i];if(line===currentYearStr){console.log(`  ğŸ¯ í˜„ì¬ ë…„ë„ ë°œê²¬: ${line}`);if(i+2<lines.length){const gan=lines[i+1];const ji=lines[i+2];console.log(`  âœ“ ì²œê°„: ${gan}, ì§€ì§€: ${ji}`);yeonunData.push({year:line,gan:gan,ji:ji,});break;}}}
console.log('âœ… ë¼ì¸ íŒŒì‹± ê²°ê³¼:',yeonunData.length,'ê°œ');}}
if(yeonunData.length>0){console.log('ğŸ‰ ìµœì¢… ë…„ìš´ ë°ì´í„°:',yeonunData.length,'ê°œ');console.log('ğŸ“Š ë…„ìš´ ë°ì´í„° êµ¬ì¡°:',yeonunData[0]);const data=yeonunData[0];const year=data.year||'';const gan=data.gan||'';const ji=data.ji||'';console.log('ğŸ” ë…„ìš´ ìƒì„¸:');console.log('  - year:',year);console.log('  - gan:',gan);console.log('  - ji:',ji);console.log('  - í•©ì¹œ ê²°ê³¼:',`${gan}${ji}`);text+=`ğŸ“ ${year}: ${gan}${ji}\n`;console.log('âœ… ë…„ìš´ í…ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ!');}else{console.warn('âš ï¸ í˜„ì¬ ë…„ë„ ë…„ìš´ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');text+='í˜„ì¬ ë…„ë„ ë…„ìš´ ì •ë³´ë¥¼ í‘œì‹œí•˜ë ¤ë©´ "ì‚¬ì£¼ë³´ê¸°"ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.\n';}
text+='\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';text+='ğŸŒ ë‚˜ë¼í†¡í†¡ ì‚¬ì£¼í’€ì´\n';text+=window.location.origin+'/saju/\n';text+='â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';return text;}catch(error){console.error('âŒ í…ìŠ¤íŠ¸ ìƒì„± ì˜¤ë¥˜:',error);return null;}}
function showShareOptions(text){const modal=document.createElement('div');modal.style.cssText=`
            position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
        `;const modalContent=document.createElement('div');modalContent.style.cssText=`
          background: white;
          padding: 30px;
          border-radius: 15px;
          max-width: 500px;
          width: 90%;
          box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        `;const isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);modalContent.innerHTML=`
          <h3 style="margin-top:0;color:#333;text-align:center;">ğŸ“¤ ê³µìœ  ë°©ë²• ì„ íƒ</h3>
          <div style="display:flex;flex-direction:column;gap:10px;margin-top:20px;">
            ${
              isMobile
                ? `<button id="shareSMSBtn"style="padding:15px;font-size:16px;border:2px solid #FF9800;background:#FF9800;color:white;border-radius:8px;cursor:pointer;font-weight:600;">ğŸ’¬ ë¬¸ì(SMS)ë¡œ ê³µìœ </button><button id="shareWebBtn"style="padding:15px;font-size:16px;border:2px solid #2196F3;background:#2196F3;color:white;border-radius:8px;cursor:pointer;font-weight:600;">ğŸŒ ì¹´í†¡ë“± ê¸°íƒ€ ì•±ìœ¼ë¡œ ê³µìœ </button>`
                : ''
            }
            <button id="copyTextBtn" style="padding:15px;font-size:16px;border:2px solid #4CAF50;background:#4CAF50;color:white;border-radius:8px;cursor:pointer;font-weight:600;">
              ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬í•˜ê¸°
            </button>
            <button id="closeModalBtn" style="padding:15px;font-size:16px;border:2px solid #ccc;background:white;color:#666;border-radius:8px;cursor:pointer;margin-top:10px;">
              ì·¨ì†Œ
            </button>
          </div>
        `;modal.appendChild(modalContent);document.body.appendChild(modal);document.getElementById('copyTextBtn').addEventListener('click',()=>{window['copyToClipboard'](text);document.body.removeChild(modal);});if(isMobile){document.getElementById('shareSMSBtn').addEventListener('click',()=>{window['shareToSMS'](text);document.body.removeChild(modal);});document.getElementById('shareWebBtn').addEventListener('click',()=>{window['shareViaWeb'](text);document.body.removeChild(modal);});}
document.getElementById('closeModalBtn').addEventListener('click',()=>{document.body.removeChild(modal);});modal.addEventListener('click',(e)=>{if(e.target===modal){document.body.removeChild(modal);}});}
function copyToClipboard(text){if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(text).then(()=>{alert('âœ… í…ìŠ¤íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V)í•˜ì„¸ìš”.');}).catch((err)=>{console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:',err);window['fallbackCopyToClipboard'](text);});}else{window['fallbackCopyToClipboard'](text);}}
function fallbackCopyToClipboard(text){const textArea=document.createElement('textarea');textArea.value=text;textArea.style.position='fixed';textArea.style.left='-999999px';document.body.appendChild(textArea);textArea.select();try{document.execCommand('copy');alert('âœ… í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');}catch(err){alert('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');prompt('ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:',text);}
document.body.removeChild(textArea);}
function shareToKakao(text){console.log('ğŸ“± ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì‹œë„...');console.log('ğŸ“ ì „ì†¡í•  í…ìŠ¤íŠ¸ ê¸¸ì´:',text.length);console.log('ğŸ“ í…ìŠ¤íŠ¸ ë‚´ìš© (ì²˜ìŒ 100ì):',text.substring(0,100));const kakaoUrl=`kakaotalk://send?text=${encodeURIComponent(text)}`;console.log('ğŸ”— ì¹´ì¹´ì˜¤í†¡ URL ìƒì„± ì™„ë£Œ');try{window.location.href=kakaoUrl;console.log('âœ… ì¹´ì¹´ì˜¤í†¡ ì‹¤í–‰ ì‹œë„ ì™„ë£Œ');}catch(error){console.error('âŒ ì¹´ì¹´ì˜¤í†¡ ì‹¤í–‰ ì˜¤ë¥˜:',error);alert('ì¹´ì¹´ì˜¤í†¡ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì¹´ì¹´ì˜¤í†¡ì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');}}
function shareToSMS(text){console.log('ğŸ“± SMS ê³µìœ  ì‹œë„...');const isIOS=/iPhone|iPad|iPod/i.test(navigator.userAgent);const smsUrl=isIOS?`sms:&body=${encodeURIComponent(text)}`:`sms:?body=${encodeURIComponent(text)}`;window.location.href=smsUrl;}
function shareViaWeb(text){console.log('ğŸ“± ì›¹ ê³µìœ  API ì‹œë„...');if(navigator.share){navigator.share({title:'ğŸ“Š ì‚¬ì£¼íŒ”ì ë¶„ì„ ê²°ê³¼',text:text,}).then(()=>{console.log('âœ… ì›¹ ê³µìœ  ì™„ë£Œ');}).catch((error)=>{if(error.name==='AbortError'){console.log('â„¹ï¸ ì‚¬ìš©ìê°€ ê³µìœ ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');}else{console.error('âŒ ì›¹ ê³µìœ  ì‹¤íŒ¨:',error);if(confirm('ê³µìœ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\ní…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){window['copyToClipboard'](text);}}});}else{alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ì›¹ ê³µìœ ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\ní…ìŠ¤íŠ¸ ë³µì‚¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');window['copyToClipboard'](text);}}
console.log('ğŸ”§ í•¨ìˆ˜ ë“±ë¡ ì‹œì‘...');window['loadTicketData']=loadTicketData;window['checkMemberLogin']=checkMemberLogin;window['checkSajuResult']=checkSajuResult;window['redirectToLogin']=redirectToLogin;window['saveFormData']=saveFormData;window['restoreFormData']=restoreFormData;window['generateSajuShareText']=generateSajuShareText;window['showShareOptions']=showShareOptions;window['copyToClipboard']=copyToClipboard;window['fallbackCopyToClipboard']=fallbackCopyToClipboard;window['shareToKakao']=shareToKakao;window['shareToSMS']=shareToSMS;window['shareViaWeb']=shareViaWeb;console.log('âœ… ëª¨ë“  í•¨ìˆ˜ ë“±ë¡ ì™„ë£Œ!');console.log('ğŸ” í•¨ìˆ˜ ë“±ë¡ ìƒíƒœ í™•ì¸:');console.log('   - checkSajuResult:',typeof window['checkSajuResult']);console.log('   - checkMemberLogin:',typeof window['checkMemberLogin']);console.log('   - generateSajuShareText:',typeof window['generateSajuShareText']);console.log('   - showShareOptions:',typeof window['showShareOptions']);console.log('ğŸ¯ DOMContentLoaded ì™„ë£Œ - ìµœì¢… ìƒíƒœ ì§„ë‹¨:');console.log('âœ… ëª¨ë“  ì´ˆê¸°í™” ì™„ë£Œ!');