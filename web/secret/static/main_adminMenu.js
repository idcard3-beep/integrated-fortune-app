(function(){const todayEl=document.getElementById('today');if(todayEl){const d=new Date();todayEl.textContent=`${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;}})();(function(){const sidebar=document.getElementById('sidebar');const menuBtn=document.getElementById('menuBtn');if(menuBtn&&sidebar){menuBtn.addEventListener('click',()=>sidebar.classList.toggle('open'));}
window.addEventListener('hashchange',()=>{if(matchMedia('(max-width:900px)').matches&&sidebar)
sidebar.classList.remove('open');});})();(function(){function syncNav(){const hash=location.hash||'#code';document.querySelectorAll('.nav-btn').forEach((a)=>{a.removeAttribute('aria-current');if(a.getAttribute('href')===hash)
a.setAttribute('aria-current','page');});}
window.addEventListener('hashchange',syncNav);syncNav();})();(function(){function checkPageAccess(){console.log('ðŸ” main_adminMenu.html íŽ˜ì´ì§€ ì ‘ê·¼ ê¶Œí•œ ì²´í¬ ì‹œìž‘...');if(typeof window.getAdminSession!=='function'){console.error('âŒ admin_session.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');alert('âŒ ì„¸ì…˜ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜\níŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');window.location.href='/secret/admin_login';return false;}
const adminSession=window.getAdminSession();console.log('ðŸ“‹ ê´€ë¦¬ìž ì„¸ì…˜ ì •ë³´:',adminSession);if(!adminSession||!adminSession.isLoggedIn||!adminSession.admin_id){console.warn('âš ï¸ ê´€ë¦¬ìž ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');alert('âŒ ê´€ë¦¬ìž ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\në¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');window.location.href='/secret/admin_login';return false;}
const currentRole=adminSession.role;console.log('ðŸ” í˜„ìž¬ role í™•ì¸:',currentRole);console.log('ðŸ” role íƒ€ìž…:',typeof currentRole);console.log('ðŸ” role === "ADMIN":',currentRole==='ADMIN');if(currentRole!=='ADMIN'){console.error('âŒ ADMIN ê¶Œí•œì´ ì•„ë‹™ë‹ˆë‹¤!');console.error('   í˜„ìž¬ role:',currentRole);console.error('   role íƒ€ìž…:',typeof currentRole);alert(`âŒ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\n\n`+`ðŸ”’ ìš”ì²­ íŽ˜ì´ì§€: ê´€ë¦¬ìž ì‹œìŠ¤í…œ ê´€ë¦¬ ë©”ë‰´\n`+`ðŸ‘¤ í˜„ìž¬ ê¶Œí•œ: ${currentRole || 'ì—†ìŒ'}\n`+`âœ… í•„ìš” ê¶Œí•œ: ADMIN\n\n`+`ê´€ë¦¬ìž ê¶Œí•œ(ADMIN)ì´ í•„ìš”í•©ë‹ˆë‹¤.\n`+`í˜„ìž¬ ë¡œê·¸ì¸í•œ ê³„ì •ì€ ì´ íŽ˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n`+`ë¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);window.location.href='/secret/admin_login';return false;}
console.log('ðŸ”„ ì„œë²„ ì¸¡ ê¶Œí•œ í™•ì¸ ì¤‘...');fetch('/secret/api/v1/admin/check-role',{method:'GET',credentials:'same-origin',headers:{'Content-Type':'application/json'}}).then(response=>{console.log('ðŸ“¡ ì„œë²„ ì‘ë‹µ ìƒíƒœ:',response.status);if(!response.ok){throw new Error(`HTTP ${response.status}: ${response.statusText}`);}
return response.json();}).then(data=>{console.log('ðŸ“‹ ì„œë²„ ì‘ë‹µ:',data);const serverRole=data.role||data.admin_role;const isAdmin=data.is_admin;console.log('ðŸ” ì„œë²„ role:',serverRole);console.log('ðŸ” ì„œë²„ is_admin:',isAdmin);if(serverRole!=='ADMIN'||!isAdmin){console.error('âŒ ì„œë²„ ì¸¡ì—ì„œë„ ADMIN ê¶Œí•œì´ ì•„ë‹™ë‹ˆë‹¤!');alert(`âŒ ì„œë²„ ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨\n\n`+`ì„œë²„ ì¸¡ ê¶Œí•œ: ${serverRole || 'ì—†ìŒ'}\n`+`ê´€ë¦¬ìž ê¶Œí•œ(ADMIN)ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\n`+`ë¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);window.location.href='/secret/admin_login';return false;}
console.log('âœ… ëª¨ë“  ê¶Œí•œ ì²´í¬ í†µê³¼ - íŽ˜ì´ì§€ ì ‘ê·¼ í—ˆìš©');}).catch(error=>{console.error('âŒ ì„œë²„ ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜:',error);console.error('   ì˜¤ë¥˜ íƒ€ìž…:',error.name);console.error('   ì˜¤ë¥˜ ë©”ì‹œì§€:',error.message);console.error('   ì˜¤ë¥˜ ìŠ¤íƒ:',error.stack);if(error.message.includes('Failed to fetch')||error.name==='TypeError'){alert(`âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨\n\n`+`ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n`+`ë‹¤ìŒì„ í™•ì¸í•´ì£¼ì„¸ìš”:\n`+`- ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸\n`+`- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ í™•ì¸\n`+`- ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ìžì„¸í•œ ì˜¤ë¥˜ í™•ì¸\n\n`+`ë¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);}else{alert(`âŒ ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n`+`ì˜¤ë¥˜: ${error.message}\n\n`+`ë¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);}
window.location.href='/secret/admin_login';});return true;}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',checkPageAccess);}else{checkPageAccess();}
function getCurrentUserRole(){if(window.getAdminSession&&window.getAdminSession().isLoggedIn){const adminSession=window.getAdminSession();console.log('ðŸ” ê´€ë¦¬ìž ì„¸ì…˜ ê°ì§€:',adminSession);return adminSession.role||'ADMIN';}
if(window.getMemberSession&&window.isMemberLoggedIn&&window.isMemberLoggedIn()){const memberSession=window.getMemberSession();console.log('ðŸ‘¤ íšŒì› ì„¸ì…˜ ê°ì§€:',memberSession);return memberSession.role||'USER';}
return'USER';}
function checkAdminPermission(actionName){const currentRole=getCurrentUserRole();console.log(`ðŸ” ê¶Œí•œ ì²´í¬ - ìž‘ì—…: ${actionName}, í˜„ìž¬ ê¶Œí•œ: ${currentRole}`);if(currentRole!=='ADMIN'){alert(`âŒ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\n\n`+`ðŸ”’ ìš”ì²­ ìž‘ì—…: ${actionName}\n`+`ðŸ‘¤ í˜„ìž¬ ê¶Œí•œ: ${currentRole}\n`+`âœ… í•„ìš” ê¶Œí•œ: ADMIN\n\n`+`ê´€ë¦¬ìž ê¶Œí•œ(ADMIN)ì´ í•„ìš”í•©ë‹ˆë‹¤.\n`+`ê´€ë¦¬ìž ë¡œê·¸ì¸ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.`);return false;}
console.log(`âœ… ê¶Œí•œ ìŠ¹ì¸ - ${actionName} ìž‘ì—… í—ˆìš©`);return true;}
document.querySelectorAll('[data-go]').forEach((btn)=>{btn.addEventListener('click',()=>{const id=btn.getAttribute('data-go');location.hash='#'+id;document.getElementById(id)?.scrollIntoView({behavior:'smooth',block:'start'});});});document.querySelectorAll('[data-demo]').forEach((btn)=>{btn.addEventListener('click',()=>{const area=btn.getAttribute('data-demo');alert(`"${area}" ë°ëª¨: ê°€ì´ë“œ/ë§ˆë²•ì‚¬/í…œí”Œë¦¿ ëª¨ë‹¬ ì—°ê²° ìœ„ì¹˜ìž…ë‹ˆë‹¤.`);});});const mapBtnToAction=[['openBcodeBtn','/secret/sit005.html','ê¸°ì´ˆ ì½”ë“œê´€ë¦¬'],['openMemlistBtn','/secret/a03_admin_memlist.html','íšŒì› ë¹„ë°€ìƒë‹´ìš”ì²­ ê´€ë¦¬'],['openMemcardBtn','/secret/a02_admin_memcard.html','ë©¤ë²„íšŒì› ì •ë³´ê´€ë¦¬'],['openMembatchBtn','/secret/a05_admin_membatch.html','ì¼ê´„ê´€ë¦¬'],['openAdminCardBtn','/secret/a06_adminCard.html','ê´€ë¦¬ìž ê³„ì •ê´€ë¦¬'],['openAnswersBtn','/secret/a03_admin_memlist.html','ê´€ë¦¬ìž ë‹µë³€ê´€ë¦¬'],];mapBtnToAction.forEach(([id,href,action])=>{const el=document.getElementById(id);if(el){el.addEventListener('click',()=>{if(!checkAdminPermission(action))return;console.log(`${action} ë²„íŠ¼ í´ë¦­ë¨!`);window.location.href=href;});}});const closeBtn=document.getElementById('closeBtn');if(closeBtn){closeBtn.addEventListener('click',function(){if(window.opener){window.close();}else if(window.history.length>1){window.history.back();}else{window.close();setTimeout(()=>{window.location.href='/secret/main_index.html';},100);}});}
const homeBtn=document.getElementById('homeBtn');if(homeBtn){homeBtn.addEventListener('click',()=>{location.hash='#code';window.scrollTo({top:0,behavior:'smooth'});});}
const logoutBtn=document.getElementById('logoutBtn');if(logoutBtn){logoutBtn.addEventListener('click',()=>{alert('ë¡œê·¸ì•„ì›ƒ API ì—°ë™ ì§€ì ìž…ë‹ˆë‹¤.');});}
const settingsBtn=document.getElementById('settingsBtn');if(settingsBtn){settingsBtn.addEventListener('click',()=>{alert('ì„¤ì • ëª¨ë‹¬/íŽ˜ì´ì§€ ì—°ê²° ì§€ì ìž…ë‹ˆë‹¤.');});}
const quitBtn=document.getElementById('quitBtn');if(quitBtn){quitBtn.addEventListener('click',()=>{if(confirm('ì—…ë¬´ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nìž„ì‹œ ì €ìž¥ ë° ì„¸ì…˜ ì •ë¦¬ë¥¼ ìˆ˜í–‰í•œ ë’¤ ë¡œê·¸ì•„ì›ƒí•©ë‹ˆë‹¤.')){alert('ì •ìƒ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!');}});}
const autosaveBtn=document.getElementById('autosaveBtn');if(autosaveBtn){autosaveBtn.addEventListener('click',()=>{alert('ìžë™ì €ìž¥ ì˜µì…˜ì„ ì„¤ì •í•˜ëŠ” ëª¨ë‹¬ì„ ì—°ê²°í•˜ì„¸ìš”.');});}
const THEME_KEY='admin-theme';const themeSelect=document.getElementById('themeSelect');function applyTheme(mode){if(!themeSelect)return;if(mode==='auto'){document.documentElement.removeAttribute('data-theme');}else{document.documentElement.setAttribute('data-theme',mode);}
localStorage.setItem(THEME_KEY,mode);themeSelect.value=mode;}
if(themeSelect){applyTheme(localStorage.getItem(THEME_KEY)||'auto');themeSelect.addEventListener('change',(e)=>applyTheme(e.target.value));}
const toTop=document.getElementById('toTop');if(toTop){window.addEventListener('scroll',()=>{if(window.scrollY>160)toTop.classList.add('show');else toTop.classList.remove('show');});toTop.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));}})();