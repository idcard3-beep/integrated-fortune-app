console.log('===ê´€ë¦¬ì ëª©ë¡ í˜ì´ì§€ ì‹œì‘(ë°˜ì‘í˜• ê·¸ë¦¬ë“œ)===');console.log('ğŸ—„ï¸ ê´€ë¦¬ì ë°˜ì‘í˜• DB ê·¸ë¦¬ë“œ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘...');(function checkAdminLogin() {console.log('ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì¤‘...');if (typeof window.getAdminSession==='function') {const adminSession=window.getAdminSession();console.log('ğŸ“‹ ê´€ë¦¬ì ì„¸ì…˜ ì •ë³´:',adminSession);if (!adminSession||!adminSession.isLoggedIn||!adminSession.admin_id) {console.warn('âš ï¸ ê´€ë¦¬ì ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');window.location.href='/secret/admin_login';return;}console.log('âœ… ê´€ë¦¬ì ë¡œê·¸ì¸ í™•ì¸ ì™„ë£Œ:',adminSession.admin_id);}else{console.error('âŒ admin_session.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');alert('ì„¸ì…˜ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì˜¤ë¥˜. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');window.location.href='/secret/admin_login';}})();function checkAdminSessionRealTime() {console.log('ğŸ”„ ì‹¤ì‹œê°„ ê´€ë¦¬ì ì„¸ì…˜ í™•ì¸ ì¤‘...');if (typeof window.getAdminSession==='function') {const adminSession=window.getAdminSession();if (!adminSession||!adminSession.isLoggedIn||!adminSession.admin_id) {console.warn('âš ï¸ ê´€ë¦¬ì ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');alert('ê´€ë¦¬ì ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');window.location.href='/secret/admin_login';return false;}console.log('âœ… ê´€ë¦¬ì ì„¸ì…˜ ìœ íš¨:',adminSession.admin_id);return true;}return false;}window.addEventListener('focus',()=>{console.log('ğŸ“„ í˜ì´ì§€ í¬ì»¤ìŠ¤-ì„¸ì…˜ ì¬í™•ì¸');checkAdminSessionRealTime();});window.addEventListener('storage',function (e) {if (e.key==='admin_session') {console.log('ğŸ”” ê´€ë¦¬ì ì„¸ì…˜ ë³€ê²½ ê°ì§€');setTimeout(()=>{checkAdminSessionRealTime();},100);}});setInterval(()=>{checkAdminSessionRealTime();},30000);function checkAdminStatus() {console.log('ğŸ” ê´€ë¦¬ì ì„¸ì…˜ ìƒíƒœ ìˆ˜ë™ í™•ì¸');if (typeof window.getAdminSession==='function') {const adminSession=window.getAdminSession();console.log('ğŸ“‹ í˜„ì¬ ê´€ë¦¬ì ì„¸ì…˜:',adminSession);if (adminSession&&adminSession.isLoggedIn&&adminSession.admin_id) {alert(`âœ… ê´€ë¦¬ì ì„¸ì…˜ í™œì„±í™”\n\n`+`ğŸ†” ID: ${adminSession.admin_id}\n`+`ğŸ‘¤ ì‚¬ìš©ìëª…: ${adminSession.username||'ì •ë³´ì—†ìŒ'}\n`+`ğŸ”‘ ê¶Œí•œ: ${adminSession.role||'ADMIN'}\n`+`â° ë¡œê·¸ì¸ ìƒíƒœ: í™œì„±í™”`);}else{alert(`âŒ ê´€ë¦¬ì ì„¸ì…˜ ì—†ìŒ\n\n`+`ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\n`+`ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)&&(window.location.href='/admin_login');}}else{alert('âŒ ì„¸ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œ ì˜¤ë¥˜\nadmin_session.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');}}window.checkAdminStatus=checkAdminStatus;function goToAdminMenu() {console.log('ğŸ” main_adminMenu.html ì ‘ê·¼ ê¶Œí•œ ì²´í¬ ì‹œì‘...');if (typeof window.getAdminSession!=='function') {console.error('âŒ admin_session.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');alert('âŒ ì„¸ì…˜ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');return;}const adminSession=window.getAdminSession();console.log('ğŸ“‹ ê´€ë¦¬ì ì„¸ì…˜ ì •ë³´:',adminSession);if (!adminSession||!adminSession.isLoggedIn||!adminSession.admin_id) {console.warn('âš ï¸ ê´€ë¦¬ì ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');alert('âŒ ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');window.location.href='/secret/admin_login';return;}const currentRole=adminSession.role;console.log('ğŸ” í˜„ì¬ role í™•ì¸:',currentRole);console.log('ğŸ” role íƒ€ì…:',typeof currentRole);console.log('ğŸ” role==="ADMIN":',currentRole==='ADMIN');console.log('ğŸ” role!=="ADMIN":',currentRole!=='ADMIN');if (currentRole!=='ADMIN') {console.error('âŒ ADMIN ê¶Œí•œì´ ì•„ë‹™ë‹ˆë‹¤!');console.error(' í˜„ì¬ role:',currentRole);console.error(' role íƒ€ì…:',typeof currentRole);alert(`âŒ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\n\n`+`ğŸ”’ ìš”ì²­ í˜ì´ì§€: ê´€ë¦¬ì ì‹œìŠ¤í…œ ê´€ë¦¬ ë©”ë‰´\n`+`ğŸ‘¤ í˜„ì¬ ê¶Œí•œ: ${currentRole||'ì—†ìŒ'}\n`+`âœ… í•„ìš” ê¶Œí•œ: ADMIN\n\n`+`ê´€ë¦¬ì ê¶Œí•œ(ADMIN)ì´ í•„ìš”í•©ë‹ˆë‹¤.\n`+`í˜„ì¬ ë¡œê·¸ì¸í•œ ê³„ì •ì€ ì´ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);return;}console.log('ğŸ”„ ì„œë²„ ì¸¡ ê¶Œí•œ í™•ì¸ ì¤‘...');fetch('/secret/api/v1/admin/check-role',{method: 'GET',credentials: 'same-origin'}).then(response=>response.json()).then(data=>{console.log('ğŸ“‹ ì„œë²„ ì‘ë‹µ:',data);const serverRole=data.role||data.admin_role;const isAdmin=data.is_admin;console.log('ğŸ” ì„œë²„ role:',serverRole);console.log('ğŸ” ì„œë²„ is_admin:',isAdmin);if (serverRole!=='ADMIN'||!isAdmin) {console.error('âŒ ì„œë²„ ì¸¡ì—ì„œë„ ADMIN ê¶Œí•œì´ ì•„ë‹™ë‹ˆë‹¤!');alert(`âŒ ì„œë²„ ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨\n\n`+`ì„œë²„ ì¸¡ ê¶Œí•œ: ${serverRole||'ì—†ìŒ'}\n`+`ê´€ë¦¬ì ê¶Œí•œ(ADMIN)ì´ í•„ìš”í•©ë‹ˆë‹¤.`);return;}console.log('âœ… ëª¨ë“  ê¶Œí•œ ì²´í¬ í†µê³¼-main_adminMenu.htmlë¡œ ì´ë™');window.location.href='main_adminMenu.html';}).catch(error=>{console.error('âŒ ì„œë²„ ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜:',error);alert('âŒ ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');});}window.goToAdminMenu=goToAdminMenu;function load() {const status=document.getElementById('statusFilter').value;const q=status ? `?status=${encodeURIComponent(status)}` : '';const url='/secret/api/v1/admin/tickets'+q;console.log('ğŸš€ ê´€ë¦¬ì í‹°ì¼“ ëª©ë¡ ë¡œë“œ:',url);console.log('ğŸ“‹ ì„ íƒëœ ìƒíƒœ í•„í„°:',status);fetch(url).then((r)=>{if (r.status===401) {alert('ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì„¸ìš”');location.href='/secret/admin_login';return;}return r.json();}).then((items)=>{console.log('ğŸ” API ì‘ë‹µ ì „ì²´:',items);console.log('ğŸ” ì‘ë‹µ íƒ€ì…:',typeof items);console.log('ğŸ” í•­ëª© ìˆ˜:',items.length);if (items.length===0) {showAdminEmptyState();return;}if (items[0]) {console.log('ğŸ¯ ì²« ë²ˆì§¸ í•­ëª© ìƒì„¸:');console.log('-author_name:',items[0].author_name);console.log('-author_contact:',items[0].author_contact);console.log('-ì „ì²´ ê°ì²´:',items[0]);}renderAdminDesktopTable(items);renderAdminMobileCards(items);console.log('âœ… ê´€ë¦¬ì MSSQL ë°ì´í„° í‘œì‹œ ì™„ë£Œ');}).catch((error)=>{console.error('âŒ ê´€ë¦¬ì MSSQL ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:',error);showAdminErrorState();});}function renderAdminDesktopTable(items) {const tableBody=document.getElementById('rows');tableBody.innerHTML='';items.forEach((ticket,idx)=>{console.log(`ğŸ” ë°ìŠ¤í¬í†± í…Œì´ë¸” ë Œë”ë§ [${idx}]:`,ticket);console.log(`ğŸ” [${idx}] author_name:`,ticket.author_name);console.log(`ğŸ” [${idx}] author_contact:`,ticket.author_contact);console.log(`ğŸ” [${idx}] snsgu ê°’:`,ticket.snsgu);const tr=document.createElement('tr');tr.innerHTML=`<td><strong>#${idx+1}</strong></td><td><div style="font-weight: 600;color: #495057;">${ticket.title}</div></td><td><span class="admin-status-badge-small ${getAdminStatusClass(ticket.status)}">${getAdminStatusText(ticket.status)}</span></td><td><span class="admin-reply-badge ${ticket.has_admin_reply ? 'admin-reply-yes' : 'admin-reply-no'}">${ticket.has_admin_reply ? 'Y' : 'N'}</span></td><td><div style="font-size: 13px;color: #495057;max-width: 100px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">${ticket.author_name||'ë¯¸ë“±ë¡'}</div></td><td><div style="font-size: 13px;color: #6c757d;max-width: 120px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">${ticket.author_contact||'ë¯¸ë“±ë¡'}</div></td><td><span class=(function () {var b="0111001101101110011100110110011101110101001011010110001001100001011001000110011101100101";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()>${ticket.snsgu||'A0001'}</span></td><td><div style="font-size: 12px;color: #6c757d;">${formatAdminDate(ticket.created_at)}</div></td>`;tr.onclick=()=>(location.href=`/secret/admin_view?id=${ticket.ticket_id}`);tableBody.appendChild(tr);});}function renderAdminMobileCards(items) {const mobileContainer=document.getElementById('adminMobileCardView');mobileContainer.innerHTML='';items.forEach((ticket,idx)=>{const cardElement=document.createElement('div');cardElement.className='admin-ticket-card';cardElement.onclick=()=>(location.href=`/secret/admin_view?id=${ticket.ticket_id}`);cardElement.innerHTML=`<div class=(function () {var b="0110000101100100011011010110100101101110001011010110001101100001011100100110010000101101011010000110010101100001011001000110010101110010";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()><div class=(function () {var b="0110000101100100011011010110100101101110001011010110001101100001011100100110010000101101011011100111010101101101011000100110010101110010";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()>#${idx+1}</div><span class="admin-reply-badge ${ticket.has_admin_reply ? 'admin-reply-yes' : 'admin-reply-no'}">${ticket.has_admin_reply ? 'Y' : 'N'}</span></div><div class=(function () {var b="01100001011001000110110101101001011011100010110101100011011000010111001001100100001011010111010001101001011101000110110001100101";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()>${ticket.title}</div><div class=(function () {var b="011000010110010001101101011010010110111000101101011000110110000101110010011001000010110101101101011001010111010001100001";var r="";for (var i=0;i<b.length;i+=8) {r+=String.fromCharCode(parseInt(b.substr(i,8),2));}return r;})()><div class="admin-meta-item"><div class="admin-meta-label">ìƒíƒœ</div><div class="admin-meta-value"><span class="admin-status-badge-small ${getAdminStatusClass(ticket.status)}">${getAdminStatusText(ticket.status)}</span></div></div><div class="admin-meta-item"><div class="admin-meta-label">ìë£Œêµ¬ë¶„</div><div class="admin-meta-value"><span class="snsgu-badge">${ticket.snsgu||'A0001'}</span></div></div><div class="admin-meta-item"><div class="admin-meta-label">ì´ë¦„</div><div class="admin-meta-value">${ticket.author_name||'ë¯¸ë“±ë¡'}</div></div><div class="admin-meta-item"><div class="admin-meta-label">ë©”ëª¨ë€</div><div class="admin-meta-value">${ticket.author_contact||'ë¯¸ë“±ë¡'}</div></div><div class="admin-meta-item"><div class="admin-meta-label">ë“±ë¡ì¼</div><div class="admin-meta-value">${formatAdminDate(ticket.created_at)}</div></div></div>`;mobileContainer.appendChild(cardElement);});}function getAdminStatusClass(status) {switch(status?.toUpperCase()) {case 'OPEN':
 return 'admin-status-open';case 'ANSWERED':
 return 'admin-status-answered';case 'CLOSED':
 return 'admin-status-closed';default:
 return 'admin-status-open';}}function getAdminStatusText(status) {switch(status?.toUpperCase()) {case 'OPEN':
 return 'ğŸ”´ ëŒ€ê¸°ì¤‘';case 'ANSWERED':
 return 'ğŸŸ¢ ë‹µë³€ì™„ë£Œ';case 'CLOSED':
 return 'ğŸŸ¡ ë§ˆê°';default:
 return 'ğŸ”´ ëŒ€ê¸°ì¤‘';}}function formatAdminDate(dateString) {try{const date=new Date(dateString);const now=new Date();const diffTime=Math.abs(now-date);const diffDays=Math.ceil(diffTime/(1000*60*60*24));if (diffDays===1) {return('ğŸ• ì˜¤ëŠ˜ '+date.toLocaleTimeString('ko-KR',{hour: '2-digit',minute: '2-digit',}));}else if (diffDays===2) {return('ğŸ“… ì–´ì œ '+date.toLocaleTimeString('ko-KR',{hour: '2-digit',minute: '2-digit',}));}else if (diffDays<=7) {return `ğŸ“† ${diffDays-1}ì¼ ì „`;}else{return('ğŸ“‹ '+date.toLocaleDateString('ko-KR',{year: 'numeric',month: 'short',day: 'numeric',}));}}catch(error) {return dateString;}}function showAdminEmptyState() {const tableBody=document.getElementById('rows');const mobileContainer=document.getElementById('adminMobileCardView');const emptyContent=`<div class="admin-empty-state"><div class="admin-empty-state-icon">ğŸ“‹</div><h3>ìƒë‹´ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</h3><p>í˜„ì¬ ì„ íƒí•œ í•„í„°ì— í•´ë‹¹í•˜ëŠ” ìƒë‹´ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;tableBody.innerHTML=`<tr><td colspan="7">${emptyContent}</td></tr>`;mobileContainer.innerHTML=emptyContent;}function showAdminErrorState() {const tableBody=document.getElementById('rows');const mobileContainer=document.getElementById('adminMobileCardView');const errorContent=`<div class="admin-empty-state"><div class="admin-empty-state-icon">âš ï¸</div><h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3><p>ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p><button class="admin-logout-btn" onclick="load()" style="margin-top: 16px;background: linear-gradient(135deg,#ff6b6b 0%,#ee5a52 100%);">ğŸ”„ ë‹¤ì‹œ ì‹œë„</button></div>`;tableBody.innerHTML=`<tr><td colspan="7">${errorContent}</td></tr>`;mobileContainer.innerHTML=errorContent;}document.addEventListener('DOMContentLoaded',()=>{document.getElementById('statusFilter').addEventListener('change',load);load();});function logout() {console.log('ğŸšª ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ ì‹œì‘...');fetch('/secret/api/v1/admin/logout',{method: 'POST'}).then((r)=>r.json()).then((result)=>{console.log('âœ… ë¡œê·¸ì•„ì›ƒ API ì‘ë‹µ:',result);if (typeof window.clearAdminSession==='function') {window.clearAdminSession();console.log('âœ… ê´€ë¦¬ì ì„¸ì…˜ ì „ì—­ ë³€ìˆ˜ ì™„ì „ ì´ˆê¸°í™” ì™„ë£Œ');}console.log('ğŸ” ë¡œê·¸ì•„ì›ƒ í›„ ì „ì—­ ë³€ìˆ˜ ìƒíƒœ:',window.ADMIN_SESSION);console.log(' isLoggedIn:',window.ADMIN_SESSION?.isLoggedIn);location.href='/secret/admin_login';}).catch((error)=>{console.error('âŒ ë¡œê·¸ì•„ì›ƒ API ì˜¤ë¥˜:',error);if (typeof window.clearAdminSession==='function') {window.clearAdminSession();console.log('âš ï¸ API ì˜¤ë¥˜ ë°œìƒ-ì „ì—­ ë³€ìˆ˜ ê°•ì œ ì´ˆê¸°í™” ì™„ë£Œ');}console.log('ğŸ” ë¡œê·¸ì•„ì›ƒ í›„ ì „ì—­ ë³€ìˆ˜ ìƒíƒœ:',window.ADMIN_SESSION);location.href='/secret/admin_login';});}