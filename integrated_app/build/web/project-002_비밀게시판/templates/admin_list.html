<!doctype html><html lang=ko><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>ê´€ë¦¬ì - ìƒë‹´ìš”ì²­ ëª©ë¡</title><link href=/secret/static/style.css rel=stylesheet><link href=/secret/static/security.css rel=stylesheet><style>/* ê´€ë¦¬ììš© ë°˜ì‘í˜• DB ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
      .admin-grid-container {
        width: 100%;
        margin: 20px auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        overflow: hidden;
      }

      .admin-grid-header {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        color: white;
        padding: 24px;
        position: relative;
      }

      .admin-grid-header h2 {
        margin: 0;
        font-size: 26px;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .admin-status-badge {
        position: absolute;
        top: 24px;
        right: 24px;
        background: rgba(255, 255, 255, 0.25);
        padding: 10px 16px;
        border-radius: 25px;
        font-size: 13px;
        font-weight: 600;
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .admin-toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: linear-gradient(135deg, #f7fcfc 0%, #e8f4f8 100%);
        border-bottom: 1px solid #d1ecf1;
        gap: 16px;
      }

      
      .filter-section {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: nowrap;
      }

      .filter-label {
        font-weight: 600;
        color: #2c5f6b;
        font-size: 14px;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .admin-select {
        background: white;
        border: 2px solid #d1ecf1;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 13px;
        color: #2c5f6b;
        min-width: 120px;
        transition: all 0.3s ease;
      }

      .admin-select:focus {
        outline: none;
        border-color: #a8d5e2;
        box-shadow: 0 0 0 3px rgba(168, 213, 226, 0.2);
      }

      .admin-logout-btn {
        background: linear-gradient(135deg, #7fb3c3 0%, #2c5f6b 100%);
        color: white;
        border: none;
        padding: 8px 18px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(127, 179, 195, 0.3);
      }

      .admin-logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(127, 179, 195, 0.4);
      }

      /* ê´€ë¦¬ì ë°ì´í„° ê·¸ë¦¬ë“œ */
      .admin-data-grid {
        width: 100%;
        overflow-x: auto;
      }

      .admin-grid-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
      }

      .admin-grid-table thead th {
        background: linear-gradient(135deg, #e8f4f8 0%, #d1ecf1 100%);
        color: #2c5f6b;
        padding: 10px 8px;
        text-align: left;
        font-weight: 700;
        border-bottom: 3px solid #a8d5e2;
        position: sticky;
        top: 0;
        z-index: 15;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .admin-grid-table tbody td {
        padding: 6px 8px;
        border-bottom: 1px solid #d1ecf1;
        color: #34495e;
        vertical-align: middle;
        font-size: 13px;
        line-height: 1.3;
      }

      .admin-grid-table tbody tr {
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
      }

      .admin-grid-table tbody tr:hover {
        background: linear-gradient(135deg, #f7fcfc 0%, #e8f4f8 100%);
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(168, 213, 226, 0.15);
        border-left-color: #a8d5e2;
      }

      /* ê´€ë¦¬ì ìƒíƒœ ë°°ì§€ */
      .admin-status-badge-small {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }

      .admin-status-open {
        background: #e8f4f8;
        color: #2c5f6b;
        border: 1px solid #d1ecf1;
      }

      .admin-status-answered {
        background: #f0f9ff;
        color: #0891b2;
        border: 1px solid #7dd3fc;
      }

      .admin-status-closed {
        background: #fef3f2;
        color: #dc2626;
        border: 1px solid #fecaca;
      }

      /* ê´€ë¦¬ì ë‹µë³€ ë°°ì§€ */
      .admin-reply-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        font-size: 10px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .admin-reply-yes {
        background: linear-gradient(135deg, #7fb3c3 0%, #2c5f6b 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(127, 179, 195, 0.3);
      }

      .admin-reply-no {
        background: linear-gradient(135deg, #f5b7b1 0%, #ec7063 100%);
        color: white;
        box-shadow: 0 2px 8px rgba(245, 183, 177, 0.3);
      }

      /* ìë£Œêµ¬ë¶„ ë°°ì§€ */
      .snsgu-badge {
        background: linear-gradient(135deg, #a8d5e2 0%, #7fb3c3 100%);
        color: white;
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 9px;
        font-weight: 600;
        letter-spacing: 0.3px;
      }

      /* ê´€ë¦¬ì ëª¨ë°”ì¼ ì¹´ë“œ ë·° */
      .admin-mobile-card-view {
        display: none;
        padding: 0 15px 15px;
      }

      .admin-ticket-card {
        background: white;
        border-radius: 12px;
        margin-bottom: 12px;
        padding: 16px;
        box-shadow: 0 6px 20px rgba(168, 213, 226, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid #d1ecf1;
        position: relative;
        overflow: hidden;
      }

      .admin-ticket-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, #a8d5e2 0%, #7fb3c3 100%);
      }

      .admin-ticket-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(168, 213, 226, 0.2);
      }

      .admin-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .admin-card-number {
        background: linear-gradient(135deg, #a8d5e2 0%, #7fb3c3 100%);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: bold;
      }

      .admin-card-title {
        font-size: 15px;
        font-weight: 700;
        color: #2c5f6b;
        margin: 8px 0;
        line-height: 1.3;
      }

      .admin-card-meta {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin: 10px 0;
      }

      .admin-meta-item {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .admin-meta-label {
        font-size: 10px;
        color: #7fb3c3;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      .admin-meta-value {
        font-size: 12px;
        color: #2c5f6b;
        font-weight: 500;
      }

      .admin-card-date {
        font-size: 11px;
        color: #a8d5e2;
        text-align: right;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid #d1ecf1;
      }

      /* ë°˜ì‘í˜• ë””ìì¸ */
      @media (max-width: 768px) {
        .admin-data-grid {
          display: none;
        }

        .admin-mobile-card-view {
          display: block;
        }

        .admin-grid-header h2 {
          font-size: 22px;
        }

        .admin-status-badge {
          position: relative;
          top: auto;
          right: auto;
          margin-top: 12px;
          display: inline-block;
        }

        .admin-toolbar {
          flex-direction: column;
          gap: 12px;
          padding: 12px;
        }

        .filter-section {
          width: 100%;
          justify-content: center;
        }

        .admin-select {
          flex: 1;
          min-width: auto;
          padding: 4px 8px;
          font-size: 12px;
        }

        .admin-logout-btn {
          width: 100%;
          padding: 6px 12px;
          font-size: 12px;
        }
      }

      @media (max-width: 480px) {
        .admin-grid-container {
          margin: 5px;
          border-radius: 10px;
        }

        .admin-grid-header {
          padding: 12px;
        }

        .admin-grid-header h2 {
          font-size: 16px;
        }

        .admin-ticket-card {
          padding: 12px;
          margin-bottom: 8px;
        }

        .admin-card-title {
          font-size: 13px;
        }

        .admin-card-meta {
          grid-template-columns: 1fr;
          gap: 6px;
        }

        .admin-mobile-card-view {
          padding: 0 8px 8px;
        }
      }

      /* í…Œë¸”ë¦¿ ìµœì í™” */
      @media (min-width: 769px) and (max-width: 1024px) {
        .admin-grid-table thead th,
        .admin-grid-table tbody td {
          padding: 8px 6px;
          font-size: 12px;
        }

        .admin-grid-header h2 {
          font-size: 20px;
        }

        .admin-toolbar {
          padding: 10px 16px;
        }

        .admin-select {
          padding: 5px 10px;
          font-size: 12px;
          min-width: 100px;
        }

        .admin-logout-btn {
          padding: 6px 14px;
          font-size: 12px;
        }
      }

      /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
      .admin-loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 50px;
      }

      .admin-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #e8f4f8;
        border-top: 4px solid #a8d5e2;
        border-radius: 50%;
        animation: adminSpin 1s linear infinite;
      }

      @keyframes adminSpin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* ë¹ˆ ìƒíƒœ */
      .admin-empty-state {
        text-align: center;
        padding: 80px 20px;
        color: #7fb3c3;
      }

      .admin-empty-state-icon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.6;
      }

      .admin-empty-state h3 {
        color: #2c5f6b;
        margin-bottom: 8px;
      }

      /* ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ CSS */
      .modal {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        background: rgba(0, 0, 0, 0.5) !important;
        display: none !important;
        align-items: flex-start !important;
        justify-content: center !important;
        z-index: 99999 !important;
        margin: 0 !important;
        padding: 20px !important;
      }
      .modal.show {
        display: flex !important;
      }
      .modal .panel {
        background: white !important;
        border: 1px solid #ddd !important;
        border-radius: 14px;
        padding: 16px;
        max-width: 500px;
        width: 92%;
        position: relative !important;
        z-index: 100000 !important;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
        color: #333 !important;
        max-height: 90vh;
        overflow-y: auto;
        margin-top: 0 !important;
      }
      .modal .panel h3 {
        margin: 0;
        padding: 0;
        font-size: 20px;
        color: #333;
        line-height: 1.2;
        height: auto;
      }
      #adminLoginModal .panel h3 {
        margin: 0;
        padding: 0;
        height: auto;
        line-height: 1.2;
      }
      .modal .panel .sep {
        height: 1px;
        background: #ddd;
        margin: 10px 0;
      }
      #adminLoginModal .panel iframe {
        width: 100%;
        height: 500px;
        border: none;
        border-radius: 8px;
        overflow: hidden;
      }
      #adminLoginModal .panel {
        overflow: hidden;
      }
      .modal .panel button {
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #f5f5f5;
        color: #333;
        cursor: pointer;
        font-size: 14px;
      }
      .modal .panel button:hover {
        background: #e0e0e0;
      }</style><body><div class=admin-grid-container><div class=admin-grid-header><h2>ğŸ›¡ï¸ ê´€ë¦¬ì - ìƒë‹´ìš”ì²­ ëª©ë¡</h2><button style="cursor: pointer; border: none; padding: 8px 16px" class=admin-status-badge onclick=goToAdminMenu()>ğŸ—„ï¸ ê´€ë¦¬ì ì‹œìŠ¤í…œ ê´€ë¦¬</button></div><div class=admin-toolbar><div class=filter-section><span class=filter-label>ğŸ“Š ìƒíƒœ í•„í„°:</span><select class=admin-select id=statusFilter><option value>ì „ì²´ ìƒíƒœ<option value=OPEN>ğŸ”´ ëŒ€ê¸°ì¤‘<option value=ANSWERED>ğŸŸ¢ ë‹µë³€ì™„ë£Œ<option value=CLOSED>ğŸŸ¡ ë§ˆê°</select></div><div style="display: flex; gap: 8px; align-items: center"><button style="background: #16a34a" class=admin-logout-btn id=btnAdminStatus onclick=checkAdminStatus()>ğŸ” ì„¸ì…˜í™•ì¸</button><button class=admin-logout-btn onclick=logout()>ğŸšª ë¡œê·¸ì•„ì›ƒ</button></div></div><div class=admin-data-grid><table class=admin-grid-table><thead><tr><th style="width: 60px">No<th>ì œëª©<th style="width: 100px">ìƒíƒœ<th style="width: 80px">ë‹µë³€ì—¬ë¶€<th style="width: 100px">ì´ë¦„<th style="width: 120px">ë©”ëª¨ë€<th style="width: 100px">ìë£Œêµ¬ë¶„<th style="width: 140px">ë“±ë¡ì¼<tbody id=rows><tr><td class=admin-loading-spinner colspan=8><div class=admin-spinner></div></table></div><div class=admin-mobile-card-view id=adminMobileCardView><div class=admin-loading-spinner><div class=admin-spinner></div></div></div></div><div aria-hidden=true class=modal id=adminLoginModal><div class=panel><h3 style="margin: 0; padding: 0; line-height: 1.2; height: auto;">ê´€ë¦¬ì ë¡œê·¸ì¸</h3><div class=sep></div><iframe style="width: 100%;
            height: 500px;
            border: none;
            border-radius: 8px;
            overflow: hidden;" id=adminLoginFrame src=/secret/admin_login></iframe><div style="display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 10px;"><button id=btnAdminLoginCancel>ë‹«ê¸°</button></div></div></div><script src=/secret/static/member_session.js></script><script src=/secret/static/admin_session.js></script><script src=/secret/static/admin_list.js></script><script src=/secret/static/security.js></script><script>// ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
      function openAdminLoginModal() {
        try {
          const modal = document.getElementById('adminLoginModal');
          if (modal) {
            modal.classList.add('show');
            modal.setAttribute('aria-hidden', 'false');
            const frame = document.getElementById('adminLoginFrame');
            if (frame) {
              frame.src = '/secret/admin_login';
            }
          }
        } catch (error) {
          console.error('ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ ì˜¤ë¥˜:', error);
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      }

      function closeAdminLoginModal() {
        const modal = document.getElementById('adminLoginModal');
        if (modal) {
          // í¬ì»¤ìŠ¤ê°€ ìˆëŠ” ìš”ì†Œê°€ ëª¨ë‹¬ ë‚´ë¶€ì— ìˆìœ¼ë©´ í¬ì»¤ìŠ¤ ì œê±°
          const activeElement = document.activeElement;
          if (activeElement && modal.contains(activeElement)) {
            activeElement.blur();
          }
          // ëª¨ë‹¬ ë‹«ê¸°
          modal.classList.remove('show');
          modal.setAttribute('aria-hidden', 'true');
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        // ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        const btnAdminLoginCancel = document.getElementById('btnAdminLoginCancel');
        if (btnAdminLoginCancel) {
          btnAdminLoginCancel.addEventListener('click', closeAdminLoginModal);
        }

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        const adminLoginModal = document.getElementById('adminLoginModal');
        if (adminLoginModal) {
          adminLoginModal.addEventListener('click', function(e) {
            if (e.target === adminLoginModal) {
              closeAdminLoginModal();
            }
          });
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ëª¨ë‹¬ ë‹«ê¸° ë° í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        let loginSuccessHandled = false;
        window.addEventListener('message', function(event) {
          if (event.data && event.data.type === 'ADMIN_LOGIN_SUCCESS' && !loginSuccessHandled) {
            loginSuccessHandled = true; // ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
            console.log('ğŸ‰ ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ - admin_list ìƒˆë¡œê³ ì¹¨');
            
            // ê´€ë¦¬ì ì„¸ì…˜ ì„¤ì •
            if (event.data.admin && typeof window.setAdminSession === 'function') {
              window.setAdminSession(event.data.admin);
              console.log('âœ… ê´€ë¦¬ì ì„¸ì…˜ ì„¤ì • ì™„ë£Œ');
            }
            
            // ë¡œê·¸ì¸ ì„±ê³µ í”Œë˜ê·¸ ì„¤ì • (ìƒˆë¡œê³ ì¹¨ í›„ ì„¸ì…˜ í™•ì¸ ëŒ€ê¸°ìš©)
            sessionStorage.setItem('admin_login_success', 'true');
            
            // ì„¸ì…˜ì´ localStorageì— ì €ì¥ë  ë•Œê¹Œì§€ ëŒ€ê¸°
            let retryCount = 0;
            const maxRetries = 10;
            const checkSession = setInterval(() => {
              retryCount++;
              if (typeof window.getAdminSession === 'function') {
                const session = window.getAdminSession();
                if (session && session.isLoggedIn && session.admin_id) {
                  console.log('âœ… ì„¸ì…˜ í™•ì¸ ì™„ë£Œ:', session.admin_id);
                  clearInterval(checkSession);
                  closeAdminLoginModal();
                  // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                  setTimeout(() => {
                    location.reload();
                  }, 100);
                } else if (retryCount >= maxRetries) {
                  console.warn('âš ï¸ ì„¸ì…˜ í™•ì¸ ì‹œê°„ ì´ˆê³¼ - ê°•ì œ ìƒˆë¡œê³ ì¹¨');
                  clearInterval(checkSession);
                  closeAdminLoginModal();
                  setTimeout(() => {
                    location.reload();
                  }, 100);
                }
              } else if (retryCount >= maxRetries) {
                console.warn('âš ï¸ getAdminSession í•¨ìˆ˜ ì—†ìŒ - ê°•ì œ ìƒˆë¡œê³ ì¹¨');
                clearInterval(checkSession);
                closeAdminLoginModal();
                setTimeout(() => {
                  location.reload();
                }, 100);
              }
            }, 100); // 100msë§ˆë‹¤ í™•ì¸
          }
          
          // ê´€ë¦¬ì ë¡œê·¸ì¸ ì·¨ì†Œ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ëª¨ë‹¬ ë‹«ê¸°
          if (event.data && event.data.type === 'ADMIN_LOGIN_CANCELLED') {
            console.log('ğŸšª ê´€ë¦¬ì ë¡œê·¸ì¸ ì·¨ì†Œ ë©”ì‹œì§€ ìˆ˜ì‹ ');
            closeAdminLoginModal();
          }
        });
      });</script>