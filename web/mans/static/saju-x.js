function ganjiToTime(ganjiValue){if(!ganjiValue||ganjiValue==='')return null;const ganjiTimeMap={'子-夜':{hour:23,minute:45},'子-朝':{hour:0,minute:45},'子':{hour:0,minute:0},'丑':{hour:2,minute:0},'寅':{hour:4,minute:0},'卯':{hour:6,minute:0},'辰':{hour:8,minute:0},'巳':{hour:10,minute:0},'午':{hour:12,minute:0},'未':{hour:14,minute:0},'申':{hour:16,minute:0},'酉':{hour:18,minute:0},'戌':{hour:20,minute:0},'亥':{hour:22,minute:0},'미상':null};return ganjiTimeMap[ganjiValue]||null;}
function showResult(year,month,day,hour,minute,solarStr){var resultDiv=document.getElementById('saju-result');fetch(`/mans/get_saju?year=${year}&month=${month}&day=${day}&hour=${hour}&minute=${minute}`).then(function(res){return res.json();}).then(function(result){var year_gz=result.year||'';var month_gz=result.month||'';var day_gz=result.day||'';var hour_gz=result.hour||'';var info=result.info||{};var hour_names=['子시','축시','인시','묘시','진시','사시','오시','미시','신시','유시','술시','해시',];var hour_branch_idx=0;if((hour===23&&minute>=30)||hour===0||(hour===1&&minute<30)){hour_branch_idx=0;}else if((hour===1&&minute>=30)||hour===2||(hour===3&&minute<30)){hour_branch_idx=1;}else if((hour===3&&minute>=30)||hour===4||(hour===5&&minute<30)){hour_branch_idx=2;}else if((hour===5&&minute>=30)||hour===6||(hour===7&&minute<30)){hour_branch_idx=3;}else if((hour===7&&minute>=30)||hour===8||(hour===9&&minute<30)){hour_branch_idx=4;}else if((hour===9&&minute>=30)||hour===10||(hour===11&&minute<30)){hour_branch_idx=5;}else if((hour===11&&minute>=30)||hour===12||(hour===13&&minute<30)){hour_branch_idx=6;}else if((hour===13&&minute>=30)||hour===14||(hour===15&&minute<30)){hour_branch_idx=7;}else if((hour===15&&minute>=30)||hour===16||(hour===17&&minute<30)){hour_branch_idx=8;}else if((hour===17&&minute>=30)||hour===18||(hour===19&&minute<30)){hour_branch_idx=9;}else if((hour===19&&minute>=30)||hour===20||(hour===21&&minute<30)){hour_branch_idx=10;}else if((hour===21&&minute>=30)||hour===22||(hour===23&&minute<30)){hour_branch_idx=11;}
var hour_name=hour_names[hour_branch_idx];var hour_display=`${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')} ${hour_name}`;var html='<div style="margin-top:20px;">';html+='<h2 style="color:#1e3a8a;margin-bottom:16px;">사주 결과</h2>';html+='<div style="background:rgba(255,255,255,0.9);padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);">';html+=`<div style="margin-bottom:16px;"><strong>${solarStr}</strong></div>`;html+='<div style="font-size:1.2rem;font-weight:600;margin:20px 0;color:#1e3a8a;">';html+=`${year_gz}年 ${month_gz}月 ${day_gz}日 ${hour_gz}時`;html+='</div>';html+=`<div style="margin-top:12px;color:#6b7280;">시각: ${hour_display}</div>`;if(info.yearP){html+=`<div style="margin-top:16px;padding-top:16px;border-top:1px solid #e5e7eb;font-size:0.9rem;color:#6b7280;">${info.yearP}</div>`;}
if(result.lunar){html+=`<div style="margin-top:12px;font-size:0.9rem;color:#6b7280;">음력: ${result.lunar}</div>`;}
html+='</div>';html+='</div>';resultDiv.innerHTML=html;}).catch(function(error){resultDiv.innerHTML='<div style="color:red;margin-top:20px;">사주 계산 중 오류가 발생했습니다: '+error.message+'</div>';});}
function checkTimeType(type){var timeCheckbox=document.getElementById('check-time');var ganjiCheckbox=document.getElementById('check-ganji');var timeInputGroup=document.getElementById('time-input-group');var ganjiInputGroup=document.getElementById('ganji-input-group');var ganjiInput=document.getElementById('ganji-input');if(type==='time'){ganjiCheckbox.checked=false;timeInputGroup.querySelectorAll('input').forEach(function(input){input.disabled=false;});ganjiInput.disabled=true;}else if(type==='ganji'){timeCheckbox.checked=false;timeInputGroup.querySelectorAll('input').forEach(function(input){input.disabled=true;});ganjiInput.disabled=false;}}
document.getElementById('saju-form').onsubmit=function(e){e.preventDefault();var year=this.year.value;var month=this.month.value;var day=this.day.value;var calendarType=this.calendar_type.value;var timeInput=document.getElementById('check-time');var ganjiInput=document.getElementById('check-ganji');var hour=0;var minute=0;if(timeInput&&timeInput.checked){hour=parseInt(this.hour.value)||0;minute=parseInt(this.minute.value)||0;}else if(ganjiInput&&ganjiInput.checked){var ganjiValue=document.getElementById('ganji-input').value;var ganjiTime=ganjiToTime(ganjiValue);if(ganjiTime){hour=ganjiTime.hour;minute=ganjiTime.minute;}else if(ganjiValue==='미상'){hour=12;minute=0;}}
var solarStr=`양력: ${year}년 ${month}월 ${day}일 ${hour}시 ${minute}분`;if(calendarType==='음력'){var isLeap=document.getElementById('is_leap').checked;fetch(`/mans/convert_lunar_to_solar?year=${year}&month=${month}&day=${day}&is_leap=${isLeap}`).then(function(res){return res.json();}).then(function(solar){if(solar.error){document.getElementById('saju-result').innerHTML='<span style="color:red;">음력 변환 오류: '+solar.error+'</span>';return;}
year=solar.year;month=solar.month;day=solar.day;solarStr=`양력: ${year}년 ${month}월 ${day}일 ${hour}시 ${minute}분`;showResult(year,month,day,hour,minute,solarStr);}).catch(function(error){document.getElementById('saju-result').innerHTML='<span style="color:red;">음력 변환 중 오류가 발생했습니다: '+error.message+'</span>';});}else{showResult(year,month,day,hour,minute,solarStr);}};