let ticketId=null;function cancelEdit(){if(!ticketId){const urlParams=new URLSearchParams(window.location.search);ticketId=urlParams.get('id');}
if(confirm('ìˆ˜ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')){window.location.href=`/secret/view?id=${ticketId}`;}}
document.addEventListener('DOMContentLoaded',function(){console.log('=== ê²Œì‹œê¸€ ìˆ˜ì • í˜ì´ì§€ ì‹œì‘ (ìƒíƒœ ì–‘í˜¸) ===');const urlParams=new URLSearchParams(window.location.search);ticketId=urlParams.get('id');console.log('âœ… URLì—ì„œ ê°€ì ¸ì˜¨ ID:',ticketId);console.log('ğŸ—„ï¸ ì—°ê²° ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘...');if(!ticketId){console.error('âŒ IDê°€ ì—†ìŠµë‹ˆë‹¤!');showError('ê²Œì‹œê¸€ IDê°€ ì—†ìŠµë‹ˆë‹¤.');}else{loadTicketInfo();}
function loadTicketInfo(){const url=`/secret/api/v1/tickets/${ticketId}`;console.log('ğŸš€ ê²Œì‹œê¸€ ì •ë³´ ë¡œë“œ:',url);fetch(url,{credentials:'same-origin'}).then((response)=>{console.log('âœ… ì‘ë‹µ ìƒíƒœ:',response.status);if(!response.ok){if(response.status===401){showError('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. view í˜ì´ì§€ë¡œ ëŒì•„ê°€ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');return;}
throw new Error(`HTTP ${response.status}: ${response.statusText}`);}
return response.json();}).then((data)=>{if(!data)return;console.log('âœ… ë°›ì€ ë°ì´í„°:',data);const messages=data.messages||[];if(messages.length>0){showError('ê´€ë¦¬ì ë‹µë³€ì´ ìˆì–´ì„œ ë” ì´ìƒ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');return;}
window.ticketData=data.ticket;showEditForm();}).catch((error)=>{console.error('âŒ ì—ëŸ¬:',error);showError(`ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);});}
function showEditForm(){document.getElementById('loading').style.display='none';document.getElementById('edit-form').style.display='block';const ticket=window.ticketData;document.getElementById('ticket-id').value=ticket.ticket_id||ticket.id;document.getElementById('author-name').value=ticket.author_name||'';document.getElementById('author-contact').value=ticket.author_contact||'';document.getElementById('title').value=ticket.title||'';document.getElementById('content').value=ticket.content||'';const ticketForm=document.getElementById('ticketForm');if(ticketForm){const newForm=ticketForm.cloneNode(true);ticketForm.parentNode.replaceChild(newForm,ticketForm);newForm.addEventListener('submit',function(e){e.preventDefault();console.log('ğŸ“ í¼ ì œì¶œ ì´ë²¤íŠ¸ ë°œìƒ');const formData=new FormData(newForm);const data={author_name:formData.get('author_name'),author_contact:formData.get('author_contact'),title:formData.get('title'),content:formData.get('content'),};console.log('ğŸ“ ìˆ˜ì • ë°ì´í„°:',data);console.log('ğŸ—„ï¸ ìˆ˜ì • ìš”ì²­ ì „ì†¡ ì¤‘...');fetch(`/secret/api/v1/tickets/${ticketId}`,{method:'PUT',headers:{'Content-Type':'application/json',},credentials:'same-origin',body:JSON.stringify(data),}).then((response)=>{if(!response.ok){throw new Error(`HTTP ${response.status}: ${response.statusText}`);}
return response.json();}).then((result)=>{console.log('âœ… ìˆ˜ì • ì™„ë£Œ:',result);alert('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');window.location.href=`/secret/view?id=${ticketId}`;}).catch((error)=>{console.error('âŒ ìˆ˜ì • ì—ëŸ¬:',error);alert(`ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);});});}}
function showError(message){document.getElementById('loading').style.display='none';document.getElementById('error-message').textContent=message;document.getElementById('error').style.display='block';}});